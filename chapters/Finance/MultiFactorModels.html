

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Multi-factor models &#8212; Quantitative Investing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/Finance/MultiFactorModels';</script>
    <link rel="canonical" href="https://amoreira2.github.io/Fin418/chapters/Finance/MultiFactorModels.html" />
    <link rel="shortcut icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/figuremain2.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/figuremain2.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/what-is-quant-investing.html">1. What is Quantitative Investing?</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/statistical-techniques.html">1.1. Statistical Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/computational-tools.html">1.2. Computational tools</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/getting_started.html">2. Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/local_install.html">2.3. Local installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/cloud_setup.html">2.4. Cloud Setup</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../essentials/intro.html">3. Python Essentials</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../essentials/basics.html">3.1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/collections.html">3.2. Collections</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../essentials/introtopandas.html">3.3. Pandas</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/the_index.html">3.3.15. Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/timeseries.html">3.3.16. Time-Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/reshape.html">3.3.17. Reshape</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/merge.html">3.3.18. Merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/groupby.html">3.3.19. Group-by</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/matplotlib.html">3.3.20. Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/data_clean.html">3.3.21. Cleaning data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/storage_formats.html">3.3.22. Data Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/control_flow.html">3.4. Flow control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/functions.html">3.5. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/numpy.html">3.6. Numpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/plotting.html">3.7. Plotting</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Returns.html">4. Asset Returns</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="UsingAPI.html">4.3. Data APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="TheChoiceofFrequency.html">4.4. The Choice of Frequency and Annualization of Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scientific/randomness1.html">4.5. Modeling randomness</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="PortfolioMath.html">5. Portfolio Math</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../scientific/linear_algebra1.html">5.5. Linear algebra Review</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="MeanVariance.html">6. Mean-Variance Investing</a></li>
<li class="toctree-l1"><a class="reference internal" href="TradingStrategies.html">7. Trading Strategies</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="FactorModels.html">8. Factor Models</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="InterpretingFactorModels.html">8.4. Interpreting Factor Models</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="crosssectionalequitystrategies.html">9. Cross-Sectional Equity Strategies</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="MarketCapweighted.html">9.1. The Market Cap Weighted Portfolio</a></li>
<li class="toctree-l2"><a class="reference internal" href="Valueinvesting.html">9.2. Value factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="Momentum.html">9.3. Momentum factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="OtherEquityStrategies.html">9.4. Other Equity strategies</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Timing.html">10. Timing Strategies</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="Volatilitytiming.html">10.2. Volatility Timing</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Evaluation.html">11. Evaluating a Trading Strategy</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="Econometrics.html">11.1. The Econometrics of Strategy Evalaution</a></li>
<li class="toctree-l2"><a class="reference internal" href="outofsample.html">11.2. Out of Sample Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="TailandBackground.html">11.3. Tail Risks and Background Risks</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Topics.html">12. Topics in Quantitative Investing</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="Implementation.html">12.1. Strategy Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Horizon.html">12.2. Investment horizon effects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../additional/additional.html">13. Additional Statistics Material</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Assignments/Assignments.html">14. Assignments</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment0.html">14.1. Assigment 0</a></li>





<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment1.html">14.7. Assignment 1</a></li>




<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment2.html">14.12. Assigment 2</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment3.html">14.16. Assignment 3</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment4.html">14.20. Assignment 4</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment5.html">14.24. Assigment 5</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment6.html">14.28. Assignment 6</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment7.html">14.32. Assignment 7</a></li>

</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/amoreira2/Fin418/blob/main/chapters/Finance/MultiFactorModels.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418/issues/new?title=Issue%20on%20page%20%2Fchapters/Finance/MultiFactorModels.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/Finance/MultiFactorModels.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Multi-factor models</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Multi-factor models</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-a-multi-factor-model">Estimating a multi-factor model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application">Application</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reconstructing-the-co-variance-matrix">Reconstructing the co-variance matrix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-how-will-your-portfolio-risk-change-as-you-add-positions">Application: How will your portfolio risk change as you add positions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#performance-attribution">Performance Attribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#application-what-does-cathie-wood-likes-test">Application: What does Cathie Wood  Likes ? TEST</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#tracking-portfolios-and-tracking-error">Tracking portfolios and Tracking error</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#benchmarking">Benchmarking</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-models-as-models-of-expected-returns">Factor Models as Models of Expected Returns</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha">Alpha</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-if-alpha-i-neq-0">Testing  if <span class="math notranslate nohighlight">\(\alpha_i \neq 0\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-does-warren-buffet-beats-the-market">Application: Does Warren Buffet beats the market?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#appraisal-ratios">Appraisal Ratios</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#portable-alpha-and-hedged-portfolios">Portable Alpha and Hedged Portfolios</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-factor-theory">Multi-factor: theory</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#it-is-the-capm-but-the-wealth-portfolio-is-not-the-stock-market">IT is the CAPM, but the wealth portfolio is not the stock market</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#icapm-intertemporal-capital-asset-pricing-model">ICAPM: Intertemporal Capital Asset Pricing Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#apt-arbitrage-pricing-theory">APT: Arbitrage Pricing Theory</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># Create a date parser function that will allow pandas to read the dates in the format we have them</span>
<span class="n">date_parser</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;%Y%m&quot;</span><span class="p">)</span>
<span class="c1"># our 50 stock returns data</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/amoreira2/Fin418/main/assets/data/Retuns50stocks.csv&quot;</span>

<span class="c1"># Use pd.read_csv with the date_parser</span>
<span class="n">df</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">date_parser</span><span class="o">=</span><span class="n">date_parser</span><span class="p">)</span>
<span class="c1"># Set the date column as the index</span>

<span class="c1"># first, create the DataFrame</span>
<span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># put the returns in percentage format</span>
<span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">/</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 180 entries, 2000-01-01 to 2014-12-01
Data columns (total 51 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   CTL     180 non-null    float64
 1   T       180 non-null    float64
 2   CSCO    180 non-null    float64
 3   FCX     180 non-null    float64
 4   XL      180 non-null    float64
 5   IVZ     180 non-null    float64
 6   AMT     180 non-null    float64
 7   WHR     180 non-null    float64
 8   IR      180 non-null    float64
 9   WFT     180 non-null    float64
 10  YUM     180 non-null    float64
 11  CVS     180 non-null    float64
 12  GD      180 non-null    float64
 13  TYC     180 non-null    float64
 14  EL      180 non-null    float64
 15  MUR     180 non-null    float64
 16  CTAS    180 non-null    float64
 17  CBSA    180 non-null    float64
 18  SNV     180 non-null    float64
 19  CAM     180 non-null    float64
 20  DLTR    180 non-null    float64
 21  CAH     180 non-null    float64
 22  DTE     180 non-null    float64
 23  SSP     180 non-null    float64
 24  PSA     180 non-null    float64
 25  EXC     180 non-null    float64
 26  TKR     180 non-null    float64
 27  CMA     180 non-null    float64
 28  ORCL    180 non-null    float64
 29  MS      180 non-null    float64
 30  RSG     180 non-null    float64
 31  ACAS    180 non-null    float64
 32  AGN     180 non-null    float64
 33  MMM     180 non-null    float64
 34  ETFC    180 non-null    float64
 35  CAR     180 non-null    float64
 36  MDR     180 non-null    float64
 37  NOV     180 non-null    float64
 38  PCH     180 non-null    float64
 39  BAX     180 non-null    float64
 40  JCI     180 non-null    float64
 41  SWK     180 non-null    float64
 42  DVN     180 non-null    float64
 43  TMO     180 non-null    float64
 44  PEP     180 non-null    float64
 45  LNC     180 non-null    float64
 46  EMR     180 non-null    float64
 47  MLM     180 non-null    float64
 48  CCI     180 non-null    float64
 49  NU      180 non-null    float64
 50  Market  180 non-null    float64
dtypes: float64(51)
memory usage: 73.1 KB
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="multi-factor-models">
<h1>Multi-factor models<a class="headerlink" href="#multi-factor-models" title="Permalink to this heading">#</a></h1>
<p>We simply assumed that the residual <span class="math notranslate nohighlight">\(u\)</span> is uncorrelated</p>
<p>This will never be exactly correct, but we better be sure that we are not missing some big sources of correlation</p>
<p>If we miss our covariance assumption will be off</p>
<ul class="simple">
<li><p>Suppose we have a long only portfolio, are we going to over-estimate or under-estimate our true portfolio variance?</p></li>
<li><p>Suppose we have a long-short, that goes long some assets and short others, would the same conclusion apply? why?</p></li>
<li><p>Suppose we choose a portfolio by minimizing variance (like we just did) when are you going to over-estimate the variance of your portfolio?</p>
<ul>
<li><p>If there is co-movement that you miss?</p></li>
<li><p>If there is no true c0-movement but you assumed there was co-movement?</p></li>
</ul>
</li>
</ul>
<p>Real data are likely to have many factors</p>
<ul class="simple">
<li><p>industry factors: tech stocks move all together</p></li>
<li><p>Stocks that have high valuation multiples tends to move together with other high multiple stocks</p></li>
<li><p>Small stocks tend to move with other small firms</p></li>
<li><p>Firms that have been recently investing a lot move with other similar firms</p></li>
<li><p>etc</p></li>
</ul>
<p>We deal with this, by simply adding more factors to our model. Say we now have M different factors</p>
<div class="math notranslate nohighlight">
\[r_t^i=b_{i,1}f_t^1+b_{i,2}f_t^2+b_{i,3}f_t^3+...+b_{i,M}f_t^M+u_{i,t}+u_{i,t}\]</div>
<p>Where <span class="math notranslate nohighlight">\(b_{i,j}\)</span> measures the exposure of asset <span class="math notranslate nohighlight">\(i\)</span> to factor <span class="math notranslate nohighlight">\(j\)</span></p>
<p>IF we stack these exposures in a M by 1 vector <span class="math notranslate nohighlight">\(B_i=[b_{i,1},b_{i,2},...b_{i,M}]\)</span> and the factors in a M by 1 vector <span class="math notranslate nohighlight">\(F_t=[f^1_t,f^2_t,...,f^M_t]\)</span> we can write this in matrix notation</p>
<div class="math notranslate nohighlight">
\[r_t^i=B_i&#64;F_t+u_{i,t}\]</div>
<p>As before we can also stack the individual returns :</p>
<div class="math notranslate nohighlight">
\[R_t=B&#64;F_t+U_t\]</div>
<p>where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(R_t\)</span> is a N by 1 vector with the excess returns of the N assets</p></li>
<li><p><span class="math notranslate nohighlight">\(B\)</span> is N by M matrix where each row has the exposure of an asset with respect to each M factor and each column has the exposures of the different assets with respect to a particular factor</p></li>
<li><p><span class="math notranslate nohighlight">\(U_t\)</span> as before is a N by 1 vector with the residual risk of each N asset</p></li>
</ul>
<section id="estimating-a-multi-factor-model">
<h2>Estimating a multi-factor model<a class="headerlink" href="#estimating-a-multi-factor-model" title="Permalink to this heading">#</a></h2>
<p>Again, this is a very simple regression!</p>
<p>We simply run a multivariate regression for each asset and the coefficients on the different factors is our estimate!</p>
</section>
<section id="application">
<h2>Application<a class="headerlink" href="#application" title="Permalink to this heading">#</a></h2>
<p>Lets apply this!</p>
<p>Lets fo a 8 factor model—total overkill for these 50 stocks–</p>
<p>I will get the 3 factors from the Fama-French 3 factor model + 5 industry portfolios</p>
<p>What are these factors?</p>
<ul class="simple">
<li><p>HML is the value strategy that buys high book to market firms and sell low book to market firms</p></li>
<li><p>SMB is a size strategy that buys firms with low market capitalization and sell firms with high market capitalizations</p></li>
<li><p>the other are just portfolios based on the industry code of each firm that trades in the stock exchange</p></li>
<li><p>Here they are split only in 5 sectors which is obviously too coarse</p></li>
<li><p>One typically will use many more industry factors–say 50 or so.</p></li>
<li><p>but since in this example we have only 50 stocks–that would be kind of silly thing to do</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pandas_datareader.data</span> <span class="k">as</span> <span class="nn">web</span>

<span class="c1"># Define the start and end dates for the data</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="s1">&#39;2000-01-01&#39;</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="s1">&#39;2023-12-31&#39;</span>

<span class="c1"># Get the Fama-French three-factor model data</span>
<span class="n">ff_factors</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s1">&#39;F-F_Research_Data_Factors&#39;</span><span class="p">,</span> <span class="s1">&#39;famafrench&#39;</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Get the five industry portfolio data</span>
<span class="n">industry_portfolios</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s1">&#39;5_Industry_Portfolios&#39;</span><span class="p">,</span> <span class="s1">&#39;famafrench&#39;</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Merge the two datasets together</span>
<span class="n">merged_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ff_factors</span><span class="p">,</span> <span class="n">industry_portfolios</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<span class="n">factors_names</span><span class="o">=</span><span class="n">merged_data</span><span class="o">.</span><span class="n">columns</span>
<span class="n">merged_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">merged_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">())</span>
<span class="c1"># put the returns in percentage format</span>
<span class="n">merged_data</span><span class="o">=</span><span class="n">merged_data</span><span class="o">/</span><span class="mi">100</span>
<span class="c1">#Merge with your df dataset to make sure the dates match</span>
<span class="n">merged_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">merged_data</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Market&#39;</span><span class="p">]),</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

<span class="c1"># # Split the merged dataset into factors and individual assets</span>
<span class="n">Rf</span> <span class="o">=</span> <span class="n">merged_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">]]</span>
<span class="n">Factors</span> <span class="o">=</span> <span class="n">merged_data</span><span class="p">[</span><span class="n">factors_names</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">])</span>
<span class="n">Assets</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">factors_names</span><span class="p">)</span>

<span class="c1"># factors</span>
<span class="n">Factors</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">Assets</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">Factors</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 180 entries, 2000-01-01 to 2014-12-01
Data columns (total 8 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   Mkt-RF  180 non-null    float64
 1   SMB     180 non-null    float64
 2   HML     180 non-null    float64
 3   Cnsmr   180 non-null    float64
 4   Manuf   180 non-null    float64
 5   HiTec   180 non-null    float64
 6   Hlth    180 non-null    float64
 7   Other   180 non-null    float64
dtypes: float64(8)
memory usage: 12.7 KB
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 180 entries, 2000-01-01 to 2014-12-01
Data columns (total 50 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   CTL     180 non-null    float64
 1   T       180 non-null    float64
 2   CSCO    180 non-null    float64
 3   FCX     180 non-null    float64
 4   XL      180 non-null    float64
 5   IVZ     180 non-null    float64
 6   AMT     180 non-null    float64
 7   WHR     180 non-null    float64
 8   IR      180 non-null    float64
 9   WFT     180 non-null    float64
 10  YUM     180 non-null    float64
 11  CVS     180 non-null    float64
 12  GD      180 non-null    float64
 13  TYC     180 non-null    float64
 14  EL      180 non-null    float64
 15  MUR     180 non-null    float64
 16  CTAS    180 non-null    float64
 17  CBSA    180 non-null    float64
 18  SNV     180 non-null    float64
 19  CAM     180 non-null    float64
 20  DLTR    180 non-null    float64
 21  CAH     180 non-null    float64
 22  DTE     180 non-null    float64
 23  SSP     180 non-null    float64
 24  PSA     180 non-null    float64
 25  EXC     180 non-null    float64
 26  TKR     180 non-null    float64
 27  CMA     180 non-null    float64
 28  ORCL    180 non-null    float64
 29  MS      180 non-null    float64
 30  RSG     180 non-null    float64
 31  ACAS    180 non-null    float64
 32  AGN     180 non-null    float64
 33  MMM     180 non-null    float64
 34  ETFC    180 non-null    float64
 35  CAR     180 non-null    float64
 36  MDR     180 non-null    float64
 37  NOV     180 non-null    float64
 38  PCH     180 non-null    float64
 39  BAX     180 non-null    float64
 40  JCI     180 non-null    float64
 41  SWK     180 non-null    float64
 42  DVN     180 non-null    float64
 43  TMO     180 non-null    float64
 44  PEP     180 non-null    float64
 45  LNC     180 non-null    float64
 46  EMR     180 non-null    float64
 47  MLM     180 non-null    float64
 48  CCI     180 non-null    float64
 49  NU      180 non-null    float64
dtypes: float64(50)
memory usage: 71.7 KB
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mkt-RF</th>
      <th>SMB</th>
      <th>HML</th>
      <th>Cnsmr</th>
      <th>Manuf</th>
      <th>HiTec</th>
      <th>Hlth</th>
      <th>Other</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01</th>
      <td>-0.0474</td>
      <td>0.0577</td>
      <td>-0.0188</td>
      <td>-0.0792</td>
      <td>-0.0493</td>
      <td>-0.0489</td>
      <td>0.0759</td>
      <td>-0.0477</td>
    </tr>
    <tr>
      <th>2000-02-01</th>
      <td>0.0245</td>
      <td>0.2136</td>
      <td>-0.0959</td>
      <td>-0.0523</td>
      <td>-0.0463</td>
      <td>0.1322</td>
      <td>-0.0275</td>
      <td>-0.0738</td>
    </tr>
    <tr>
      <th>2000-03-01</th>
      <td>0.0520</td>
      <td>-0.1720</td>
      <td>0.0813</td>
      <td>0.1098</td>
      <td>0.0813</td>
      <td>0.0483</td>
      <td>0.0016</td>
      <td>0.1439</td>
    </tr>
    <tr>
      <th>2000-04-01</th>
      <td>-0.0640</td>
      <td>-0.0668</td>
      <td>0.0726</td>
      <td>-0.0221</td>
      <td>0.0153</td>
      <td>-0.0996</td>
      <td>0.0526</td>
      <td>-0.0285</td>
    </tr>
    <tr>
      <th>2000-05-01</th>
      <td>-0.0442</td>
      <td>-0.0605</td>
      <td>0.0475</td>
      <td>-0.0060</td>
      <td>0.0125</td>
      <td>-0.1076</td>
      <td>0.0396</td>
      <td>0.0336</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2014-08-01</th>
      <td>0.0424</td>
      <td>0.0040</td>
      <td>-0.0045</td>
      <td>0.0522</td>
      <td>0.0399</td>
      <td>0.0336</td>
      <td>0.0554</td>
      <td>0.0412</td>
    </tr>
    <tr>
      <th>2014-09-01</th>
      <td>-0.0197</td>
      <td>-0.0371</td>
      <td>-0.0134</td>
      <td>-0.0171</td>
      <td>-0.0455</td>
      <td>-0.0137</td>
      <td>-0.0022</td>
      <td>-0.0113</td>
    </tr>
    <tr>
      <th>2014-10-01</th>
      <td>0.0252</td>
      <td>0.0421</td>
      <td>-0.0181</td>
      <td>0.0297</td>
      <td>0.0085</td>
      <td>0.0143</td>
      <td>0.0590</td>
      <td>0.0344</td>
    </tr>
    <tr>
      <th>2014-11-01</th>
      <td>0.0255</td>
      <td>-0.0206</td>
      <td>-0.0309</td>
      <td>0.0630</td>
      <td>-0.0195</td>
      <td>0.0390</td>
      <td>0.0252</td>
      <td>0.0249</td>
    </tr>
    <tr>
      <th>2014-12-01</th>
      <td>-0.0006</td>
      <td>0.0249</td>
      <td>0.0227</td>
      <td>0.0008</td>
      <td>0.0044</td>
      <td>-0.0138</td>
      <td>-0.0082</td>
      <td>0.0117</td>
    </tr>
  </tbody>
</table>
<p>180 rows × 8 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Beta</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">Assets</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">columns</span><span class="o">=</span><span class="n">Factors</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">VarU</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">Assets</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;VarU&#39;</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">x</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">Factors</span><span class="p">)</span>
<span class="k">for</span> <span class="n">stocki</span> <span class="ow">in</span> <span class="n">Assets</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">y</span><span class="o">=</span> <span class="n">Assets</span><span class="p">[</span><span class="n">stocki</span><span class="p">]</span>
    <span class="c1"># run the regression</span>
    <span class="n">results</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="c1"># store beta parameters skipping the constant</span>
    <span class="n">Beta</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">stocki</span><span class="p">,:]</span><span class="o">=</span><span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="c1"># store the residual variance</span>
    <span class="n">VarU</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">stocki</span><span class="p">,</span><span class="s1">&#39;VarU&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">results</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>

<span class="n">Beta</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mkt-RF</th>
      <th>SMB</th>
      <th>HML</th>
      <th>Cnsmr</th>
      <th>Manuf</th>
      <th>HiTec</th>
      <th>Hlth</th>
      <th>Other</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>CTL</th>
      <td>1.773661</td>
      <td>-0.584068</td>
      <td>0.013224</td>
      <td>0.591461</td>
      <td>-0.151144</td>
      <td>-0.368082</td>
      <td>0.024628</td>
      <td>-0.729825</td>
    </tr>
    <tr>
      <th>T</th>
      <td>-0.765983</td>
      <td>-0.708870</td>
      <td>0.519897</td>
      <td>0.565646</td>
      <td>0.168277</td>
      <td>0.789765</td>
      <td>0.338093</td>
      <td>-0.314557</td>
    </tr>
    <tr>
      <th>CSCO</th>
      <td>-1.209827</td>
      <td>0.063438</td>
      <td>0.304196</td>
      <td>-0.030400</td>
      <td>-0.017300</td>
      <td>1.789234</td>
      <td>0.132417</td>
      <td>0.326659</td>
    </tr>
    <tr>
      <th>FCX</th>
      <td>0.579567</td>
      <td>0.240257</td>
      <td>-0.104024</td>
      <td>0.384780</td>
      <td>1.676865</td>
      <td>-0.040493</td>
      <td>-0.662841</td>
      <td>-0.379800</td>
    </tr>
    <tr>
      <th>XL</th>
      <td>-2.138662</td>
      <td>0.087942</td>
      <td>-0.098236</td>
      <td>0.743264</td>
      <td>0.194891</td>
      <td>0.325159</td>
      <td>-0.088233</td>
      <td>2.389057</td>
    </tr>
    <tr>
      <th>IVZ</th>
      <td>-2.943381</td>
      <td>0.143413</td>
      <td>-0.059142</td>
      <td>0.369939</td>
      <td>0.983337</td>
      <td>1.722916</td>
      <td>0.600754</td>
      <td>1.188089</td>
    </tr>
    <tr>
      <th>AMT</th>
      <td>-3.074392</td>
      <td>0.521988</td>
      <td>0.450322</td>
      <td>-0.642305</td>
      <td>1.219210</td>
      <td>2.357371</td>
      <td>0.867010</td>
      <td>0.144035</td>
    </tr>
    <tr>
      <th>WHR</th>
      <td>-0.123852</td>
      <td>0.510154</td>
      <td>1.116104</td>
      <td>1.142745</td>
      <td>-0.247190</td>
      <td>0.323533</td>
      <td>0.157214</td>
      <td>0.360687</td>
    </tr>
    <tr>
      <th>IR</th>
      <td>-1.389932</td>
      <td>0.025733</td>
      <td>0.109128</td>
      <td>1.001246</td>
      <td>0.943648</td>
      <td>0.638801</td>
      <td>-0.102587</td>
      <td>0.521383</td>
    </tr>
    <tr>
      <th>WFT</th>
      <td>-2.307030</td>
      <td>0.411222</td>
      <td>-0.381759</td>
      <td>-0.359601</td>
      <td>2.801833</td>
      <td>0.651049</td>
      <td>-0.450652</td>
      <td>0.940941</td>
    </tr>
    <tr>
      <th>YUM</th>
      <td>-1.270226</td>
      <td>0.178507</td>
      <td>-0.496309</td>
      <td>1.357438</td>
      <td>0.683168</td>
      <td>0.046853</td>
      <td>-0.171082</td>
      <td>0.369412</td>
    </tr>
    <tr>
      <th>CVS</th>
      <td>-0.928028</td>
      <td>-0.041287</td>
      <td>0.617824</td>
      <td>1.122041</td>
      <td>0.549131</td>
      <td>0.417007</td>
      <td>0.274484</td>
      <td>-0.358378</td>
    </tr>
    <tr>
      <th>GD</th>
      <td>-0.882976</td>
      <td>-0.080402</td>
      <td>0.372974</td>
      <td>0.248487</td>
      <td>0.771152</td>
      <td>0.318114</td>
      <td>0.221999</td>
      <td>0.357281</td>
    </tr>
    <tr>
      <th>TYC</th>
      <td>-0.912145</td>
      <td>-0.643299</td>
      <td>0.311803</td>
      <td>-0.050323</td>
      <td>0.139579</td>
      <td>1.100624</td>
      <td>0.368677</td>
      <td>0.606749</td>
    </tr>
    <tr>
      <th>EL</th>
      <td>2.154626</td>
      <td>0.021013</td>
      <td>0.131828</td>
      <td>0.582578</td>
      <td>-0.185306</td>
      <td>-0.780114</td>
      <td>0.013948</td>
      <td>-0.455518</td>
    </tr>
    <tr>
      <th>MUR</th>
      <td>-1.061828</td>
      <td>0.052984</td>
      <td>-0.462152</td>
      <td>-0.114691</td>
      <td>2.096592</td>
      <td>-0.048482</td>
      <td>-0.176060</td>
      <td>0.358905</td>
    </tr>
    <tr>
      <th>CTAS</th>
      <td>-3.578650</td>
      <td>-0.257339</td>
      <td>-0.210434</td>
      <td>1.518212</td>
      <td>0.679532</td>
      <td>1.056545</td>
      <td>0.040240</td>
      <td>1.340254</td>
    </tr>
    <tr>
      <th>CBSA</th>
      <td>1.254518</td>
      <td>0.374674</td>
      <td>0.411306</td>
      <td>0.051556</td>
      <td>0.068912</td>
      <td>-0.008052</td>
      <td>-0.181091</td>
      <td>0.397064</td>
    </tr>
    <tr>
      <th>SNV</th>
      <td>-0.539520</td>
      <td>0.395892</td>
      <td>0.350580</td>
      <td>-0.006382</td>
      <td>-0.212917</td>
      <td>-0.211582</td>
      <td>0.059285</td>
      <td>1.852562</td>
    </tr>
    <tr>
      <th>CAM</th>
      <td>-1.355484</td>
      <td>0.095259</td>
      <td>-0.253060</td>
      <td>-0.399919</td>
      <td>2.195785</td>
      <td>0.582245</td>
      <td>-0.104797</td>
      <td>0.304394</td>
    </tr>
    <tr>
      <th>DLTR</th>
      <td>-5.174840</td>
      <td>0.074346</td>
      <td>-0.613656</td>
      <td>2.298114</td>
      <td>0.288056</td>
      <td>1.917104</td>
      <td>0.132811</td>
      <td>1.354050</td>
    </tr>
    <tr>
      <th>CAH</th>
      <td>-1.630988</td>
      <td>-0.038102</td>
      <td>0.072405</td>
      <td>0.680673</td>
      <td>0.424837</td>
      <td>0.361032</td>
      <td>0.943522</td>
      <td>0.299449</td>
    </tr>
    <tr>
      <th>DTE</th>
      <td>-0.928040</td>
      <td>-0.036109</td>
      <td>0.119051</td>
      <td>-0.061966</td>
      <td>0.683112</td>
      <td>0.116873</td>
      <td>0.375849</td>
      <td>0.371118</td>
    </tr>
    <tr>
      <th>SSP</th>
      <td>2.399326</td>
      <td>0.350959</td>
      <td>1.580018</td>
      <td>-0.202042</td>
      <td>-0.201088</td>
      <td>-0.246833</td>
      <td>-0.098819</td>
      <td>-0.182760</td>
    </tr>
    <tr>
      <th>PSA</th>
      <td>0.622382</td>
      <td>0.481627</td>
      <td>0.486698</td>
      <td>0.020108</td>
      <td>-0.253502</td>
      <td>-0.215197</td>
      <td>0.057023</td>
      <td>0.251477</td>
    </tr>
    <tr>
      <th>EXC</th>
      <td>-2.716094</td>
      <td>0.103962</td>
      <td>-0.141726</td>
      <td>0.081577</td>
      <td>1.444151</td>
      <td>0.511308</td>
      <td>0.631693</td>
      <td>0.640010</td>
    </tr>
    <tr>
      <th>TKR</th>
      <td>-0.388819</td>
      <td>0.416236</td>
      <td>0.267321</td>
      <td>0.565174</td>
      <td>1.210320</td>
      <td>0.088204</td>
      <td>-0.142882</td>
      <td>0.315733</td>
    </tr>
    <tr>
      <th>CMA</th>
      <td>0.264046</td>
      <td>0.016297</td>
      <td>0.642026</td>
      <td>0.017207</td>
      <td>-0.484673</td>
      <td>-0.179948</td>
      <td>-0.028546</td>
      <td>1.202915</td>
    </tr>
    <tr>
      <th>ORCL</th>
      <td>-0.443179</td>
      <td>0.276515</td>
      <td>-0.141783</td>
      <td>-0.432309</td>
      <td>-0.062194</td>
      <td>1.202321</td>
      <td>0.163463</td>
      <td>0.339055</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>-0.045133</td>
      <td>-0.036167</td>
      <td>-0.699804</td>
      <td>-0.683817</td>
      <td>0.336957</td>
      <td>0.396558</td>
      <td>0.024887</td>
      <td>1.352232</td>
    </tr>
    <tr>
      <th>RSG</th>
      <td>-2.099194</td>
      <td>0.180949</td>
      <td>0.140585</td>
      <td>0.681522</td>
      <td>0.922261</td>
      <td>0.321369</td>
      <td>0.436344</td>
      <td>0.587005</td>
    </tr>
    <tr>
      <th>ACAS</th>
      <td>1.183355</td>
      <td>0.843240</td>
      <td>0.376865</td>
      <td>-0.143280</td>
      <td>-0.396161</td>
      <td>-0.591000</td>
      <td>0.177911</td>
      <td>1.195170</td>
    </tr>
    <tr>
      <th>AGN</th>
      <td>-3.155467</td>
      <td>0.230579</td>
      <td>-0.459391</td>
      <td>0.565370</td>
      <td>0.753599</td>
      <td>0.610063</td>
      <td>1.317825</td>
      <td>1.031209</td>
    </tr>
    <tr>
      <th>MMM</th>
      <td>-0.685658</td>
      <td>0.108876</td>
      <td>-0.427307</td>
      <td>0.412635</td>
      <td>0.499862</td>
      <td>-0.087273</td>
      <td>0.020962</td>
      <td>0.725735</td>
    </tr>
    <tr>
      <th>ETFC</th>
      <td>3.194747</td>
      <td>0.319935</td>
      <td>0.462664</td>
      <td>-0.100397</td>
      <td>-1.166081</td>
      <td>0.388496</td>
      <td>-1.065132</td>
      <td>0.293853</td>
    </tr>
    <tr>
      <th>CAR</th>
      <td>5.707205</td>
      <td>0.634022</td>
      <td>0.613190</td>
      <td>-0.028923</td>
      <td>-0.640322</td>
      <td>-1.428886</td>
      <td>-0.848328</td>
      <td>0.445591</td>
    </tr>
    <tr>
      <th>MDR</th>
      <td>-2.732450</td>
      <td>0.823879</td>
      <td>0.242378</td>
      <td>0.578830</td>
      <td>2.491042</td>
      <td>0.749193</td>
      <td>0.228586</td>
      <td>0.294130</td>
    </tr>
    <tr>
      <th>NOV</th>
      <td>-1.060649</td>
      <td>0.567584</td>
      <td>-0.402920</td>
      <td>-0.576143</td>
      <td>2.657741</td>
      <td>0.407855</td>
      <td>-0.062682</td>
      <td>-0.033028</td>
    </tr>
    <tr>
      <th>PCH</th>
      <td>0.338300</td>
      <td>0.222614</td>
      <td>0.484055</td>
      <td>0.639595</td>
      <td>0.218290</td>
      <td>0.067740</td>
      <td>-0.204804</td>
      <td>-0.010591</td>
    </tr>
    <tr>
      <th>BAX</th>
      <td>-1.347025</td>
      <td>-0.169875</td>
      <td>0.524005</td>
      <td>0.129125</td>
      <td>0.322082</td>
      <td>0.673845</td>
      <td>0.753479</td>
      <td>0.186215</td>
    </tr>
    <tr>
      <th>JCI</th>
      <td>-1.405615</td>
      <td>0.413783</td>
      <td>-0.013446</td>
      <td>0.727272</td>
      <td>0.309943</td>
      <td>0.490319</td>
      <td>-0.211553</td>
      <td>1.245598</td>
    </tr>
    <tr>
      <th>SWK</th>
      <td>-1.311538</td>
      <td>0.265555</td>
      <td>0.117049</td>
      <td>0.948610</td>
      <td>0.775872</td>
      <td>0.352706</td>
      <td>-0.193721</td>
      <td>0.641327</td>
    </tr>
    <tr>
      <th>DVN</th>
      <td>-0.628297</td>
      <td>0.039510</td>
      <td>0.137274</td>
      <td>-0.711291</td>
      <td>2.202942</td>
      <td>0.092802</td>
      <td>-0.118880</td>
      <td>0.165942</td>
    </tr>
    <tr>
      <th>TMO</th>
      <td>-3.252323</td>
      <td>-0.109431</td>
      <td>-0.436633</td>
      <td>0.651302</td>
      <td>0.885895</td>
      <td>1.193456</td>
      <td>0.897081</td>
      <td>0.867523</td>
    </tr>
    <tr>
      <th>PEP</th>
      <td>-0.550382</td>
      <td>-0.195754</td>
      <td>-0.152812</td>
      <td>0.768006</td>
      <td>-0.036170</td>
      <td>-0.030038</td>
      <td>0.511441</td>
      <td>0.157377</td>
    </tr>
    <tr>
      <th>LNC</th>
      <td>0.966791</td>
      <td>-0.031215</td>
      <td>0.400256</td>
      <td>-0.799016</td>
      <td>0.351931</td>
      <td>-0.344330</td>
      <td>0.096968</td>
      <td>1.505419</td>
    </tr>
    <tr>
      <th>EMR</th>
      <td>-2.044490</td>
      <td>-0.164199</td>
      <td>-0.242630</td>
      <td>0.491329</td>
      <td>0.986217</td>
      <td>0.688294</td>
      <td>0.238868</td>
      <td>0.847025</td>
    </tr>
    <tr>
      <th>MLM</th>
      <td>-2.844542</td>
      <td>0.188420</td>
      <td>-0.045674</td>
      <td>0.738026</td>
      <td>1.033461</td>
      <td>0.705830</td>
      <td>0.168861</td>
      <td>1.195677</td>
    </tr>
    <tr>
      <th>CCI</th>
      <td>-3.292825</td>
      <td>0.369532</td>
      <td>-0.643553</td>
      <td>0.468055</td>
      <td>1.128932</td>
      <td>1.851582</td>
      <td>0.739993</td>
      <td>0.667109</td>
    </tr>
    <tr>
      <th>NU</th>
      <td>0.770045</td>
      <td>-0.082375</td>
      <td>-0.121005</td>
      <td>0.392876</td>
      <td>0.234804</td>
      <td>-0.450403</td>
      <td>0.105630</td>
      <td>-0.246886</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="reconstructing-the-co-variance-matrix">
<h2>Reconstructing the co-variance matrix<a class="headerlink" href="#reconstructing-the-co-variance-matrix" title="Permalink to this heading">#</a></h2>
<p>We have</p>
<div class="math notranslate nohighlight">
\[R_t=B&#64;F_t+u_t\]</div>
<p>Then</p>
<div class="math notranslate nohighlight">
\[Var(R_t)=B&#64;Var(F_t)&#64;B.T+Var(U_t)\]</div>
<p>The big difference is that now <span class="math notranslate nohighlight">\(F\)</span> is a vector of factors</p>
<p>so <span class="math notranslate nohighlight">\(Var(F_t)\)</span> is a M by M variance covariance matrix</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Var_F</span><span class="o">=</span><span class="n">Factors</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
<span class="n">Cov_F</span><span class="o">=</span><span class="n">Beta</span> <span class="o">@</span> <span class="n">Var_F</span> <span class="o">@</span> <span class="n">Beta</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">VarU</span><span class="p">[</span><span class="s1">&#39;VarU&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">Cov_F</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CTL</th>
      <th>T</th>
      <th>CSCO</th>
      <th>FCX</th>
      <th>XL</th>
      <th>IVZ</th>
      <th>AMT</th>
      <th>WHR</th>
      <th>IR</th>
      <th>WFT</th>
      <th>...</th>
      <th>JCI</th>
      <th>SWK</th>
      <th>DVN</th>
      <th>TMO</th>
      <th>PEP</th>
      <th>LNC</th>
      <th>EMR</th>
      <th>MLM</th>
      <th>CCI</th>
      <th>NU</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>CTL</th>
      <td>0.006550</td>
      <td>0.001408</td>
      <td>0.002038</td>
      <td>0.002353</td>
      <td>0.002344</td>
      <td>0.003068</td>
      <td>0.001478</td>
      <td>0.002345</td>
      <td>0.002524</td>
      <td>0.002014</td>
      <td>...</td>
      <td>0.001866</td>
      <td>0.001834</td>
      <td>0.001465</td>
      <td>0.001725</td>
      <td>0.000972</td>
      <td>0.002767</td>
      <td>0.001863</td>
      <td>0.001482</td>
      <td>0.002324</td>
      <td>0.000972</td>
    </tr>
    <tr>
      <th>T</th>
      <td>0.001408</td>
      <td>0.004688</td>
      <td>0.001840</td>
      <td>0.001529</td>
      <td>0.002097</td>
      <td>0.002673</td>
      <td>0.001342</td>
      <td>0.002003</td>
      <td>0.002108</td>
      <td>0.001364</td>
      <td>...</td>
      <td>0.001478</td>
      <td>0.001464</td>
      <td>0.001073</td>
      <td>0.001628</td>
      <td>0.000898</td>
      <td>0.002289</td>
      <td>0.001655</td>
      <td>0.001333</td>
      <td>0.001848</td>
      <td>0.000682</td>
    </tr>
    <tr>
      <th>CSCO</th>
      <td>0.002038</td>
      <td>0.001840</td>
      <td>0.011381</td>
      <td>0.004141</td>
      <td>0.003665</td>
      <td>0.007108</td>
      <td>0.005885</td>
      <td>0.004123</td>
      <td>0.004269</td>
      <td>0.003808</td>
      <td>...</td>
      <td>0.003918</td>
      <td>0.002949</td>
      <td>0.001776</td>
      <td>0.003202</td>
      <td>0.000737</td>
      <td>0.004472</td>
      <td>0.002989</td>
      <td>0.002185</td>
      <td>0.006565</td>
      <td>0.000827</td>
    </tr>
    <tr>
      <th>FCX</th>
      <td>0.002353</td>
      <td>0.001529</td>
      <td>0.004141</td>
      <td>0.016977</td>
      <td>0.004431</td>
      <td>0.006325</td>
      <td>0.004123</td>
      <td>0.004492</td>
      <td>0.005487</td>
      <td>0.007251</td>
      <td>...</td>
      <td>0.004302</td>
      <td>0.004351</td>
      <td>0.005067</td>
      <td>0.002811</td>
      <td>0.000827</td>
      <td>0.005794</td>
      <td>0.003777</td>
      <td>0.003399</td>
      <td>0.005176</td>
      <td>0.001782</td>
    </tr>
    <tr>
      <th>XL</th>
      <td>0.002344</td>
      <td>0.002097</td>
      <td>0.003665</td>
      <td>0.004431</td>
      <td>0.016149</td>
      <td>0.006390</td>
      <td>0.001929</td>
      <td>0.006672</td>
      <td>0.005633</td>
      <td>0.004734</td>
      <td>...</td>
      <td>0.005489</td>
      <td>0.004780</td>
      <td>0.003223</td>
      <td>0.002946</td>
      <td>0.001755</td>
      <td>0.008175</td>
      <td>0.004011</td>
      <td>0.004223</td>
      <td>0.003393</td>
      <td>0.001667</td>
    </tr>
    <tr>
      <th>IVZ</th>
      <td>0.003068</td>
      <td>0.002673</td>
      <td>0.007108</td>
      <td>0.006325</td>
      <td>0.006390</td>
      <td>0.013659</td>
      <td>0.006441</td>
      <td>0.006358</td>
      <td>0.006517</td>
      <td>0.006437</td>
      <td>...</td>
      <td>0.005675</td>
      <td>0.004862</td>
      <td>0.004039</td>
      <td>0.004611</td>
      <td>0.001651</td>
      <td>0.007721</td>
      <td>0.004788</td>
      <td>0.004047</td>
      <td>0.007738</td>
      <td>0.001823</td>
    </tr>
    <tr>
      <th>AMT</th>
      <td>0.001478</td>
      <td>0.001342</td>
      <td>0.005885</td>
      <td>0.004123</td>
      <td>0.001929</td>
      <td>0.006441</td>
      <td>0.031007</td>
      <td>0.002818</td>
      <td>0.003462</td>
      <td>0.004313</td>
      <td>...</td>
      <td>0.002842</td>
      <td>0.002246</td>
      <td>0.002495</td>
      <td>0.003106</td>
      <td>0.000404</td>
      <td>0.003400</td>
      <td>0.002591</td>
      <td>0.001729</td>
      <td>0.006626</td>
      <td>0.000725</td>
    </tr>
    <tr>
      <th>WHR</th>
      <td>0.002345</td>
      <td>0.002003</td>
      <td>0.004123</td>
      <td>0.004492</td>
      <td>0.006672</td>
      <td>0.006358</td>
      <td>0.002818</td>
      <td>0.013016</td>
      <td>0.005424</td>
      <td>0.004185</td>
      <td>...</td>
      <td>0.005186</td>
      <td>0.004573</td>
      <td>0.002741</td>
      <td>0.002847</td>
      <td>0.001674</td>
      <td>0.007106</td>
      <td>0.003566</td>
      <td>0.003761</td>
      <td>0.003953</td>
      <td>0.001647</td>
    </tr>
    <tr>
      <th>IR</th>
      <td>0.002524</td>
      <td>0.002108</td>
      <td>0.004269</td>
      <td>0.005487</td>
      <td>0.005633</td>
      <td>0.006517</td>
      <td>0.003462</td>
      <td>0.005424</td>
      <td>0.010436</td>
      <td>0.005557</td>
      <td>...</td>
      <td>0.004651</td>
      <td>0.004379</td>
      <td>0.003777</td>
      <td>0.003135</td>
      <td>0.001402</td>
      <td>0.006352</td>
      <td>0.003864</td>
      <td>0.003627</td>
      <td>0.004728</td>
      <td>0.001701</td>
    </tr>
    <tr>
      <th>WFT</th>
      <td>0.002014</td>
      <td>0.001364</td>
      <td>0.003808</td>
      <td>0.007251</td>
      <td>0.004734</td>
      <td>0.006437</td>
      <td>0.004313</td>
      <td>0.004185</td>
      <td>0.005557</td>
      <td>0.015806</td>
      <td>...</td>
      <td>0.004336</td>
      <td>0.004459</td>
      <td>0.006108</td>
      <td>0.002894</td>
      <td>0.000642</td>
      <td>0.006455</td>
      <td>0.004048</td>
      <td>0.003746</td>
      <td>0.005082</td>
      <td>0.001747</td>
    </tr>
    <tr>
      <th>YUM</th>
      <td>0.001352</td>
      <td>0.000950</td>
      <td>0.001728</td>
      <td>0.003054</td>
      <td>0.002855</td>
      <td>0.003040</td>
      <td>0.001257</td>
      <td>0.002778</td>
      <td>0.002921</td>
      <td>0.002952</td>
      <td>...</td>
      <td>0.002415</td>
      <td>0.002418</td>
      <td>0.001945</td>
      <td>0.001536</td>
      <td>0.000814</td>
      <td>0.002908</td>
      <td>0.001978</td>
      <td>0.001953</td>
      <td>0.002244</td>
      <td>0.001012</td>
    </tr>
    <tr>
      <th>CVS</th>
      <td>0.001480</td>
      <td>0.001384</td>
      <td>0.001591</td>
      <td>0.002644</td>
      <td>0.002945</td>
      <td>0.003036</td>
      <td>0.001260</td>
      <td>0.003146</td>
      <td>0.002905</td>
      <td>0.002517</td>
      <td>...</td>
      <td>0.002260</td>
      <td>0.002367</td>
      <td>0.001945</td>
      <td>0.001669</td>
      <td>0.001038</td>
      <td>0.003190</td>
      <td>0.002020</td>
      <td>0.002022</td>
      <td>0.001926</td>
      <td>0.001055</td>
    </tr>
    <tr>
      <th>GD</th>
      <td>0.001531</td>
      <td>0.001394</td>
      <td>0.001973</td>
      <td>0.003187</td>
      <td>0.003706</td>
      <td>0.003748</td>
      <td>0.001701</td>
      <td>0.003405</td>
      <td>0.003320</td>
      <td>0.003487</td>
      <td>...</td>
      <td>0.002720</td>
      <td>0.002691</td>
      <td>0.002720</td>
      <td>0.001929</td>
      <td>0.001009</td>
      <td>0.004394</td>
      <td>0.002455</td>
      <td>0.002398</td>
      <td>0.002321</td>
      <td>0.001149</td>
    </tr>
    <tr>
      <th>TYC</th>
      <td>0.002319</td>
      <td>0.002321</td>
      <td>0.004628</td>
      <td>0.003569</td>
      <td>0.004665</td>
      <td>0.006115</td>
      <td>0.003713</td>
      <td>0.004243</td>
      <td>0.004277</td>
      <td>0.003585</td>
      <td>...</td>
      <td>0.003649</td>
      <td>0.003083</td>
      <td>0.002366</td>
      <td>0.003132</td>
      <td>0.001321</td>
      <td>0.005482</td>
      <td>0.003279</td>
      <td>0.002683</td>
      <td>0.004597</td>
      <td>0.001186</td>
    </tr>
    <tr>
      <th>EL</th>
      <td>0.001717</td>
      <td>0.001196</td>
      <td>0.002220</td>
      <td>0.003124</td>
      <td>0.003484</td>
      <td>0.003731</td>
      <td>0.001656</td>
      <td>0.003612</td>
      <td>0.003234</td>
      <td>0.002862</td>
      <td>...</td>
      <td>0.002786</td>
      <td>0.002622</td>
      <td>0.002048</td>
      <td>0.001838</td>
      <td>0.001099</td>
      <td>0.004084</td>
      <td>0.002219</td>
      <td>0.002103</td>
      <td>0.002579</td>
      <td>0.001234</td>
    </tr>
    <tr>
      <th>MUR</th>
      <td>0.001436</td>
      <td>0.000947</td>
      <td>0.001569</td>
      <td>0.004746</td>
      <td>0.002869</td>
      <td>0.003660</td>
      <td>0.002128</td>
      <td>0.002370</td>
      <td>0.003507</td>
      <td>0.005581</td>
      <td>...</td>
      <td>0.002444</td>
      <td>0.002825</td>
      <td>0.004378</td>
      <td>0.001860</td>
      <td>0.000590</td>
      <td>0.004110</td>
      <td>0.002670</td>
      <td>0.002469</td>
      <td>0.002742</td>
      <td>0.001339</td>
    </tr>
    <tr>
      <th>CTAS</th>
      <td>0.001812</td>
      <td>0.001830</td>
      <td>0.002505</td>
      <td>0.003019</td>
      <td>0.004603</td>
      <td>0.004191</td>
      <td>0.001373</td>
      <td>0.003948</td>
      <td>0.003810</td>
      <td>0.003030</td>
      <td>...</td>
      <td>0.003298</td>
      <td>0.003086</td>
      <td>0.002004</td>
      <td>0.002216</td>
      <td>0.001273</td>
      <td>0.004401</td>
      <td>0.002755</td>
      <td>0.002732</td>
      <td>0.002537</td>
      <td>0.001119</td>
    </tr>
    <tr>
      <th>CBSA</th>
      <td>0.002446</td>
      <td>0.001810</td>
      <td>0.005183</td>
      <td>0.005584</td>
      <td>0.006164</td>
      <td>0.007256</td>
      <td>0.004248</td>
      <td>0.006167</td>
      <td>0.005631</td>
      <td>0.005572</td>
      <td>...</td>
      <td>0.005226</td>
      <td>0.004521</td>
      <td>0.003605</td>
      <td>0.003150</td>
      <td>0.001298</td>
      <td>0.007305</td>
      <td>0.003846</td>
      <td>0.003615</td>
      <td>0.005347</td>
      <td>0.001660</td>
    </tr>
    <tr>
      <th>SNV</th>
      <td>0.001411</td>
      <td>0.001208</td>
      <td>0.002177</td>
      <td>0.002837</td>
      <td>0.006164</td>
      <td>0.004329</td>
      <td>0.000971</td>
      <td>0.005314</td>
      <td>0.003897</td>
      <td>0.003187</td>
      <td>...</td>
      <td>0.004119</td>
      <td>0.003489</td>
      <td>0.002307</td>
      <td>0.001834</td>
      <td>0.001270</td>
      <td>0.006575</td>
      <td>0.002722</td>
      <td>0.003134</td>
      <td>0.001799</td>
      <td>0.001190</td>
    </tr>
    <tr>
      <th>CAM</th>
      <td>0.001875</td>
      <td>0.001363</td>
      <td>0.003476</td>
      <td>0.005858</td>
      <td>0.003463</td>
      <td>0.005550</td>
      <td>0.004038</td>
      <td>0.003190</td>
      <td>0.004488</td>
      <td>0.006669</td>
      <td>...</td>
      <td>0.003309</td>
      <td>0.003437</td>
      <td>0.004906</td>
      <td>0.002683</td>
      <td>0.000644</td>
      <td>0.005069</td>
      <td>0.003370</td>
      <td>0.002891</td>
      <td>0.004662</td>
      <td>0.001475</td>
    </tr>
    <tr>
      <th>DLTR</th>
      <td>0.001495</td>
      <td>0.001531</td>
      <td>0.003615</td>
      <td>0.002177</td>
      <td>0.003122</td>
      <td>0.004143</td>
      <td>0.002376</td>
      <td>0.003139</td>
      <td>0.003044</td>
      <td>0.001609</td>
      <td>...</td>
      <td>0.002818</td>
      <td>0.002295</td>
      <td>0.000292</td>
      <td>0.002149</td>
      <td>0.000948</td>
      <td>0.002319</td>
      <td>0.002052</td>
      <td>0.001821</td>
      <td>0.003554</td>
      <td>0.000615</td>
    </tr>
    <tr>
      <th>CAH</th>
      <td>0.001220</td>
      <td>0.001178</td>
      <td>0.001173</td>
      <td>0.001478</td>
      <td>0.002356</td>
      <td>0.002576</td>
      <td>0.001150</td>
      <td>0.002369</td>
      <td>0.002045</td>
      <td>0.001487</td>
      <td>...</td>
      <td>0.001581</td>
      <td>0.001586</td>
      <td>0.001314</td>
      <td>0.001740</td>
      <td>0.001134</td>
      <td>0.002762</td>
      <td>0.001658</td>
      <td>0.001550</td>
      <td>0.001732</td>
      <td>0.000904</td>
    </tr>
    <tr>
      <th>DTE</th>
      <td>0.000683</td>
      <td>0.000652</td>
      <td>0.000424</td>
      <td>0.001438</td>
      <td>0.001770</td>
      <td>0.001581</td>
      <td>0.000576</td>
      <td>0.001483</td>
      <td>0.001486</td>
      <td>0.001808</td>
      <td>...</td>
      <td>0.001115</td>
      <td>0.001228</td>
      <td>0.001632</td>
      <td>0.000966</td>
      <td>0.000573</td>
      <td>0.002283</td>
      <td>0.001219</td>
      <td>0.001228</td>
      <td>0.000808</td>
      <td>0.000633</td>
    </tr>
    <tr>
      <th>SSP</th>
      <td>0.002266</td>
      <td>0.001854</td>
      <td>0.004049</td>
      <td>0.005008</td>
      <td>0.006569</td>
      <td>0.006387</td>
      <td>0.003098</td>
      <td>0.006659</td>
      <td>0.005422</td>
      <td>0.005068</td>
      <td>...</td>
      <td>0.005094</td>
      <td>0.004550</td>
      <td>0.003653</td>
      <td>0.002661</td>
      <td>0.001400</td>
      <td>0.007734</td>
      <td>0.003624</td>
      <td>0.003746</td>
      <td>0.003847</td>
      <td>0.001676</td>
    </tr>
    <tr>
      <th>PSA</th>
      <td>0.000587</td>
      <td>0.000375</td>
      <td>0.001271</td>
      <td>0.001487</td>
      <td>0.002471</td>
      <td>0.002089</td>
      <td>0.000908</td>
      <td>0.002590</td>
      <td>0.001764</td>
      <td>0.001473</td>
      <td>...</td>
      <td>0.001907</td>
      <td>0.001596</td>
      <td>0.000982</td>
      <td>0.000785</td>
      <td>0.000489</td>
      <td>0.002776</td>
      <td>0.001100</td>
      <td>0.001303</td>
      <td>0.001166</td>
      <td>0.000542</td>
    </tr>
    <tr>
      <th>EXC</th>
      <td>0.000593</td>
      <td>0.000582</td>
      <td>0.000139</td>
      <td>0.001692</td>
      <td>0.001358</td>
      <td>0.001494</td>
      <td>0.000764</td>
      <td>0.001073</td>
      <td>0.001441</td>
      <td>0.002299</td>
      <td>...</td>
      <td>0.000869</td>
      <td>0.001177</td>
      <td>0.002093</td>
      <td>0.001088</td>
      <td>0.000540</td>
      <td>0.001978</td>
      <td>0.001282</td>
      <td>0.001268</td>
      <td>0.000946</td>
      <td>0.000684</td>
    </tr>
    <tr>
      <th>TKR</th>
      <td>0.002336</td>
      <td>0.001715</td>
      <td>0.003784</td>
      <td>0.006036</td>
      <td>0.005664</td>
      <td>0.006354</td>
      <td>0.003415</td>
      <td>0.005583</td>
      <td>0.005571</td>
      <td>0.006350</td>
      <td>...</td>
      <td>0.004735</td>
      <td>0.004583</td>
      <td>0.004538</td>
      <td>0.002921</td>
      <td>0.001276</td>
      <td>0.006793</td>
      <td>0.003860</td>
      <td>0.003784</td>
      <td>0.004502</td>
      <td>0.001842</td>
    </tr>
    <tr>
      <th>CMA</th>
      <td>0.001344</td>
      <td>0.001295</td>
      <td>0.001845</td>
      <td>0.002160</td>
      <td>0.005333</td>
      <td>0.003587</td>
      <td>0.000571</td>
      <td>0.004590</td>
      <td>0.003306</td>
      <td>0.002322</td>
      <td>...</td>
      <td>0.003442</td>
      <td>0.002921</td>
      <td>0.001735</td>
      <td>0.001532</td>
      <td>0.001163</td>
      <td>0.005583</td>
      <td>0.002307</td>
      <td>0.002628</td>
      <td>0.001271</td>
      <td>0.000992</td>
    </tr>
    <tr>
      <th>ORCL</th>
      <td>0.001463</td>
      <td>0.001120</td>
      <td>0.005648</td>
      <td>0.003355</td>
      <td>0.002382</td>
      <td>0.005814</td>
      <td>0.005325</td>
      <td>0.002873</td>
      <td>0.003138</td>
      <td>0.003120</td>
      <td>...</td>
      <td>0.002970</td>
      <td>0.002076</td>
      <td>0.001345</td>
      <td>0.002572</td>
      <td>0.000397</td>
      <td>0.003286</td>
      <td>0.002215</td>
      <td>0.001442</td>
      <td>0.005801</td>
      <td>0.000575</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>0.002326</td>
      <td>0.001762</td>
      <td>0.005706</td>
      <td>0.005056</td>
      <td>0.005223</td>
      <td>0.007390</td>
      <td>0.004990</td>
      <td>0.004663</td>
      <td>0.004978</td>
      <td>0.005327</td>
      <td>...</td>
      <td>0.004545</td>
      <td>0.003689</td>
      <td>0.003303</td>
      <td>0.003438</td>
      <td>0.001085</td>
      <td>0.006578</td>
      <td>0.003729</td>
      <td>0.003037</td>
      <td>0.006080</td>
      <td>0.001376</td>
    </tr>
    <tr>
      <th>RSG</th>
      <td>0.001003</td>
      <td>0.000921</td>
      <td>0.000682</td>
      <td>0.002150</td>
      <td>0.002774</td>
      <td>0.002294</td>
      <td>0.000657</td>
      <td>0.002560</td>
      <td>0.002341</td>
      <td>0.002447</td>
      <td>...</td>
      <td>0.001886</td>
      <td>0.002019</td>
      <td>0.002048</td>
      <td>0.001343</td>
      <td>0.000886</td>
      <td>0.003109</td>
      <td>0.001744</td>
      <td>0.001894</td>
      <td>0.001174</td>
      <td>0.000928</td>
    </tr>
    <tr>
      <th>ACAS</th>
      <td>0.001850</td>
      <td>0.001227</td>
      <td>0.003752</td>
      <td>0.004207</td>
      <td>0.006490</td>
      <td>0.006028</td>
      <td>0.002795</td>
      <td>0.006302</td>
      <td>0.004812</td>
      <td>0.004325</td>
      <td>...</td>
      <td>0.004970</td>
      <td>0.004144</td>
      <td>0.002893</td>
      <td>0.002542</td>
      <td>0.001386</td>
      <td>0.007465</td>
      <td>0.003257</td>
      <td>0.003463</td>
      <td>0.003757</td>
      <td>0.001524</td>
    </tr>
    <tr>
      <th>AGN</th>
      <td>0.001099</td>
      <td>0.001006</td>
      <td>0.001366</td>
      <td>0.001444</td>
      <td>0.002254</td>
      <td>0.002870</td>
      <td>0.001644</td>
      <td>0.002192</td>
      <td>0.001956</td>
      <td>0.001637</td>
      <td>...</td>
      <td>0.001569</td>
      <td>0.001483</td>
      <td>0.001367</td>
      <td>0.002000</td>
      <td>0.001149</td>
      <td>0.002803</td>
      <td>0.001711</td>
      <td>0.001543</td>
      <td>0.002240</td>
      <td>0.000896</td>
    </tr>
    <tr>
      <th>MMM</th>
      <td>0.001204</td>
      <td>0.000869</td>
      <td>0.001750</td>
      <td>0.002669</td>
      <td>0.003007</td>
      <td>0.003105</td>
      <td>0.001392</td>
      <td>0.002660</td>
      <td>0.002669</td>
      <td>0.002828</td>
      <td>...</td>
      <td>0.002331</td>
      <td>0.002183</td>
      <td>0.001986</td>
      <td>0.001550</td>
      <td>0.000773</td>
      <td>0.003428</td>
      <td>0.001941</td>
      <td>0.001872</td>
      <td>0.002150</td>
      <td>0.000925</td>
    </tr>
    <tr>
      <th>ETFC</th>
      <td>0.003105</td>
      <td>0.002268</td>
      <td>0.009005</td>
      <td>0.006920</td>
      <td>0.007448</td>
      <td>0.010182</td>
      <td>0.006886</td>
      <td>0.007719</td>
      <td>0.007088</td>
      <td>0.006264</td>
      <td>...</td>
      <td>0.007030</td>
      <td>0.005448</td>
      <td>0.003063</td>
      <td>0.003941</td>
      <td>0.001128</td>
      <td>0.008458</td>
      <td>0.004577</td>
      <td>0.003929</td>
      <td>0.008323</td>
      <td>0.001550</td>
    </tr>
    <tr>
      <th>CAR</th>
      <td>0.004852</td>
      <td>0.003310</td>
      <td>0.009505</td>
      <td>0.010870</td>
      <td>0.012537</td>
      <td>0.013683</td>
      <td>0.007244</td>
      <td>0.012337</td>
      <td>0.010987</td>
      <td>0.010677</td>
      <td>...</td>
      <td>0.010376</td>
      <td>0.008964</td>
      <td>0.006950</td>
      <td>0.005744</td>
      <td>0.002601</td>
      <td>0.014735</td>
      <td>0.007397</td>
      <td>0.007085</td>
      <td>0.009634</td>
      <td>0.003375</td>
    </tr>
    <tr>
      <th>MDR</th>
      <td>0.002036</td>
      <td>0.001430</td>
      <td>0.003367</td>
      <td>0.006595</td>
      <td>0.004608</td>
      <td>0.006113</td>
      <td>0.004006</td>
      <td>0.004839</td>
      <td>0.005388</td>
      <td>0.007301</td>
      <td>...</td>
      <td>0.004224</td>
      <td>0.004428</td>
      <td>0.005406</td>
      <td>0.002950</td>
      <td>0.001035</td>
      <td>0.006071</td>
      <td>0.003800</td>
      <td>0.003716</td>
      <td>0.004779</td>
      <td>0.001863</td>
    </tr>
    <tr>
      <th>NOV</th>
      <td>0.001773</td>
      <td>0.000980</td>
      <td>0.003748</td>
      <td>0.006711</td>
      <td>0.002866</td>
      <td>0.005861</td>
      <td>0.004929</td>
      <td>0.003018</td>
      <td>0.004598</td>
      <td>0.007619</td>
      <td>...</td>
      <td>0.003310</td>
      <td>0.003525</td>
      <td>0.005547</td>
      <td>0.002758</td>
      <td>0.000429</td>
      <td>0.004892</td>
      <td>0.003388</td>
      <td>0.002848</td>
      <td>0.005442</td>
      <td>0.001575</td>
    </tr>
    <tr>
      <th>PCH</th>
      <td>0.001594</td>
      <td>0.001248</td>
      <td>0.002743</td>
      <td>0.003597</td>
      <td>0.003976</td>
      <td>0.004192</td>
      <td>0.002075</td>
      <td>0.004064</td>
      <td>0.003670</td>
      <td>0.003503</td>
      <td>...</td>
      <td>0.003285</td>
      <td>0.003036</td>
      <td>0.002351</td>
      <td>0.001836</td>
      <td>0.000907</td>
      <td>0.004424</td>
      <td>0.002428</td>
      <td>0.002433</td>
      <td>0.002844</td>
      <td>0.001129</td>
    </tr>
    <tr>
      <th>BAX</th>
      <td>0.000993</td>
      <td>0.001134</td>
      <td>0.001334</td>
      <td>0.001201</td>
      <td>0.002076</td>
      <td>0.002379</td>
      <td>0.001281</td>
      <td>0.002048</td>
      <td>0.001755</td>
      <td>0.001305</td>
      <td>...</td>
      <td>0.001382</td>
      <td>0.001315</td>
      <td>0.001161</td>
      <td>0.001473</td>
      <td>0.000849</td>
      <td>0.002530</td>
      <td>0.001436</td>
      <td>0.001308</td>
      <td>0.001540</td>
      <td>0.000647</td>
    </tr>
    <tr>
      <th>JCI</th>
      <td>0.001866</td>
      <td>0.001478</td>
      <td>0.003918</td>
      <td>0.004302</td>
      <td>0.005489</td>
      <td>0.005675</td>
      <td>0.002842</td>
      <td>0.005186</td>
      <td>0.004651</td>
      <td>0.004336</td>
      <td>...</td>
      <td>0.008705</td>
      <td>0.003846</td>
      <td>0.002668</td>
      <td>0.002468</td>
      <td>0.001110</td>
      <td>0.005876</td>
      <td>0.003151</td>
      <td>0.003153</td>
      <td>0.003925</td>
      <td>0.001280</td>
    </tr>
    <tr>
      <th>SWK</th>
      <td>0.001834</td>
      <td>0.001464</td>
      <td>0.002949</td>
      <td>0.004351</td>
      <td>0.004780</td>
      <td>0.004862</td>
      <td>0.002246</td>
      <td>0.004573</td>
      <td>0.004379</td>
      <td>0.004459</td>
      <td>...</td>
      <td>0.003846</td>
      <td>0.006821</td>
      <td>0.003047</td>
      <td>0.002232</td>
      <td>0.001084</td>
      <td>0.005213</td>
      <td>0.002990</td>
      <td>0.003019</td>
      <td>0.003254</td>
      <td>0.001360</td>
    </tr>
    <tr>
      <th>DVN</th>
      <td>0.001465</td>
      <td>0.001073</td>
      <td>0.001776</td>
      <td>0.005067</td>
      <td>0.003223</td>
      <td>0.004039</td>
      <td>0.002495</td>
      <td>0.002741</td>
      <td>0.003777</td>
      <td>0.006108</td>
      <td>...</td>
      <td>0.002668</td>
      <td>0.003047</td>
      <td>0.008892</td>
      <td>0.001957</td>
      <td>0.000568</td>
      <td>0.004821</td>
      <td>0.002885</td>
      <td>0.002703</td>
      <td>0.002847</td>
      <td>0.001392</td>
    </tr>
    <tr>
      <th>TMO</th>
      <td>0.001725</td>
      <td>0.001628</td>
      <td>0.003202</td>
      <td>0.002811</td>
      <td>0.002946</td>
      <td>0.004611</td>
      <td>0.003106</td>
      <td>0.002847</td>
      <td>0.003135</td>
      <td>0.002894</td>
      <td>...</td>
      <td>0.002468</td>
      <td>0.002232</td>
      <td>0.001957</td>
      <td>0.005828</td>
      <td>0.001166</td>
      <td>0.003563</td>
      <td>0.002517</td>
      <td>0.002029</td>
      <td>0.003931</td>
      <td>0.001043</td>
    </tr>
    <tr>
      <th>PEP</th>
      <td>0.000972</td>
      <td>0.000898</td>
      <td>0.000737</td>
      <td>0.000827</td>
      <td>0.001755</td>
      <td>0.001651</td>
      <td>0.000404</td>
      <td>0.001674</td>
      <td>0.001402</td>
      <td>0.000642</td>
      <td>...</td>
      <td>0.001110</td>
      <td>0.001084</td>
      <td>0.000568</td>
      <td>0.001166</td>
      <td>0.002153</td>
      <td>0.001812</td>
      <td>0.001115</td>
      <td>0.001030</td>
      <td>0.001018</td>
      <td>0.000644</td>
    </tr>
    <tr>
      <th>LNC</th>
      <td>0.002767</td>
      <td>0.002289</td>
      <td>0.004472</td>
      <td>0.005794</td>
      <td>0.008175</td>
      <td>0.007721</td>
      <td>0.003400</td>
      <td>0.007106</td>
      <td>0.006352</td>
      <td>0.006455</td>
      <td>...</td>
      <td>0.005876</td>
      <td>0.005213</td>
      <td>0.004821</td>
      <td>0.003563</td>
      <td>0.001812</td>
      <td>0.016605</td>
      <td>0.004683</td>
      <td>0.004602</td>
      <td>0.004586</td>
      <td>0.002062</td>
    </tr>
    <tr>
      <th>EMR</th>
      <td>0.001863</td>
      <td>0.001655</td>
      <td>0.002989</td>
      <td>0.003777</td>
      <td>0.004011</td>
      <td>0.004788</td>
      <td>0.002591</td>
      <td>0.003566</td>
      <td>0.003864</td>
      <td>0.004048</td>
      <td>...</td>
      <td>0.003151</td>
      <td>0.002990</td>
      <td>0.002885</td>
      <td>0.002517</td>
      <td>0.001115</td>
      <td>0.004683</td>
      <td>0.004656</td>
      <td>0.002626</td>
      <td>0.003509</td>
      <td>0.001249</td>
    </tr>
    <tr>
      <th>MLM</th>
      <td>0.001482</td>
      <td>0.001333</td>
      <td>0.002185</td>
      <td>0.003399</td>
      <td>0.004223</td>
      <td>0.004047</td>
      <td>0.001729</td>
      <td>0.003761</td>
      <td>0.003627</td>
      <td>0.003746</td>
      <td>...</td>
      <td>0.003153</td>
      <td>0.003019</td>
      <td>0.002703</td>
      <td>0.002029</td>
      <td>0.001030</td>
      <td>0.004602</td>
      <td>0.002626</td>
      <td>0.006714</td>
      <td>0.002541</td>
      <td>0.001150</td>
    </tr>
    <tr>
      <th>CCI</th>
      <td>0.002324</td>
      <td>0.001848</td>
      <td>0.006565</td>
      <td>0.005176</td>
      <td>0.003393</td>
      <td>0.007738</td>
      <td>0.006626</td>
      <td>0.003953</td>
      <td>0.004728</td>
      <td>0.005082</td>
      <td>...</td>
      <td>0.003925</td>
      <td>0.003254</td>
      <td>0.002847</td>
      <td>0.003931</td>
      <td>0.001018</td>
      <td>0.004586</td>
      <td>0.003509</td>
      <td>0.002541</td>
      <td>0.020334</td>
      <td>0.001265</td>
    </tr>
    <tr>
      <th>NU</th>
      <td>0.000972</td>
      <td>0.000682</td>
      <td>0.000827</td>
      <td>0.001782</td>
      <td>0.001667</td>
      <td>0.001823</td>
      <td>0.000725</td>
      <td>0.001647</td>
      <td>0.001701</td>
      <td>0.001747</td>
      <td>...</td>
      <td>0.001280</td>
      <td>0.001360</td>
      <td>0.001392</td>
      <td>0.001043</td>
      <td>0.000644</td>
      <td>0.002062</td>
      <td>0.001249</td>
      <td>0.001150</td>
      <td>0.001265</td>
      <td>0.002606</td>
    </tr>
  </tbody>
</table>
<p>50 rows × 50 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>If we compare the in-sample Variance of our minimum variance portfolios for</p>
<ul>
<li><p>The unrestricted case</p></li>
<li><p>The single-factor covariance</p></li>
<li><p>The multi-factor covariance</p></li>
</ul>
</li>
<li><p>which one will have lowest variance? What will have the highest?</p></li>
<li><p>Now split the sample in two. Repeat the covariance estimation procedure for each of these approaches for the first half of the sample</p></li>
<li><p>Now use the weights to compute the variance of each of the portfolios in the second half</p></li>
<li><p>Is the order likely to change? Why? Why not?</p></li>
</ul>
</section>
<section id="application-how-will-your-portfolio-risk-change-as-you-add-positions">
<h2>Application: How will your portfolio risk change as you add positions<a class="headerlink" href="#application-how-will-your-portfolio-risk-change-as-you-add-positions" title="Permalink to this heading">#</a></h2>
<p>You have portfolio <span class="math notranslate nohighlight">\(X_0\)</span> and you want to sell w of your positions to invest in a fund with portfolio <span class="math notranslate nohighlight">\(X_1\)</span>. How your portfolio variance will change as a function of you reallocation?</p>
<ul class="simple">
<li><p>The answer is simple</p></li>
</ul>
<div class="math notranslate nohighlight">
\[Var(wX_1R_t+(1-w)X_0R_t)-Var(X_0R_t)\]</div>
<ul class="simple">
<li><p>But also kind of misleading since you might not have good data to estimate the variance of the new portfolio</p></li>
<li><p>Now if you know each portfolio factor betas,<span class="math notranslate nohighlight">\(\beta_0=X_0&#64;B\)</span> and <span class="math notranslate nohighlight">\(\beta_1=X_1&#64;B\)</span> , and at least one of this portfolio is large and well diversified, then for small tilts, i.e. <span class="math notranslate nohighlight">\(w\)</span> small, we have</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\frac{Var(wX_1R_t+(1-w)X_0R_t)-Var(X_0R_t)}{\Delta w} =\beta_1Var(F)\beta_0'\]</div>
<ul class="simple">
<li><p>The fact that one is well diversified just means that you can ignore the covariance-terms of the portfolios asset specific risks</p></li>
<li><p>So you see above why a large pool of money when allocating money to an active manager will want to regulate their factor exposure</p></li>
<li><p>funds with similar volatilities will be perceived as very different risks depending on how the exposure of portfolio relates to the exposure of the fund</p></li>
</ul>
</section>
<section id="performance-attribution">
<h2>Performance Attribution<a class="headerlink" href="#performance-attribution" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>We can use factor models to decompose a manager strategy</p></li>
<li><p>What explains their returns?</p></li>
<li><p>tilts they have?  What kind of stocks they like?</p></li>
</ul>
<section id="application-what-does-cathie-wood-likes-test">
<h3>Application: What does Cathie Wood  Likes ? TEST<a class="headerlink" href="#application-what-does-cathie-wood-likes-test" title="Permalink to this heading">#</a></h3>
<p><img alt="fig" src="../../_images/CW_image.jfif" /></p>
<p>Cathie Wood is a renowned stock-picker and the founder of ARK Invest, which manages around 60 billion in assets and invests in innovative technologies such as self-driving cars and genomics. She gained fame for her success in the male-dominated world of investing, her persuasive investment arguments, and her proven track record in the stock market. Prior to founding ARK Invest, she gained experience at The Capital Group, Jennison Associates, and AllianceBernstein, and co-founded Tupelo Capital Management, a hedge fund. Wood is known for her unconventional investment strategies and her advocacy for investing in disruptive technologies, which has garnered her a large following in the investing world. Her estimated net worth is around $250 million.</p>
<p>Citations:
<a class="reference external" href="https://www.nytimes.com/2021/08/22/business/cathie-wood-ark-stocks.html">https://www.nytimes.com/2021/08/22/business/cathie-wood-ark-stocks.html</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_temp</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="c1"># select the columns to use as factors</span>
<span class="n">Factors</span><span class="o">=</span><span class="n">_temp</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;BRK&#39;</span><span class="p">,</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;ARKK&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Factors</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ArK</span><span class="o">=</span><span class="n">_temp</span><span class="o">.</span><span class="n">ARKK</span><span class="o">-</span><span class="n">_temp</span><span class="o">.</span><span class="n">RF</span>
</pre></div>
</div>
</div>
</div>
<p>What are these factors?</p>
<ul class="simple">
<li><p>HML is the value strategy that buys high book to market firms and sell low book to market firms</p></li>
<li><p>SMB is a size strategy that buys firms with low market capitalization and sell firms with high market capitalizations</p></li>
<li><p>RmW is the strategy that buys firms with high gross profitability and sell firms with low gross profitability</p></li>
<li><p>CmA is the strategy that buys firms that are investing little (low CAPEX) and sell firms that are investing a lot (high CAPEX)</p></li>
<li><p>MOM is the momentum strategy that buy stocks that did well in the last 12 months and short the ones that did poorly</p></li>
</ul>
<p>We will discuss more later</p>
<p>for now just think of them as important trading strategies that practicioners know</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">Factors</span><span class="p">)</span>
<span class="n">y</span><span class="o">=</span> <span class="n">ArK</span>
<span class="n">results</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>            <td>y</td>        <th>  R-squared:         </th>  <td>   0.781</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th>  <td>   0.780</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th>  <td>   1069.</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Fri, 02 Feb 2024</td> <th>  Prob (F-statistic):</th>   <td>  0.00</td>  
</tr>
<tr>
  <th>Time:</th>                 <td>09:59:39</td>     <th>  Log-Likelihood:    </th>  <td>  5908.9</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td>  1804</td>      <th>  AIC:               </th> <td>-1.180e+04</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>  1797</td>      <th>  BIC:               </th> <td>-1.177e+04</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     6</td>      <th>                     </th>      <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>      <td> </td>    
</tr>
</table>
<table class="simpletable">
<tr>
     <td></td>       <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>  <td>    0.0004</td> <td>    0.000</td> <td>    1.821</td> <td> 0.069</td> <td>-3.03e-05</td> <td>    0.001</td>
</tr>
<tr>
  <th>Mkt-RF</th> <td>    1.1736</td> <td>    0.020</td> <td>   58.714</td> <td> 0.000</td> <td>    1.134</td> <td>    1.213</td>
</tr>
<tr>
  <th>SMB</th>    <td>    0.6944</td> <td>    0.037</td> <td>   18.984</td> <td> 0.000</td> <td>    0.623</td> <td>    0.766</td>
</tr>
<tr>
  <th>HML</th>    <td>   -0.6521</td> <td>    0.038</td> <td>  -16.938</td> <td> 0.000</td> <td>   -0.728</td> <td>   -0.577</td>
</tr>
<tr>
  <th>RMW</th>    <td>   -0.9037</td> <td>    0.054</td> <td>  -16.883</td> <td> 0.000</td> <td>   -1.009</td> <td>   -0.799</td>
</tr>
<tr>
  <th>CMA</th>    <td>   -0.5034</td> <td>    0.071</td> <td>   -7.129</td> <td> 0.000</td> <td>   -0.642</td> <td>   -0.365</td>
</tr>
<tr>
  <th>Mom   </th> <td>   -0.0397</td> <td>    0.025</td> <td>   -1.559</td> <td> 0.119</td> <td>   -0.090</td> <td>    0.010</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>55.310</td> <th>  Durbin-Watson:     </th> <td>   2.135</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td> <th>  Jarque-Bera (JB):  </th> <td> 128.873</td>
</tr>
<tr>
  <th>Skew:</th>          <td> 0.116</td> <th>  Prob(JB):          </th> <td>1.04e-28</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 4.289</td> <th>  Cond. No.          </th> <td>    345.</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<ul class="simple">
<li><p>How much can we explain of ARKK return behavior?</p></li>
<li><p>What kind of stocks CW likes?</p></li>
<li><p>How much of her portfolio variance comes from market exposure alone?</p></li>
<li><p>If you were to construct a replicating portfolio of her fund</p></li>
<li><p>What would be the volatility of your residual risk?</p></li>
</ul>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="tracking-portfolios-and-tracking-error">
<h1>Tracking portfolios and Tracking error<a class="headerlink" href="#tracking-portfolios-and-tracking-error" title="Permalink to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="benchmarking">
<h1>Benchmarking<a class="headerlink" href="#benchmarking" title="Permalink to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="factor-models-as-models-of-expected-returns">
<h1>Factor Models as Models of Expected Returns<a class="headerlink" href="#factor-models-as-models-of-expected-returns" title="Permalink to this heading">#</a></h1>
<p>So far we had</p>
<div class="math notranslate nohighlight">
\[r_t^i=b_{i,1}f_t^1+b_{i,2}f_t^2+b_{i,3}f_t^3+...+b_{i,M}f_t^M+u_{i,t}\]</div>
<ul class="simple">
<li><p>Where we made assumptions about how <span class="math notranslate nohighlight">\(u_{i,t}\)</span> was uncorrelated across assets (i.e. across i)</p></li>
<li><p>But we made NO assumption about any risk-premium in <span class="math notranslate nohighlight">\(u_{i,t}\)</span>, i.e <span class="math notranslate nohighlight">\(E[u_{i,t}]\)</span> does not need to be equal to zero</p></li>
<li><p>In fact we added a constant when we estimated the model to keep this parameter free</p></li>
<li><p>A model of expected returns is exactly the opposite</p></li>
<li><p>We will relax the assumption that the <span class="math notranslate nohighlight">\(u_{i,t}\)</span> are uncorrelated–they will be free to do whatever, but</p></li>
<li><p>We will impose that they have no risk-premium, i.e. <span class="math notranslate nohighlight">\(E[u_{i,t}]=0\)</span> for any asset <span class="math notranslate nohighlight">\(i\)</span></p></li>
<li><p>If this restriction is true, when we take expectations in both sides we get</p></li>
</ul>
<div class="math notranslate nohighlight">
\[E[r_t^i]=\sum_j^M b_{i,j}E[f_t^j]+E[u_{i,t}]=\sum_j^M b_{i,j}E[f_t^j]\]</div>
<ul class="simple">
<li><p>Thus the exposures together with the factor risk-premium are all we need to know to know the expected return of a given asset</p></li>
<li><p>It means that if the model is right ( it never is! It is a model!An approximation) All the premium that there is has to be harvested from these factors alone</p></li>
<li><p>It also means that any portfolio that has any risk <span class="math notranslate nohighlight">\(\sigma(u_{i,t})&gt;0\)</span> is not mean-variance efficient</p></li>
<li><p>Why? Because this <span class="math notranslate nohighlight">\(\sigma(u_{i,t})\)</span> adds vol, but does not add premium so it must have a lower Sharpe ratio than a portfolio that has the same loadings but no idio risk</p></li>
<li><p>It also tell us that a portfolio of the factors spam (meaning you can combine them to obtaim) the maximum Sharpe Ratio portfolio</p></li>
<li><p>Just as before, our model is a linear regression with a very important restriction–the intercept must be zero for the model to be right</p></li>
</ul>
<section id="alpha">
<h2>Alpha<a class="headerlink" href="#alpha" title="Permalink to this heading">#</a></h2>
<p>for clarity lets focus on the single factor case M=1. Say we run the regression</p>
<div class="math notranslate nohighlight">
\[r^i_t=\alpha_i +\beta_{i}f_t +\epsilon_{i,t}\]</div>
<ul class="simple">
<li><p>Then this relation predicts that the intercept, the alpha, should be zero</p></li>
<li><p>It is important here that both the test assets and the reference portfolios are all <strong>excess returns</strong>. This makes the test really simple. If you use returns instead the prediction about the intercept will be different because of the risk-free rate</p></li>
<li><p>We refer to these assets on the Left Hand Side of the regression as <strong>Test Assets</strong> and the asset on the right as the <strong>model</strong>, which is the candidate factor model ( that can contain one or many more factors)</p></li>
<li><p>This means that we can use this to test whether a new strategy adds value relative to another strategy (i.e. the model).</p></li>
<li><p>If the model is “right” than we will fail to reject that the alphas are zero, i.e. the relationship between average returns and factor exposures and factor premiums hold.</p></li>
<li><p>Why alpha=0 is so special? Because it tells us that the expected return of any of these assets can be captured by varying the exposure to  the factor with the minimum increase in risk possible</p></li>
</ul>
<p><strong>What adding value means?</strong> It means that the test portfolio can increase the  sharpe ratio of the maximum sharpe ratio portfolio spanned by the factors. So it means that this asset increases the opportunity set of an investor that has access to the factors</p>
<p><strong>CAPM prediction: Market portfolio is the mean-varaince efficient portfolio</strong></p>
<ul>
<li><p>The most used reference portfolio is the market portfolio</p></li>
<li><p>So we will do our first alpha test with respect to the market</p></li>
<li><p>The CAPM holds for a set of assets i=1…N if and only if</p>
<div class="math notranslate nohighlight">
\[E[r_{i,t}] =\alpha_i+\beta_{i,MKT} E[r_{t}^{MKT}]\]</div>
<p>with <span class="math notranslate nohighlight">\(\alpha_i=0\)</span> for all assets  i=1…N</p>
<p>Where both <span class="math notranslate nohighlight">\(r_{i,t}\)</span> and <span class="math notranslate nohighlight">\(r_{t}^{MKT}\)</span> are excess returns</p>
</li>
<li><p>So if you put any other factor= instead of the market excess return, then you are not testing the CAPM. The CAPM is a specific model that predicts that the market is tangency–in fact the model predicts that is the excess return on the total wealth portfolio–so it is really untestable!</p></li>
</ul>
<p>It is very important here that is all about expectations, not at all about realized returns.</p>
<p>Being MVE does <strong>NOT</strong> mean that your realized returns should explain all the other realized returns. The idio risk can be quite large and can even be correlated across assets!</p>
<p>Instead, it means that the betas of the asset with the factor should explain the expected return of the asset.</p>
<p>Of course, stuff happens, so even if your reference portfolio is in fact MVE portfolio under the true distribution, it will not be in any particular sample, so we will use statistics to tell us if the <span class="math notranslate nohighlight">\(\alpha\)</span> is different enough from zero.</p>
<p><strong>Why practitioners care about this? Beating the Model</strong></p>
<p>Practicioners use this to see if they can beat the CAPM (or any richer factor model), i.e. <strong>beat the market</strong>. Having an alpha–a postive intercept– means that you have an average return that is higher than your strategy market risk exposure would predict.</p>
<p>So if you are U of R  endowment, and a big shot hedge fund manager comes and pitch some fund with some large Sharpe ratio—all you should want to know is whether after you adjust for the exposures to the expected return factors that you already know, if this guys still has alpha.</p>
<p>His value added to you is only the alpha–not the entire Sharpe ratio</p>
<p>Why? Because the other stuff you already know how to harvest the premium</p>
</section>
<section id="testing-if-alpha-i-neq-0">
<h2>Testing  if <span class="math notranslate nohighlight">\(\alpha_i \neq 0\)</span><a class="headerlink" href="#testing-if-alpha-i-neq-0" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Our test will be agnostic on the direction.</p></li>
</ul>
<blockquote>
<div><p>Can a negative alpha be value enhancing? Is it likely to be value enhancing in the case of a hedge fund pitching the UofR endowment?</p>
</div></blockquote>
<ul class="simple">
<li><p>After running the regression with a free intercept you do a standard t-test</p></li>
</ul>
<div class="math notranslate nohighlight">
\[t=\frac{\alpha_i }{\sigma(\alpha_i)}\]</div>
<ul class="simple">
<li><p>We say</p></li>
</ul>
<ul class="simple">
<li><p>if <span class="math notranslate nohighlight">\(|t|\geq 1.64\)</span> there is a 10% chance that the factor is MVE</p></li>
<li><p>if <span class="math notranslate nohighlight">\(|t|\geq 1.96\)</span> there is a 5% chance that the factor is MVE</p></li>
<li><p>if <span class="math notranslate nohighlight">\(|t|\geq 2.1\)</span> there is a 2.5% chance that the factor is MVE</p></li>
<li><p>if <span class="math notranslate nohighlight">\(|t|\geq 2.6\)</span> there is a 1% chance that the factor is MVE</p></li>
</ul>
<ul class="simple">
<li><p>The Time-series regression asks the following question:</p></li>
</ul>
<blockquote>
<div><p>Can I replicate  the average return I get in asset/strategy <span class="math notranslate nohighlight">\(i\)</span> by investing in the factor/factors on the right?</p>
</div></blockquote>
<ul class="simple">
<li><p>It mean that you can do better by investing by adding asset <span class="math notranslate nohighlight">\(i\)</span> to your investment mix</p></li>
</ul>
<blockquote>
<div><p>Question: I show that Asset A has alpha with respect to Asset B. Does it mean that an investor should prefer asset A to asset B?</p>
</div></blockquote>
</section>
<section id="application-does-warren-buffet-beats-the-market">
<h2>Application: Does Warren Buffet beats the market?<a class="headerlink" href="#application-does-warren-buffet-beats-the-market" title="Permalink to this heading">#</a></h2>
<p><img alt="fig" src="../../_images/WB_image.jpg" /></p>
<p>Warren Buffett is the chairman and CEO of Berkshire Hathaway, a multinational conglomerate holding company. Berkshire Hathaway’s portfolio includes a diverse range of companies, but its five largest positions are in Apple Inc., Bank of America Corp, Chevron, The Coca-Cola Company, and American Express Company. Buffett is known for his extraordinary performance record and his transparent, straightforward investment model, which involves investing in large, blue-chip companies with strong balance sheets and attractive valuations. His investment strategy focuses on long-term investments and he is recognized for making significant new investments while also being unafraid to drop longtime holdings. As of 2022, Buffett’s largest holding was in Apple Inc., representing 41.76% of the equity portfolio, with an estimated gain of 246.02%. Berkshire Hathaway is a leading conglomerate due to Buffett’s business savvy and investing, with a high rate of return and a portfolio that continues to attract wide media attention and scrutiny.</p>
<p>Citations:
[1] <a class="reference external" href="https://en.wikipedia.org/wiki/Warren_Buffett">https://en.wikipedia.org/wiki/Warren_Buffett</a>
[2] <a class="reference external" href="https://www.berkshirehathaway.com">https://www.berkshirehathaway.com</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="n">x</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>
<span class="n">y</span><span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">BRK</span><span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">RF</span><span class="p">)</span>
<span class="n">results</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>            <td>y</td>        <th>  R-squared:         </th> <td>   0.256</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.256</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   2871.</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Fri, 02 Feb 2024</td> <th>  Prob (F-statistic):</th>  <td>  0.00</td>  
</tr>
<tr>
  <th>Time:</th>                 <td>09:40:51</td>     <th>  Log-Likelihood:    </th> <td> -13639.</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td>  8338</td>      <th>  AIC:               </th> <td>2.728e+04</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>  8336</td>      <th>  BIC:               </th> <td>2.730e+04</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>     <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>    
</tr>
</table>
<table class="simpletable">
<tr>
     <td></td>       <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>  <td>    0.0292</td> <td>    0.014</td> <td>    2.142</td> <td> 0.032</td> <td>    0.002</td> <td>    0.056</td>
</tr>
<tr>
  <th>Mkt-RF</th> <td>    0.6471</td> <td>    0.012</td> <td>   53.579</td> <td> 0.000</td> <td>    0.623</td> <td>    0.671</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>2301.572</td> <th>  Durbin-Watson:     </th> <td>   2.018</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>44382.694</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 0.837</td>  <th>  Prob(JB):          </th> <td>    0.00</td> 
</tr>
<tr>
  <th>Kurtosis:</th>       <td>14.178</td>  <th>  Cond. No.          </th> <td>    1.13</td> 
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<ul class="simple">
<li><p>what do we learn?</p></li>
<li><p>how to think about this alpha? Is it large?</p></li>
<li><p>Is it large economically?</p></li>
<li><p>is it large statistically?</p></li>
</ul>
<p>Now lets use a multi-factor model</p>
<p><strong>Which Multi-factor model?</strong></p>
<ol class="arabic simple">
<li><p>Fama French 3 factor model:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[E[R_t^i-R_t^f]=\beta_{i,mkt}E[R^{mkt}_t-R^f_t]+\beta_{i,smb}E[SmB_t]+\beta_{i,HmL}E[HmL_t]\]</div>
<ol class="arabic simple" start="2">
<li><p>Carhart 4 factor model:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[E[R_t^i-R_t^f]=\beta_{i,mkt}E[R^{mkt}_t-R^f_t]+\beta_{i,smb}E[SmB_t]+\beta_{i,HmL}E[HmL_t]+\beta_{i,WmL}E[WmL_t]\]</div>
<ol class="arabic simple" start="3">
<li><p>Fama French  5 factor model:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[E[R_t^i-R_t^f]=\beta_{i,mkt}E[R^{mkt}_t-R^f_t]+\beta_{i,smb}E[SmB_t]+\beta_{i,HmL}E[HmL_t]+\beta_{i,rmw}E[RmW_t]+\beta_{i,cma}E[CmA_t]\]</div>
<ol class="arabic simple" start="4">
<li><p>Fama French  5 factor model + Momentum:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[E[R_t^i-R_t^f]=\beta_{i,mkt}E[R^{mkt}_t-R^f_t]+\beta_{i,smb}E[SmB_t]+\beta_{i,HmL}E[HmL_t]+\beta_{i,rmw}E[RmW_t]+\beta_{i,cma}E[CmA_t]+\beta_{i,WmL}E[WmL_t]\]</div>
<p>These models are more or less on chronological order.</p>
<p>Most practicioners today would start with the 6 factor model and if they are dealing with non equity assets add a bunch of asset class specific factors that essentially mimic some of these factors in these spaces</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> 
<span class="n">Factors</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;BRK&#39;</span><span class="p">,</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;ARKK&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">Factors</span><span class="p">)</span>
<span class="n">y</span><span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">BRK</span><span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">RF</span>
<span class="n">results</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>            <td>y</td>        <th>  R-squared:         </th>  <td>   0.291</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th>  <td>   0.291</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th>  <td>   570.7</td> 
</tr>
<tr>
  <th>Date:</th>             <td>Fri, 02 Feb 2024</td> <th>  Prob (F-statistic):</th>   <td>  0.00</td>  
</tr>
<tr>
  <th>Time:</th>                 <td>09:42:06</td>     <th>  Log-Likelihood:    </th>  <td>  24961.</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td>  8338</td>      <th>  AIC:               </th> <td>-4.991e+04</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>  8331</td>      <th>  BIC:               </th> <td>-4.986e+04</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     6</td>      <th>                     </th>      <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>      <td> </td>    
</tr>
</table>
<table class="simpletable">
<tr>
     <td></td>       <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>  <td>    0.0003</td> <td>    0.000</td> <td>    2.295</td> <td> 0.022</td> <td> 4.46e-05</td> <td>    0.001</td>
</tr>
<tr>
  <th>Mkt-RF</th> <td>    0.6296</td> <td>    0.013</td> <td>   47.908</td> <td> 0.000</td> <td>    0.604</td> <td>    0.655</td>
</tr>
<tr>
  <th>SMB</th>    <td>   -0.1003</td> <td>    0.024</td> <td>   -4.236</td> <td> 0.000</td> <td>   -0.147</td> <td>   -0.054</td>
</tr>
<tr>
  <th>HML</th>    <td>    0.4461</td> <td>    0.027</td> <td>   16.835</td> <td> 0.000</td> <td>    0.394</td> <td>    0.498</td>
</tr>
<tr>
  <th>RMW</th>    <td>   -0.1677</td> <td>    0.032</td> <td>   -5.263</td> <td> 0.000</td> <td>   -0.230</td> <td>   -0.105</td>
</tr>
<tr>
  <th>CMA</th>    <td>   -0.0608</td> <td>    0.041</td> <td>   -1.469</td> <td> 0.142</td> <td>   -0.142</td> <td>    0.020</td>
</tr>
<tr>
  <th>Mom   </th> <td>    0.0338</td> <td>    0.017</td> <td>    2.000</td> <td> 0.045</td> <td>    0.001</td> <td>    0.067</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>2249.754</td> <th>  Durbin-Watson:     </th> <td>   2.032</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>45256.687</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 0.794</td>  <th>  Prob(JB):          </th> <td>    0.00</td> 
</tr>
<tr>
  <th>Kurtosis:</th>       <td>14.302</td>  <th>  Cond. No.          </th> <td>    338.</td> 
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<ul class="simple">
<li><p>what do we learn now? Did it make any difference?</p></li>
<li><p>what kind of stocks Warren likes?</p></li>
<li><p>What do we learn about Warren Investment style?</p></li>
<li><p>What do we learn about Warren specific stock picking skills?</p></li>
</ul>
</section>
<section id="appraisal-ratios">
<h2>Appraisal Ratios<a class="headerlink" href="#appraisal-ratios" title="Permalink to this heading">#</a></h2>
</section>
<section id="portable-alpha-and-hedged-portfolios">
<h2>Portable Alpha and Hedged Portfolios<a class="headerlink" href="#portable-alpha-and-hedged-portfolios" title="Permalink to this heading">#</a></h2>
</section>
<section id="multi-factor-theory">
<h2>Multi-factor: theory<a class="headerlink" href="#multi-factor-theory" title="Permalink to this heading">#</a></h2>
<p>What about the theory?</p>
<section id="it-is-the-capm-but-the-wealth-portfolio-is-not-the-stock-market">
<h3>IT is the CAPM, but the wealth portfolio is not the stock market<a class="headerlink" href="#it-is-the-capm-but-the-wealth-portfolio-is-not-the-stock-market" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>According to the  CAPM the Wealth portfolio is the tangency portfolio</p></li>
<li><p>The return on the wealth portfolio summarizes how Bad the times are</p></li>
<li><p>Assets that co-vary more with the market must earn higher returns</p></li>
<li><p>They pay poorly exactly when things are worse</p></li>
<li><p>What is the wealth portfolio? It is the portfolio that holds all assets in proportion to their value</p></li>
<li><p>We often use the equity market as a proxy for this, but that is not the CAPM</p></li>
<li><p>In a way that CAPM is untestable because it is impossible to construct the true wealth portfolio</p></li>
<li><p>The fact that we cannot really measure the returns of the total wealth portfolio gives us a reason to add other facts in additions to the returns to the equity market. Under this logic you add returns to other assets classes&gt;</p>
<ul>
<li><p>Real estate</p></li>
<li><p>Corporate debt</p></li>
<li><p>Human capital</p></li>
<li><p>Private equity</p></li>
<li><p>Venture Capital
-…</p></li>
</ul>
</li>
</ul>
<p>So you get:</p>
<div class="math notranslate nohighlight">
\[E[R_t^i-R_t^f]=\beta_{i,mkt}E[R^{mkt}_t-R^f_t]+\sum_a^A\beta_{i,a}E[R^{a}_t-R^f_t]\]</div>
<ul class="simple">
<li><p>where <span class="math notranslate nohighlight">\(a\)</span> are the different asset classes.</p></li>
<li><p>Sometimes people refer to these other hard to trade assets as “background risks”, basically risks that are you are exposed to that are not capture by your financial assets</p></li>
</ul>
</section>
<section id="icapm-intertemporal-capital-asset-pricing-model">
<h3>ICAPM: Intertemporal Capital Asset Pricing Model<a class="headerlink" href="#icapm-intertemporal-capital-asset-pricing-model" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Another way to rationalize additional  factors is to realize that the premium and the volatility of the market are time-varying.</p></li>
<li><p>This means that assets that allow you to hedge this investment opportunity set risk will be valuable</p>
<ul>
<li><p>For example, an asset that pays well when the market is more/less volatile or one that pays well when the expected returns of market going froward are higher/lower</p></li>
</ul>
</li>
<li><p>Under this logic, any strategy that is related to the market moments can also explain average returns on top of the marker beta</p></li>
<li><p>Sometimes people refer to the background risks discussed earlier in this framework as well. But in this case it is not about the moments of the market portfolio per se, but about correlation of the strategy with the background risks investors bear</p></li>
<li><p>The end result is the same</p></li>
</ul>
<div class="math notranslate nohighlight">
\[E[R_t^i-R_t^f]=\beta_{i,mkt}E[R^{mkt}_t-R^f_t]+\sum_{j=1}^J\beta_{i,j}E[Factor^j_t]\]</div>
<ul class="simple">
<li><p>but now these are “Factors” and do no need to be components of the total wealth</p></li>
<li><p>but these factors must still be excess returns, i.e. they must be strategies based on financial assets that have price zero</p></li>
</ul>
</section>
<section id="apt-arbitrage-pricing-theory">
<h3>APT: Arbitrage Pricing Theory<a class="headerlink" href="#apt-arbitrage-pricing-theory" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>This is probably the most popular and more flexible way to think about multi-factor models</p></li>
<li><p>but now the factors are motivated because the explain time-series variation in realized return</p></li>
<li><p>the idea is that if you have enough factors you explain enough of the variation in the returns of an asset that if the betas do no explain the average returns than an arbitrage opportunity wouldd open up</p></li>
<li><p>If you have a good enough model of RISK–then by arbitrage –you better have a good model of expected returns!</p></li>
<li><p>Essentially they idea is that if</p></li>
</ul>
<div class="math notranslate nohighlight">
\[R_t^i-R_t^f=\sum_{j=1}^J\beta_{i,j}Factor^j_t+u_{i,t}\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma(u)\)</span> is small , then</p>
<div class="math notranslate nohighlight">
\[E[R_t^i-R_t^f]\approx\sum_{j=1}^J\beta_{i,j}E[Factor^j_t]\]</div>
<ul class="simple">
<li><p>otherwise Sharpe ratio of going long/short the asset and short/long the model would be huge since</p></li>
</ul>
<div class="math notranslate nohighlight">
\[E[u_{i,t}]=E[R_t^i-R_t^f]-\sum_{j=1}^J\beta_{i,j}E[Factor^j_t]\]</div>
<p><strong>Three applications to evalauting asset managers</strong></p>
<p>We will do this in three steps</p>
<ol class="arabic simple">
<li><p>Get time-series of the factors in our factor model and the risk-free rate</p></li>
<li><p>For each application get the time-series return data of the asset  being evaluated</p></li>
<li><p>Merge with factor series</p></li>
<li><p>Convert the returns of the asset being evaluate to excess returns</p></li>
<li><p>Run a time-series regression of the asset excess returns on the relevant factors</p></li>
</ol>
<p><strong>Factors for our factor model</strong></p>
<ul class="simple">
<li><p>We will start by dowloading he Five factors from Fama Frency 5 factors model plus the momentum factor which is in separate data set</p></li>
<li><p>We of course could have constructed them ourselves as well, but this is obviously faster and less error prone</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/Finance"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Multi-factor models</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-a-multi-factor-model">Estimating a multi-factor model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application">Application</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reconstructing-the-co-variance-matrix">Reconstructing the co-variance matrix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-how-will-your-portfolio-risk-change-as-you-add-positions">Application: How will your portfolio risk change as you add positions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#performance-attribution">Performance Attribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#application-what-does-cathie-wood-likes-test">Application: What does Cathie Wood  Likes ? TEST</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#tracking-portfolios-and-tracking-error">Tracking portfolios and Tracking error</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#benchmarking">Benchmarking</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-models-as-models-of-expected-returns">Factor Models as Models of Expected Returns</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha">Alpha</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-if-alpha-i-neq-0">Testing  if <span class="math notranslate nohighlight">\(\alpha_i \neq 0\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-does-warren-buffet-beats-the-market">Application: Does Warren Buffet beats the market?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#appraisal-ratios">Appraisal Ratios</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#portable-alpha-and-hedged-portfolios">Portable Alpha and Hedged Portfolios</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-factor-theory">Multi-factor: theory</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#it-is-the-capm-but-the-wealth-portfolio-is-not-the-stock-market">IT is the CAPM, but the wealth portfolio is not the stock market</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#icapm-intertemporal-capital-asset-pricing-model">ICAPM: Intertemporal Capital Asset Pricing Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#apt-arbitrage-pricing-theory">APT: Arbitrage Pricing Theory</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alan Moreira
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2021 Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>