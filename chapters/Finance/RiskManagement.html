
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>15. Risk Management &#8212; Quantitative Investing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css?v=c2893119" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/Finance/RiskManagement';</script>
    <link rel="canonical" href="https://amoreira2.github.io/Fin418/chapters/Finance/RiskManagement.html" />
    <link rel="icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="16. Levering up and Shorting" href="LeverageandShorting.html" />
    <link rel="prev" title="14.9. 📊 Interpreting Factor Models" href="InterpretingFactorModels.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/figuremain2.jpg" class="logo__image only-light" alt="Quantitative Investing - Home"/>
    <script>document.write(`<img src="../../_static/figuremain2.jpg" class="logo__image only-dark" alt="Quantitative Investing - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/what-is-quant-investing.html">1. What is Quantitative Investing?</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/statistical-techniques.html">1.1. Statistical Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/computational-tools.html">1.2. Computational tools</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/getting_started.html">2. Getting Started</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/cloud_setup.html">2.3. Cloud Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/local_install.html">2.4. Local installation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../essentials/intro.html">3. Python Essentials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../essentials/basics.html">3.1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/collections.html">3.2. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/numpy.html">3.3. Numpy</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../essentials/introtopandas.html">3.4. Pandas</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/the_index.html">3.4.3. Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/timeseries.html">3.4.4. Time-Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/reshape.html">3.4.5. Reshape</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/merge.html">3.4.6. Merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/groupby.html">3.4.7. Group-by</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/matplotlib.html">3.4.8. Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/data_clean.html">3.4.9. Cleaning data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/storage_formats.html">3.4.10. Data Storage</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/control_flow.html">3.5. Flow control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/functions.html">3.6. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/plotting.html">3.7. Plotting</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="IntrotoReturns.html">4. Introduction to Asset Returns</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="TheChoiceofFrequency.html">4.4. The Choice of Frequency and Annualization of Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="UsingAPI.html">4.5. Data APIs</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="FactorModels.html">5. Factor Models</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="PortfolioMath.html">6. Portfolios</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../scientific/linear_algebra1.html">6.5. Linear Algebra Review</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="CapitalAllocationI.html">7. Capital Allocation</a></li>
<li class="toctree-l1"><a class="reference internal" href="FactorModelEstimation.html">8. Factor Model Estimation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Timing.html">9. Timing Strategies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="MarketTiming.html">9.1. Expected Returns Timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="Volatilitytiming.html">9.2. Volatility Timing</a></li>

</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="crosssectionalequitystrategies.html">10. Cross-Sectional Equity Strategies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Momentum.html">10.3. Momentum factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="Factors.html">10.4. An overview of factors</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="CapitalAllocationII.html">11. Capital Allocation II</a></li>
<li class="toctree-l1"><a class="reference internal" href="Performance_evaluation.html">12. Performance Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning.html">13. Machine Learning in Finance</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="MultiFactorModels.html">14. Multi Factor Models</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="InterpretingFactorModels.html">14.9. 📊 Interpreting Factor Models</a></li>


</ul>
</details></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">15. Risk Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="LeverageandShorting.html">16. Leverage, Shorting, and Limits to Arbitrage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional/additional.html">17. Additional Statistics Material</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Assignments/Assignments.html">18. Assignments</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment0.html">18.1. Assigment 0</a></li>




<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment1.html">18.6. Assignment 1</a></li>


<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment2.html">18.9. Assignment 2</a></li>


<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment3.html">18.12. Assignment 3</a></li>


<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment4.html">18.15. Assignment 4</a></li>


</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/amoreira2/Fin418/blob/main/chapters/Finance/RiskManagement.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418/issues/new?title=Issue%20on%20page%20%2Fchapters/Finance/RiskManagement.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/Finance/RiskManagement.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Risk Management</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measuring-time-varying-risk">15.1. Measuring Time-varying risk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#single-factor-example">15.2. Single factor example</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-varying-risk-in-a-single-asset-or-trading-strategy">15.2.1. Time-varying risk in a single asset (or trading strategy)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-realized-variance-approach">15.2.2. The Realized variance approach</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-garch-approach">15.2.3. The GARCH approach</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-portfolios">15.3. Dynamic Portfolios</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#risk-budget-constraint">15.4. Risk-Budget Constraint</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tracking-error-constraint">15.5. Tracking Error Constraint</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">To</span> <span class="n">Be</span> <span class="n">Done</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="risk-management">
<h1><span class="section-number">15. </span>Risk Management<a class="headerlink" href="#risk-management" title="Link to this heading">#</a></h1>
<p>Fund managers, endowment managers, and professional delegated money managers in general very rarely can allocate capital freely</p>
<p>It is frequently the case that the ultimate investors impose on them a variety of restriction in the investment opportunity set.</p>
<ul class="simple">
<li><p>Restrictions on the sectors they invest</p></li>
<li><p>Restrictions on the whether they can go short</p></li>
<li><p>Restrictions on the use of explicit leverage</p></li>
<li><p>Restrict on the use of derivative and embedded leverage</p></li>
</ul>
<p>These type of restrictions are simple in the sense that they simply limit the set of instruments you are considering.</p>
<p>They are static in nature.</p>
<p>Another set of constraints imposes time-varying restrictions on what the manager can do</p>
<ul class="simple">
<li><p>Risk limits: given a model for risk, it specifies that the portfolio must have variance lower than a certain limit</p></li>
<li><p>Tracking error constraints: given a benchmark, this imposes limits on the portfolio residual risk–the volatility of the portfolio abnormal return relative to the benchmark</p></li>
</ul>
<p>What makes implementation of these limits challenging is that risk is highly time-varying.</p>
<section id="measuring-time-varying-risk">
<h2><span class="section-number">15.1. </span>Measuring Time-varying risk<a class="headerlink" href="#measuring-time-varying-risk" title="Link to this heading">#</a></h2>
<p>The variance of a portfolio is</p>
<div class="math notranslate nohighlight">
\[Var_t(X_tR^e_{t+1})\]</div>
<p>where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(X_t\)</span> is your portfolio weights in date t for investment in date t+1,</p></li>
<li><p><span class="math notranslate nohighlight">\(R_{t+1}\)</span> is the vector of asset excess returns during the holding period, i.e. from date <span class="math notranslate nohighlight">\(t\)</span> to date <span class="math notranslate nohighlight">\(t+1\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(Var_t() denotes the variance of this random variable given all we know in date \)</span>t$</p></li>
</ul>
<p>The idea here is</p>
<ul class="simple">
<li><p>Correlations do change, but they change slower than variance so we will use standard rolling window to estimate correlations–essentially assuming that they are constant in our forecast horizon.</p></li>
<li><p>And use our model to forecast the the variance</p></li>
</ul>
<p>IF returns have a factor structure we have</p>
<div class="math notranslate nohighlight">
\[Var_t(R_{t+1})=Var(\beta_t F_{t+1}+u_{t+1})=\beta_t Var_t(F) \beta_t'+Var_t(u)\]</div>
<p>We thus need to produce time-varying estimates</p>
<ul class="simple">
<li><p>For betas</p></li>
<li><p>For factor covariance matrix</p></li>
<li><p>For each asset specific idiosyncratic volatility</p></li>
</ul>
</section>
<section id="single-factor-example">
<h2><span class="section-number">15.2. </span>Single factor example<a class="headerlink" href="#single-factor-example" title="Link to this heading">#</a></h2>
<p>We should never use a single factor if your goal is risk-management</p>
<p>The goal here is to saturate the model so that the residuals are really uncorrelated</p>
<p>But single factor makes for easier math :)</p>
<div class="math notranslate nohighlight">
\[Var_t(R_{t+1})=\beta_{t} \beta_{t}'\sigma^2_{f,t} +\Sigma_{u,t}\]</div>
<p>where <span class="math notranslate nohighlight">\(\Sigma_{u,t}\)</span> is a diagonal matrix</p>
<p>so our portfolio is</p>
<div class="math notranslate nohighlight">
\[Var_t(X_t'R_{t+1})=X_t'\beta_{t} \beta_{t}'X_t\sigma^2_{f,t} +X_t'\Sigma_{u,t}X_t\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\beta_p=X_t'\beta_{t}\)</span> is the beta of your portfolio (given holdings at date t)</p></li>
</ul>
<blockquote>
<div><p>Why not simply estimate your portfolio beta directly?</p>
</div></blockquote>
<p>To get started:</p>
<ul class="simple">
<li><p>Rolling 5 year window estimate for the betas</p></li>
<li><p>Assume variances move together with the market variance</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\Sigma_{u,t}=\Sigma_{u}*\frac{\sigma^2_{market,t}}{\sigma^2_{market}}\]</div>
<div class="math notranslate nohighlight">
\[\Sigma_{F,t}=\Sigma_{F}*\frac{\sigma^2_{market,t}}{\sigma^2_{market}}\]</div>
<ul class="simple">
<li><p>Invest in trying to forecast market variance well</p></li>
<li><p>use factor model to extrapolate implications to variance-covariance matrix</p></li>
</ul>
<p>Note: These are all assumptions. You have to check if they are good approximation and ultimate if indeed they help you forecast the variance of your portfolio!</p>
<section id="time-varying-risk-in-a-single-asset-or-trading-strategy">
<h3><span class="section-number">15.2.1. </span>Time-varying risk in a single asset (or trading strategy)<a class="headerlink" href="#time-varying-risk-in-a-single-asset-or-trading-strategy" title="Link to this heading">#</a></h3>
<p>There are two main approaches we can take</p>
<ul class="simple">
<li><p>Realized Variance</p></li>
<li><p>Garch approach</p></li>
</ul>
</section>
<section id="the-realized-variance-approach">
<h3><span class="section-number">15.2.2. </span>The Realized variance approach<a class="headerlink" href="#the-realized-variance-approach" title="Link to this heading">#</a></h3>
<p>Say you have daily data on the returns of an asset <span class="math notranslate nohighlight">\(R_{t}\)</span>. The realized variance is defined as:</p>
<div class="math notranslate nohighlight">
\[RV_{t} = \sum_{i=1}^{N} R_{t-i}^{2}\]</div>
<p>where <span class="math notranslate nohighlight">\(N\)</span> is the number of days in the past you want to consider.</p>
<p>The idea is that the realized variance is The higher the realized variance, the more the returns fluctuate.</p>
<p>Note here that we ignore the expected return of the asset, which at such high frequencies is assumed to be zero.</p>
<p>Armed with this estimate we can then run a forecasting regression:</p>
<ul class="simple">
<li><p>Can use lags</p></li>
<li><p>Can use option based measures of volatility, which also encode future information about what market participants think about future risk</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lets strat by importing daily data on the market</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas_datareader.data</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">web</span>

<span class="c1"># Define the start and end dates</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="s1">&#39;2024-01-01&#39;</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="s1">&#39;1926-01-01&#39;</span>

<span class="c1"># Define the ticker symbol for the market factor</span>
<span class="n">ticker</span> <span class="o">=</span> <span class="s1">&#39;F-F_Research_Data_Factors_daily&#39;</span>

<span class="c1"># Fetch the data from Ken French website</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="s1">&#39;famafrench&#39;</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>

<span class="c1"># Extract the market factor data</span>
<span class="n">market_factor</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Below I compute the variance across days in a given month, so I obtain a daily variance measure ( recall that the variance takes the mean of the square residuals)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">market_RV</span> <span class="o">=</span> <span class="n">market_factor</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="p">((</span><span class="n">market_RV</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/cb856a6b8b3d51d0bbafeb0d734fdc8d1bd8c4231148bc84221cb61efb5c0795.png" src="../../_images/cb856a6b8b3d51d0bbafeb0d734fdc8d1bd8c4231148bc84221cb61efb5c0795.png" />
</div>
</div>
<p>below I will just sum the square returns, so I obtain a monthly variance measure</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># or alternatively, ignoring the mean</span>
<span class="n">market_RV</span> <span class="o">=</span> <span class="n">market_factor</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
<span class="p">((</span><span class="n">market_RV</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/de13a602734962bcb74c4d0a8e106f2bb22f04040d57b70e15366f8b2ce58f89.png" src="../../_images/de13a602734962bcb74c4d0a8e106f2bb22f04040d57b70e15366f8b2ce58f89.png" />
</div>
</div>
<p>LEts do some forecasting.</p>
<p>Basic model</p>
<div class="math notranslate nohighlight">
\[RV_{t+1}=a+bRV_t+\epsilon_{t+1}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>

<span class="c1"># Create lagged variable</span>
<span class="n">market_RV</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">market_RV</span><span class="p">)</span>
<span class="n">market_RV</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RV&#39;</span><span class="p">]</span>
<span class="n">market_RV</span><span class="p">[</span><span class="s1">&#39;RVl1&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">RV</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>

<span class="c1"># Remove missing values</span>
<span class="n">market_RV</span> <span class="o">=</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>


<span class="c1"># Add constant term</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RVl1</span><span class="p">)</span>

<span class="c1"># Fit the regression model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RV</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">results1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Print the regression results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results1</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                     RV   R-squared:                       0.304
Model:                            OLS   Adj. R-squared:                  0.304
Method:                 Least Squares   F-statistic:                     510.5
Date:                Wed, 01 May 2024   Prob (F-statistic):           4.68e-94
Time:                        18:22:59   Log-Likelihood:                -6073.7
No. Observations:                1169   AIC:                         1.215e+04
Df Residuals:                    1167   BIC:                         1.216e+04
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const         11.5001      1.423      8.079      0.000       8.707      14.293
RVl1           0.5516      0.024     22.594      0.000       0.504       0.600
==============================================================================
Omnibus:                     1650.566   Durbin-Watson:                   2.091
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           510580.146
Skew:                           7.829   Prob(JB):                         0.00
Kurtosis:                     104.179   Cond. No.                         64.9
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results1</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RV</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x248c2c237f0&gt;]
</pre></div>
</div>
<img alt="../../_images/f2369b664a1dd2a1c95fe07497c7ecf0bc0b1c14f32573c6665fdc65b12d2c89.png" src="../../_images/f2369b664a1dd2a1c95fe07497c7ecf0bc0b1c14f32573c6665fdc65b12d2c89.png" />
</div>
</div>
<p>What if I do in Standard Deviation? Does it work better?</p>
<p>Bu what do I care about?</p>
<p>How would you do it?</p>
<p>Does additional lags help?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">market_RV</span><span class="p">[</span><span class="s1">&#39;RVl2&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">RV</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">market_RV</span><span class="p">[</span><span class="s1">&#39;RVl3&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">RV</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># Remove missing values</span>
<span class="n">market_RV</span> <span class="o">=</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>


<span class="c1"># Add constant term</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">market_RV</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;RVl1&#39;</span><span class="p">:</span><span class="s1">&#39;RVl3&#39;</span><span class="p">])</span>

<span class="c1"># Fit the regression model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RV</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">results2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Print the regression results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results2</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                     RV   R-squared:                       0.322
Model:                            OLS   Adj. R-squared:                  0.320
Method:                 Least Squares   F-statistic:                     183.8
Date:                Wed, 01 May 2024   Prob (F-statistic):           1.53e-97
Time:                        18:23:15   Log-Likelihood:                -6044.6
No. Observations:                1166   AIC:                         1.210e+04
Df Residuals:                    1162   BIC:                         1.212e+04
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          9.1214      1.481      6.158      0.000       6.215      12.028
RVl1           0.4949      0.029     17.031      0.000       0.438       0.552
RVl2           0.0130      0.032      0.400      0.689      -0.051       0.077
RVl3           0.1368      0.029      4.709      0.000       0.080       0.194
==============================================================================
Omnibus:                     1697.738   Durbin-Watson:                   2.020
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           575996.199
Skew:                           8.290   Prob(JB):                         0.00
Kurtosis:                     110.615   Cond. No.                         101.
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<p>What if it really matters the very recent past?</p>
<p>Lets look at also last five days of the month</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">market_RV</span> <span class="o">=</span> <span class="n">market_factor</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;RV1m&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)),</span> <span class="s1">&#39;RV5d&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:,]</span><span class="o">**</span><span class="mi">2</span><span class="p">))})</span>


<span class="n">market_RV</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/32b551c94a174dc1cd9a878337364d0d927bd3838e2e84665c9983dd0857df05.png" src="../../_images/32b551c94a174dc1cd9a878337364d0d927bd3838e2e84665c9983dd0857df05.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">market_RV</span><span class="p">[</span><span class="s1">&#39;RV1ml1&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
<span class="n">market_RV</span><span class="p">[</span><span class="s1">&#39;RV5dl1&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">RV5d</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
<span class="c1"># Remove missing values</span>
<span class="n">market_RV</span> <span class="o">=</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>


<span class="c1"># Add constant term</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">market_RV</span><span class="p">[[</span><span class="s1">&#39;RV1ml1&#39;</span><span class="p">,</span><span class="s1">&#39;RV5dl1&#39;</span><span class="p">]])</span>

<span class="c1"># Fit the regression model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">results3</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Print the regression results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results3</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                   RV1m   R-squared:                       0.318
Model:                            OLS   Adj. R-squared:                  0.317
Method:                 Least Squares   F-statistic:                     272.3
Date:                Wed, 01 May 2024   Prob (F-statistic):           8.98e-98
Time:                        18:26:09   Log-Likelihood:                -6061.7
No. Observations:                1169   AIC:                         1.213e+04
Df Residuals:                    1166   BIC:                         1.214e+04
Df Model:                           2                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const         11.3676      1.410      8.063      0.000       8.602      14.134
RV1ml1         0.4495      0.032     14.085      0.000       0.387       0.512
RV5dl1         0.4955      0.101      4.904      0.000       0.297       0.694
==============================================================================
Omnibus:                     1648.413   Durbin-Watson:                   2.100
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           489989.508
Skew:                           7.829   Prob(JB):                         0.00
Kurtosis:                     102.068   Cond. No.                         66.4
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<p>What about forward looking information from option markets?</p>
<p>We can use a measure of implied volatility–say the VIX</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas_datareader.data</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">web</span>

<span class="c1"># Define the start and end dates</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="s1">&#39;1990-01-01&#39;</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="s1">&#39;2024-01-01&#39;</span>

<span class="c1"># Define the ticker symbol for the VIX</span>
<span class="n">ticker</span> <span class="o">=</span> <span class="s1">&#39;VIXCLS&#39;</span>

<span class="c1"># Fetch the data from FRED</span>
<span class="n">vix_data</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="s1">&#39;fred&#39;</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
<span class="n">vix_data</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;VIX&#39;</span><span class="p">]</span>
<span class="n">vix_data</span><span class="p">[</span><span class="s1">&#39;VIXl1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">vix_data</span><span class="o">.</span><span class="n">VIX</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
<span class="c1"># Print the VIX data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vix_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              VIX  VIXl1
DATE                    
1990-01-02  17.24    NaN
1990-01-03  18.19  17.24
1990-01-04  19.22  18.19
1990-01-05  20.11  19.22
1990-01-08  20.26  20.11
...           ...    ...
2023-12-26  12.99    NaN
2023-12-27  12.43  12.99
2023-12-28  12.47  12.43
2023-12-29  12.45  12.47
2024-01-01    NaN  12.45

[8870 rows x 2 columns]
</pre></div>
</div>
</div>
</div>
<p>note that VIX is in annual and in standard deviation space.</p>
<p>Lets put all this in yearly stadandar-deviation jsut to make sure the units are interpretable</p>
<p>I need to divide VIX by 100–toget to be a number like 0.16, i.e. 16%</p>
<p>the realized variance I need to first divide by a 100**2 ( returns were in %, so a 10, means 10%), and then multiply by 12 (since it was monthly), and finally square-root it since it was in variance space</p>
<p>If you are confuse while we divide by 10000 and not jsut 100, do the division in returns before computing any variance</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="o">/</span><span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Date
1926-08-31    0.104247
1926-09-30    0.082386
1926-10-31    0.144156
1926-11-30    0.066006
1926-12-31    0.072420
                ...   
2023-08-31    0.130037
2023-09-30    0.113227
2023-10-31    0.149390
2023-11-30    0.133621
2023-12-31    0.107392
Freq: M, Name: RV1m, Length: 1169, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">market_RV_vixunits</span><span class="o">=</span><span class="p">((</span><span class="n">market_RV</span><span class="o">/</span><span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">vix_data</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">market_RV_vixunits</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/d8ec42048cd37dd933dbc1aaac9be68556f5c6aa3e9fa067bce52d642edfaef6.png" src="../../_images/d8ec42048cd37dd933dbc1aaac9be68556f5c6aa3e9fa067bce52d642edfaef6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove missing values</span>

<span class="n">_temp</span><span class="o">=</span><span class="n">market_RV_vixunits</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Add constant term</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">_temp</span><span class="p">[[</span><span class="s1">&#39;RV1ml1&#39;</span><span class="p">,</span><span class="s1">&#39;VIXl1&#39;</span><span class="p">]]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Fit the regression model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">_temp</span><span class="o">.</span><span class="n">RV1m</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">results4</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">missing</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span><span class="p">)</span>

<span class="c1"># Print the regression results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results4</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                   RV1m   R-squared:                       0.740
Model:                            OLS   Adj. R-squared:                  0.738
Method:                 Least Squares   F-statistic:                     393.5
Date:                Wed, 01 May 2024   Prob (F-statistic):           1.14e-81
Time:                        18:26:48   Log-Likelihood:                 524.84
No. Observations:                 280   AIC:                            -1044.
Df Residuals:                     277   BIC:                            -1033.
Df Model:                           2                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const         -0.0312      0.003     -9.562      0.000      -0.038      -0.025
RV1ml1        -0.0004      0.039     -0.010      0.992      -0.077       0.076
VIXl1          1.4984      0.060     24.909      0.000       1.380       1.617
==============================================================================
Omnibus:                      316.412   Durbin-Watson:                   1.529
Prob(Omnibus):                  0.000   Jarque-Bera (JB):            32579.688
Skew:                           4.464   Prob(JB):                         0.00
Kurtosis:                      55.085   Cond. No.                         28.7
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<p>Huge gain?</p>
<p>Is this all about the VIX? or is there something else going on?</p>
<p>CLUE: What happen with the sample?</p>
</section>
<section id="the-garch-approach">
<h3><span class="section-number">15.2.3. </span>The GARCH approach<a class="headerlink" href="#the-garch-approach" title="Link to this heading">#</a></h3>
<p>The GARCH (Generalized Autoregressive Conditional Heteroskedasticity) model is a popular statistical model used for predicting and modeling the volatility, or variance, of financial time series data. It is widely used in finance and risk management to estimate and forecast the volatility of asset returns.</p>
<p>The GARCH model takes into account both the past values of the time series and the past values of the conditional variance itself.</p>
<p>The GARCH model is typically expressed as follows:</p>
<div class="math notranslate nohighlight">
\[
\sigma_t^2 = \omega + \sum_{i=1}^{p} \alpha_i \epsilon_{t-i}^2 + \sum_{j=1}^{q} \beta_j \sigma_{t-j}^2
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\sigma_t^2\)</span> is the conditional variance at time <span class="math notranslate nohighlight">\(t\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(\omega\)</span> is the constant term,</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha_i\)</span> and <span class="math notranslate nohighlight">\(\beta_j\)</span> are the coefficients of the model,</p></li>
<li><p><span class="math notranslate nohighlight">\(\epsilon_{t-i}^2\)</span> is the squared residual at time <span class="math notranslate nohighlight">\(t-i\)</span>, and</p></li>
<li><p><span class="math notranslate nohighlight">\(\sigma_{t-j}^2\)</span> is the conditional variance at time <span class="math notranslate nohighlight">\(t-j\)</span>.</p></li>
</ul>
<p>The GARCH model allows for the estimation of the parameters <span class="math notranslate nohighlight">\(\omega\)</span>, <span class="math notranslate nohighlight">\(\alpha_i\)</span>, and <span class="math notranslate nohighlight">\(\beta_j\)</span> using various estimation techniques such as maximum likelihood estimation. Once the parameters are estimated, the model can be used to forecast the future conditional variance of the time series.</p>
<p>By predicting the volatility of a financial time series, the GARCH model can be used to assess and manage risk in various financial applications, such as portfolio optimization, option pricing, and risk management strategies.</p>
<ul class="simple">
<li><p>Estimate GARCH for market</p></li>
<li><p>Show T periods forecast</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">arch</span><span class="w"> </span><span class="kn">import</span> <span class="n">arch_model</span>

<span class="c1"># Assume returns is your time series data</span>
<span class="c1"># returns = ...</span>
<span class="n">monthly_returns</span><span class="o">=</span><span class="n">market_factor</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">arch_model</span><span class="p">(</span><span class="n">monthly_returns</span><span class="p">,</span> <span class="n">vol</span><span class="o">=</span><span class="s1">&#39;Garch&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">model_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Iteration:      1,   Func. Count:      6,   Neg. LLF: 121644695.74237345
Iteration:      2,   Func. Count:     17,   Neg. LLF: 640569.4132864494
Iteration:      3,   Func. Count:     24,   Neg. LLF: 940970.6741192145
Iteration:      4,   Func. Count:     33,   Neg. LLF: -1938.7144124196502
Optimization terminated successfully    (Exit mode 0)
            Current function value: -1938.7144099338939
            Iterations: 8
            Function evaluations: 33
            Gradient evaluations: 4
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\Alan.Moreira\Anaconda3\lib\site-packages\arch\univariate\base.py:311: DataScaleWarning: y is poorly scaled, which may affect convergence of the optimizer when
estimating the model parameters. The scale of y is 0.002851. Parameter
estimation work better when this value is between 1 and 1000. The recommended
rescaling is 10 * y.

This warning can be disabled by either rescaling y before initializing the
model or by setting rescale=False.

  warnings.warn(
</pre></div>
</div>
<div class="output text_html"><table class="simpletable">
<caption>Constant Mean - GARCH Model Results</caption>
<tr>
  <th>Dep. Variable:</th>       <td>Mkt-RF</td>       <th>  R-squared:         </th>  <td>   0.000</td> 
</tr>
<tr>
  <th>Mean Model:</th>       <td>Constant Mean</td>   <th>  Adj. R-squared:    </th>  <td>   0.000</td> 
</tr>
<tr>
  <th>Vol Model:</th>            <td>GARCH</td>       <th>  Log-Likelihood:    </th> <td>   1938.71</td>
</tr>
<tr>
  <th>Distribution:</th>        <td>Normal</td>       <th>  AIC:               </th> <td>  -3869.43</td>
</tr>
<tr>
  <th>Method:</th>        <td>Maximum Likelihood</td> <th>  BIC:               </th> <td>  -3849.17</td>
</tr>
<tr>
  <th></th>                        <td></td>          <th>  No. Observations:  </th>    <td>1170</td>   
</tr>
<tr>
  <th>Date:</th>           <td>Wed, May 01 2024</td>  <th>  Df Residuals:      </th>    <td>1169</td>   
</tr>
<tr>
  <th>Time:</th>               <td>18:28:26</td>      <th>  Df Model:          </th>      <td>1</td>    
</tr>
</table>
<table class="simpletable">
<caption>Mean Model</caption>
<tr>
   <td></td>     <th>coef</th>     <th>std err</th>      <th>t</th>       <th>P>|t|</th>     <th>95.0% Conf. Int.</th>   
</tr>
<tr>
  <th>mu</th> <td>7.9346e-03</td> <td>1.285e-03</td> <td>    6.174</td> <td>6.663e-10</td> <td>[5.416e-03,1.045e-02]</td>
</tr>
</table>
<table class="simpletable">
<caption>Volatility Model</caption>
<tr>
      <td></td>        <th>coef</th>     <th>std err</th>      <th>t</th>       <th>P>|t|</th>     <th>95.0% Conf. Int.</th>   
</tr>
<tr>
  <th>omega</th>    <td>5.5202e-05</td> <td>1.783e-05</td> <td>    3.096</td> <td>1.963e-03</td> <td>[2.025e-05,9.015e-05]</td>
</tr>
<tr>
  <th>alpha[1]</th> <td>    0.1286</td> <td>2.074e-02</td> <td>    6.200</td> <td>5.633e-10</td>  <td>[8.794e-02,  0.169]</td> 
</tr>
<tr>
  <th>beta[1]</th>  <td>    0.8520</td> <td>2.082e-02</td> <td>   40.923</td>   <td>0.000</td>     <td>[  0.811,  0.893]</td>  
</tr>
</table><br/><br/>Covariance estimator: robust</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this is the model best estimate of volatility at a given point in time</span>
<span class="n">ax</span><span class="o">=</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">conditional_volatility</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="c1"># If we want next period volatility</span>

<span class="n">forecasts</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">horizon</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Get the variance</span>
<span class="n">variance_forecast</span> <span class="o">=</span> <span class="n">forecasts</span><span class="o">.</span><span class="n">variance</span><span class="o">*</span><span class="mi">12</span>

<span class="c1"># Get the standard deviation (volatility) by taking the square root of the variance</span>
<span class="p">((</span><span class="n">variance_forecast</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\Alan.Moreira\Anaconda3\lib\site-packages\arch\__future__\_utility.py:11: FutureWarning: 
The default for reindex is True. After September 2021 this will change to
False. Set reindex to True or False to silence this message. Alternatively,
you can use the import comment

from arch.__future__ import reindexing

to globally set reindex to True and silence this warning.

  warnings.warn(
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/b9e5c4b213dc0f60f562e6bd23a9006483639e0039c6f4049e031ddec8cb538a.png" src="../../_images/b9e5c4b213dc0f60f562e6bd23a9006483639e0039c6f4049e031ddec8cb538a.png" />
</div>
</div>
<p>Basically on top of each other</p>
<p>Lets look at how it forecasts for a given date how volatiltiy will behave many month in the future</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h</span><span class="o">=</span><span class="mi">60</span>
<span class="n">forecasts</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">horizon</span><span class="o">=</span><span class="n">h</span><span class="p">)</span>

<span class="c1"># Get the variance</span>
<span class="n">variance_forecast</span> <span class="o">=</span> <span class="n">forecasts</span><span class="o">.</span><span class="n">variance</span>

<span class="c1"># Get the standard deviation (volatility) by taking the square root of the variance</span>
<span class="n">volatility_forecast</span> <span class="o">=</span> <span class="p">(</span><span class="n">variance_forecast</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

<span class="c1"># Print the 3-month ahead forecasted volatility for all data points</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">h</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">volatility_forecast</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2020-03&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\Alan.Moreira\Anaconda3\lib\site-packages\arch\__future__\_utility.py:11: FutureWarning: 
The default for reindex is True. After September 2021 this will change to
False. Set reindex to True or False to silence this message. Alternatively,
you can use the import comment

from arch.__future__ import reindexing

to globally set reindex to True and silence this warning.

  warnings.warn(
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x1ea73c84f10&gt;]
</pre></div>
</div>
<img alt="../../_images/5ae689859e2e299404cb638b86c2ad1fb8e845e6ede60096e6a7a0e90bdb3b87.png" src="../../_images/5ae689859e2e299404cb638b86c2ad1fb8e845e6ede60096e6a7a0e90bdb3b87.png" />
</div>
</div>
<p>Which one is better?</p>
<p>different approaches to deal with this</p>
<p>There is a whole field dedicated to forecasting</p>
<p>But the basic idea is simple</p>
<p>You wan to have some penalty for it: What is the cost of getting it wrong?</p>
<p>We could simply have a penalty:</p>
<div class="math notranslate nohighlight">
\[\gamma E[(Variance(model)-Variance(Truth))^2]\]</div>
<p>Basically this the “Mean-Squared Error” approach to evaluating forecasts</p>
<p>Here we need some estimate of the true variance</p>
<p>Below we assume it is the realized variance</p>
<p>It is very important that they are in the same units!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is the model that that uses VIX</span>

<span class="nb">print</span><span class="p">(((</span><span class="n">results4</span><span class="o">.</span><span class="n">fittedvalues</span><span class="o">-</span> <span class="n">market_RV_vixunits</span><span class="o">.</span><span class="n">RV1m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">market_RV_vixunits</span><span class="o">.</span><span class="n">RV1m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">var</span><span class="p">())</span> <span class="c1"># divide by the variable variance to have a sense of how big are your mistakes!</span>

<span class="c1"># this is the model that use 5 days and 1 month lagged RV (but much longer sample!)</span>
<span class="nb">print</span><span class="p">(((</span><span class="n">results3</span><span class="o">.</span><span class="n">fittedvalues</span><span class="o">-</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="p">)</span><span class="o">.</span><span class="n">var</span><span class="p">())</span> <span class="c1">#multiply to put in the same units</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.34890446461669083
0.6810322887390576
</pre></div>
</div>
</div>
</div>
<p>How do you make it more comparable?</p>
<p>Lets add the GARCH to the mix</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">forecasts</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">horizon</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Get the variance</span>
<span class="n">variance_forecast</span> <span class="o">=</span> <span class="n">forecasts</span><span class="o">.</span><span class="n">variance</span><span class="o">*</span><span class="mi">12</span>

<span class="c1"># check units!</span>

<span class="nb">print</span><span class="p">(</span><span class="n">variance_forecast</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">((</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>h.1    0.034199
dtype: float64
3399.012434626065
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\Alan.Moreira\Anaconda3\lib\site-packages\arch\__future__\_utility.py:11: FutureWarning: 
The default for reindex is True. After September 2021 this will change to
False. Set reindex to True or False to silence this message. Alternatively,
you can use the import comment

from arch.__future__ import reindexing

to globally set reindex to True and silence this warning.

  warnings.warn(
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(((</span><span class="n">variance_forecast</span><span class="p">[</span><span class="s1">&#39;h.1&#39;</span><span class="p">]</span><span class="o">-</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">var</span><span class="p">())</span> <span class="c1">#multiply to put in the same units</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0191992250394422
</pre></div>
</div>
</div>
</div>
<p>Note that to make it comparable we should look at similar samples.</p>
<p>Why is that? How would you do that?</p>
</section>
</section>
<section id="dynamic-portfolios">
<h2><span class="section-number">15.3. </span>Dynamic Portfolios<a class="headerlink" href="#dynamic-portfolios" title="Link to this heading">#</a></h2>
<p>The key idea here will be to use the factor structure idea for returns together with a GARCH or RV model for the market return volatility.</p>
<p>The idea here is</p>
<ul class="simple">
<li><p>Correlations do change, but they change slower than variance so we will use standard rolling window to estimate correlations–essentially assuming that they are constant in our forecast horizon.</p></li>
<li><p>And use our model to forecast the the variance</p></li>
</ul>
<p>IF returns have a factor structure we have</p>
<div class="math notranslate nohighlight">
\[Var_t(R_{t+1})=Var(\beta_t F_{t+1}+u_{t+1})=\beta_t Var_t(F) \beta_t'+Var_t(u)\]</div>
<p>We thus need to produce time-varying estimates</p>
<ul class="simple">
<li><p>for the time-varying betas</p></li>
<li><p>For the entire factor covariance matrix</p></li>
<li><p>For each asset specific volatility</p></li>
</ul>
<p>Suppose we have single factor model–</p>
<p>then we have</p>
<div class="math notranslate nohighlight">
\[Var_t(R^i_{t+1})=\beta_{i,t}^2 \sigma^2_{f,t} +\sigma^2_{i,t}(u)\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[Cov_t(R^i_{t+1},R^j_{t+1})=\beta_{i,t}*\beta_{j,t}\sigma^2_{f,t} \]</div>
<p>or in matrix form</p>
<div class="math notranslate nohighlight">
\[Var_t(R_{t+1})=\beta_{t} \beta_{t}'\sigma^2_{f,t} +\Sigma_{u,t}\]</div>
<p>where <span class="math notranslate nohighlight">\(\Sigma_{u,t}\)</span> is a diagonal matrix</p>
<p>You see there are many things to estimate!</p>
<p>Do I really need to estimate all these things?</p>
<ul class="simple">
<li><p>Depend of what are your assets</p></li>
<li><p>Depend on how well you can estimate them</p></li>
</ul>
<p>There is a whole industry of estimating factor Betas for different assets
4
You can get quite sophisticated.</p>
<p>To get started:</p>
<ul class="simple">
<li><p>Rolling 5 year window estimate for the betas</p></li>
<li><p>Assume variances move together with the market variance</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\Sigma_{u,t}=\Sigma_{u}*\frac{\sigma^2_{market,t}}{\sigma^2_{market}}\]</div>
<div class="math notranslate nohighlight">
\[\Sigma_{F,t}=\Sigma_{F}*\frac{\sigma^2_{market,t}}{\sigma^2_{market}}\]</div>
<ul class="simple">
<li><p>Invest in trying to forecast market variance well</p></li>
<li><p>use factor model to extrapolate implications to variance-covariance matrix</p></li>
</ul>
<p>Note: These are all assumptions. You have to check if they are good approximation and ultimate if indeed they help you forecast the variance of your portfolio!</p>
</section>
<section id="risk-budget-constraint">
<h2><span class="section-number">15.4. </span>Risk-Budget Constraint<a class="headerlink" href="#risk-budget-constraint" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>How this is used in practice?</p></li>
<li><p>In practice a fund or a “trading pod” is allocated some capital and some maximum risk-limits</p></li>
<li><p>If you breach the risk-limit you have to de-risk</p></li>
<li><p>Why is typically so hard to de-risk?</p></li>
<li><p>Think about Melvin Capital.</p>
<ul>
<li><p>How should you think about de-risking? Should you comply? What is the trade-off?</p></li>
<li><p>What are the incentives the manager faces? What does it depend on?</p></li>
<li><p>How are these incentives different from a wealth individual invest in her own behalf?</p></li>
</ul>
</li>
<li><p>Should our past losses matter for our decision to de-risk?</p></li>
</ul>
</section>
<section id="tracking-error-constraint">
<h2><span class="section-number">15.5. </span>Tracking Error Constraint<a class="headerlink" href="#tracking-error-constraint" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>One can use exactly the same model to compute the tracking error</p></li>
<li><p>it is simply the volatility of a relative return</p></li>
<li><p>How would you adjust our math above to estimate the tracking error instead of the absolute risk?</p></li>
</ul>
<p>Suppose we have many assets, all respecting this factor model. Say <span class="math notranslate nohighlight">\(R_t^e\)</span> is the big N by 1 vector of excess return <span class="math notranslate nohighlight">\([r_{t}^{e,1},r_{t}^{e,2},...]\)</span> for all these assets</p>
<div class="math notranslate nohighlight">
\[R_t^e=Bf_t+U_t\]</div>
<p>where <span class="math notranslate nohighlight">\(B\)</span> is also a N by 1 vector of exposures <span class="math notranslate nohighlight">\([\beta_1,\beta_2,...\beta_N]\)</span>  and <span class="math notranslate nohighlight">\(u_t\)</span> is the N by 1 vector of shocks <span class="math notranslate nohighlight">\([\epsilon_1,\epsilon_2,...]\)</span></p>
<p>Then their variance-covariance matrix is simply</p>
<div class="math notranslate nohighlight">
\[Var(R^e_t)=B &#64; B' Var(f_t)+ Var(U_t)\]</div>
<ul class="simple">
<li><p>Armed with the variance covariance of assets we have the variance of any portfolio of these assets</p></li>
<li><p>To construct <span class="math notranslate nohighlight">\(Var(U_t)\)</span> you can stack all the residuals of the individual regression in a dataframe and compute the variance</p></li>
<li><p>This will give you a vector S with N numbers, the you can use <code class="docutils literal notranslate"><span class="pre">np.diag(S)</span></code> to created a diagonal matrix with these variances in the diagonal</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/Finance"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="InterpretingFactorModels.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">14.9. </span>📊 Interpreting Factor Models</p>
      </div>
    </a>
    <a class="right-next"
       href="LeverageandShorting.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">16. </span>Levering up and Shorting</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measuring-time-varying-risk">15.1. Measuring Time-varying risk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#single-factor-example">15.2. Single factor example</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-varying-risk-in-a-single-asset-or-trading-strategy">15.2.1. Time-varying risk in a single asset (or trading strategy)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-realized-variance-approach">15.2.2. The Realized variance approach</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-garch-approach">15.2.3. The GARCH approach</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-portfolios">15.3. Dynamic Portfolios</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#risk-budget-constraint">15.4. Risk-Budget Constraint</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tracking-error-constraint">15.5. Tracking Error Constraint</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alan Moreira
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021 Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>