

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>13. Risk Management and Capital Allocation &#8212; Quantitative Investing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/Finance/RiskManagement';</script>
    <link rel="canonical" href="https://amoreira2.github.io/Fin418/chapters/Finance/RiskManagement.html" />
    <link rel="shortcut icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="14. Machine Learning and AI" href="MachineLearning.html" />
    <link rel="prev" title="12.2. Volatility timing" href="Volatilitytiming.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/figuremain2.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/figuremain2.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/what-is-quant-investing.html">1. What is Quantitative Investing?</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/statistical-techniques.html">1.1. Statistical Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/computational-tools.html">1.2. Computational tools</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/getting_started.html">2. Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/local_install.html">2.3. Local installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/cloud_setup.html">2.4. Cloud Setup</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../essentials/intro.html">3. Python Essentials</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../essentials/basics.html">3.1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/collections.html">3.2. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/numpy.html">3.3. Numpy</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../essentials/introtopandas.html">3.4. Pandas</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/the_index.html">3.4.3. Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/timeseries.html">3.4.4. Time-Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/reshape.html">3.4.5. Reshape</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/merge.html">3.4.6. Merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/groupby.html">3.4.7. Group-by</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/matplotlib.html">3.4.8. Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/data_clean.html">3.4.9. Cleaning data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/storage_formats.html">3.4.10. Data Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/control_flow.html">3.5. Flow control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/functions.html">3.6. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/plotting.html">3.7. Plotting</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Returns.html">4. Asset Returns</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="UsingAPI.html">4.3. Data APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="TheChoiceofFrequency.html">4.4. The Choice of Frequency and Annualization of Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scientific/randomness1.html">4.5. Modeling randomness</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="PortfolioMath.html">5. Portfolios</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../scientific/linear_algebra1.html">5.7. Linear algebra Review</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="MeanVariance.html">6. Mean-Variance Investing</a></li>
<li class="toctree-l1"><a class="reference internal" href="TradingStrategies.html">7. Trading Strategies</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="FactorModels.html">8. Factor Models</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="MultiFactorModels.html">8.2. Multi Factor Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="ExpectedReturnModels.html">8.3. Factor Models as Models of Expected Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="InterpretingFactorModels.html">8.4. Interpreting Factor Models</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="crosssectionalequitystrategies.html">9. Cross-Sectional Equity Strategies</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="MarketCapweighted.html">9.1. The Market Cap Weighted Portfolio</a></li>
<li class="toctree-l2"><a class="reference internal" href="Valueinvesting.html">9.2. Value factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="Momentum.html">9.3. Momentum factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="OtherEquityStrategies.html">9.4. Other Equity strategies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Robustness.html">10. Robustness of Quantitative Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="Implementation.html">11. Liquidity</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Timing.html">12. Factor Timing</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="Volatilitytiming.html">12.2. Volatility Timing</a></li>
</ul>
</li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">13. Risk Management and Capital Allocation</a></li>
<li class="toctree-l1"><a class="reference internal" href="MachineLearning.html">14. Machine Learning in Finance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional/additional.html">15. Additional Statistics Material</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Assignments/Assignments.html">16. Assignments</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment0.html">16.1. Assigment 0</a></li>




<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment1.html">16.6. Assignment 1</a></li>


<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment2.html">16.9. Assignment 2</a></li>


</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/amoreira2/Fin418/blob/main/chapters/Finance/RiskManagement.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418/issues/new?title=Issue%20on%20page%20%2Fchapters/Finance/RiskManagement.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/Finance/RiskManagement.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Risk Management and Capital Allocation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measuring-time-varying-risk">13.1. Measuring Time-varying risk</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-varying-risk-in-a-single-asset-or-trading-strategy">13.1.1. Time-varying risk in a single asset (or trading strategy)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-realized-variance-approach">13.1.2. The Realized variance approach</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-garch-approach">13.1.3. The GARCH approach</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-portfolios">13.2. Dynamic Portfolios</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="risk-management-and-capital-allocation">
<h1><span class="section-number">13. </span>Risk Management and Capital Allocation<a class="headerlink" href="#risk-management-and-capital-allocation" title="Permalink to this heading">#</a></h1>
<p>Fund managers, endowment managers, and professional delegated money managers in general very rarely can allocate capital freely</p>
<p>It is frequently the case that the ultimate investors impose on them a variety of restriction in the investment opportunity set.</p>
<ul class="simple">
<li><p>Restrictions on the sectors they invest</p></li>
<li><p>Restrictions on the whether they can go short</p></li>
<li><p>Restrictions on the use of explicit leverage</p></li>
<li><p>Restrict on the use of derivative and embedded leverage</p></li>
</ul>
<p>These type of restrictions are simple in the sense that they simply limit the set of instruments you are considering.</p>
<p>They are static in nature.</p>
<p>Another set of constraints imposes time-varying restrictions on what the manager can do</p>
<ul class="simple">
<li><p>Risk limits: given a model for risk, it specifies that the portfolio must have variance lower than a certain limit</p></li>
<li><p>Tracking error constraints: given a benchmark, this imposes limits on the portfolio residual risk–the volatility of the portfolio abnormal return relative to the benchmark</p></li>
</ul>
<p>What makes implementation of these limits challenging is that risk is highly time-varying.</p>
<p>We start discussing a very standard approach to measure risk</p>
<section id="measuring-time-varying-risk">
<h2><span class="section-number">13.1. </span>Measuring Time-varying risk<a class="headerlink" href="#measuring-time-varying-risk" title="Permalink to this heading">#</a></h2>
<p>The variance of a portfolio is</p>
<div class="math notranslate nohighlight">
\[Var_t(X_tR^e_{t+1})\]</div>
<p>where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(X_t\)</span> is your portfolio weights in date t for investment in date t+1,</p></li>
<li><p><span class="math notranslate nohighlight">\(R_{t+1}\)</span> is the vector of asset excess returns during the holding period, i.e. from date <span class="math notranslate nohighlight">\(t\)</span> to date <span class="math notranslate nohighlight">\(t+1\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(Var_t() denotes the variance of this random variable given all we know in date \)</span>t$</p></li>
</ul>
<section id="time-varying-risk-in-a-single-asset-or-trading-strategy">
<h3><span class="section-number">13.1.1. </span>Time-varying risk in a single asset (or trading strategy)<a class="headerlink" href="#time-varying-risk-in-a-single-asset-or-trading-strategy" title="Permalink to this heading">#</a></h3>
<p>There are two main approaches we can take</p>
<ul class="simple">
<li><p>Realized Variance</p></li>
<li><p>Garch approach</p></li>
</ul>
</section>
<section id="the-realized-variance-approach">
<h3><span class="section-number">13.1.2. </span>The Realized variance approach<a class="headerlink" href="#the-realized-variance-approach" title="Permalink to this heading">#</a></h3>
<p>Say you have daily data on the returns of an asset <span class="math notranslate nohighlight">\(R_{t}\)</span>. The realized variance is defined as:</p>
<div class="math notranslate nohighlight">
\[RV_{t} = \sum_{i=1}^{N} R_{t-i}^{2}\]</div>
<p>where <span class="math notranslate nohighlight">\(N\)</span> is the number of days in the past you want to consider.</p>
<p>The idea is that the realized variance is The higher the realized variance, the more the returns fluctuate.</p>
<p>Note here that we ignore the expected return of the asset, which at such high frequencies is assumed to be zero.</p>
<p>Armed with this estimate we can then run a forecasting regression:</p>
<ul class="simple">
<li><p>Can use lags</p></li>
<li><p>Can use option based measures of volatility, which also encode future information about what market participants think about future risk</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lets strat by importing daily data on the market</span>
<span class="kn">import</span> <span class="nn">pandas_datareader.data</span> <span class="k">as</span> <span class="nn">web</span>

<span class="c1"># Define the start and end dates</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="s1">&#39;2024-01-01&#39;</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="s1">&#39;1926-01-01&#39;</span>

<span class="c1"># Define the ticker symbol for the market factor</span>
<span class="n">ticker</span> <span class="o">=</span> <span class="s1">&#39;F-F_Research_Data_Factors_daily&#39;</span>

<span class="c1"># Fetch the data from Ken French website</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="s1">&#39;famafrench&#39;</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>

<span class="c1"># Extract the market factor data</span>
<span class="n">market_factor</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Below I compute the variance across days in a given month, so I obtain a daily variance measure ( recall that the variance takes the mean of the square residuals)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">market_RV</span> <span class="o">=</span> <span class="n">market_factor</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
<span class="p">((</span><span class="n">market_RV</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/bf8c3c5bed791e19b5ee624d07bf53927815e92722cfe6fd7a56c44f1199d304.png" src="../../_images/bf8c3c5bed791e19b5ee624d07bf53927815e92722cfe6fd7a56c44f1199d304.png" />
</div>
</div>
<p>below I will just sum the square returns, so I obtain a monthly variance measure</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># or alternatively, ignoring the mean</span>
<span class="n">market_RV</span> <span class="o">=</span> <span class="n">market_factor</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
<span class="p">((</span><span class="n">market_RV</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/89cc38e207d712711296df11f54a40cb2cabc22b8d8e76d25d58faaa31735e57.png" src="../../_images/89cc38e207d712711296df11f54a40cb2cabc22b8d8e76d25d58faaa31735e57.png" />
</div>
</div>
<p>LEts do some forecasting.</p>
<p>Basic model</p>
<div class="math notranslate nohighlight">
\[RV_{t+1}=a+bRV_t+\epsilon_{t+1}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="c1"># Create lagged variable</span>
<span class="n">market_RV</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">market_RV</span><span class="p">)</span>
<span class="n">market_RV</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RV&#39;</span><span class="p">]</span>
<span class="n">market_RV</span><span class="p">[</span><span class="s1">&#39;RVl1&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">RV</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>

<span class="c1"># Remove missing values</span>
<span class="n">market_RV</span> <span class="o">=</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>


<span class="c1"># Add constant term</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RVl1</span><span class="p">)</span>

<span class="c1"># Fit the regression model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RV</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">results1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Print the regression results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results1</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                     RV   R-squared:                       0.304
Model:                            OLS   Adj. R-squared:                  0.304
Method:                 Least Squares   F-statistic:                     510.5
Date:                Wed, 20 Mar 2024   Prob (F-statistic):           4.68e-94
Time:                        17:17:14   Log-Likelihood:                -6073.7
No. Observations:                1169   AIC:                         1.215e+04
Df Residuals:                    1167   BIC:                         1.216e+04
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const         11.5001      1.423      8.079      0.000       8.707      14.293
RVl1           0.5516      0.024     22.594      0.000       0.504       0.600
==============================================================================
Omnibus:                     1650.566   Durbin-Watson:                   2.091
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           510579.995
Skew:                           7.829   Prob(JB):                         0.00
Kurtosis:                     104.179   Cond. No.                         64.9
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results1</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RV</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x19a46cf7970&gt;]
</pre></div>
</div>
<img alt="../../_images/f2369b664a1dd2a1c95fe07497c7ecf0bc0b1c14f32573c6665fdc65b12d2c89.png" src="../../_images/f2369b664a1dd2a1c95fe07497c7ecf0bc0b1c14f32573c6665fdc65b12d2c89.png" />
</div>
</div>
<p>What if I do in Standard Deviation? Does it work better?</p>
<p>Bu what do I care about?</p>
<p>How would you do it?</p>
<p>Does additional lags help?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">market_RV</span><span class="p">[</span><span class="s1">&#39;RVl2&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">RV</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">market_RV</span><span class="p">[</span><span class="s1">&#39;RVl3&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">RV</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># Remove missing values</span>
<span class="n">market_RV</span> <span class="o">=</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>


<span class="c1"># Add constant term</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">market_RV</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;RVl1&#39;</span><span class="p">:</span><span class="s1">&#39;RVl3&#39;</span><span class="p">])</span>

<span class="c1"># Fit the regression model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RV</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">results2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Print the regression results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results2</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                     RV   R-squared:                       0.322
Model:                            OLS   Adj. R-squared:                  0.320
Method:                 Least Squares   F-statistic:                     183.8
Date:                Wed, 20 Mar 2024   Prob (F-statistic):           1.53e-97
Time:                        17:17:21   Log-Likelihood:                -6044.6
No. Observations:                1166   AIC:                         1.210e+04
Df Residuals:                    1162   BIC:                         1.212e+04
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          9.1214      1.481      6.158      0.000       6.215      12.028
RVl1           0.4949      0.029     17.031      0.000       0.438       0.552
RVl2           0.0130      0.032      0.400      0.689      -0.051       0.077
RVl3           0.1368      0.029      4.709      0.000       0.080       0.194
==============================================================================
Omnibus:                     1697.738   Durbin-Watson:                   2.020
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           575996.063
Skew:                           8.290   Prob(JB):                         0.00
Kurtosis:                     110.615   Cond. No.                         101.
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<p>What if it really matters the very recent past?</p>
<p>Lets look at also last five days of the month</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">market_RV</span> <span class="o">=</span> <span class="n">market_factor</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;RV1m&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)),</span> <span class="s1">&#39;RV5d&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:,]</span><span class="o">**</span><span class="mi">2</span><span class="p">))})</span>


<span class="n">market_RV</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/32b551c94a174dc1cd9a878337364d0d927bd3838e2e84665c9983dd0857df05.png" src="../../_images/32b551c94a174dc1cd9a878337364d0d927bd3838e2e84665c9983dd0857df05.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">market_RV</span><span class="p">[</span><span class="s1">&#39;RV1ml1&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
<span class="n">market_RV</span><span class="p">[</span><span class="s1">&#39;RV5dl1&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">RV5d</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span>
<span class="c1"># Remove missing values</span>
<span class="n">market_RV</span> <span class="o">=</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>


<span class="c1"># Add constant term</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">market_RV</span><span class="p">[[</span><span class="s1">&#39;RV1ml1&#39;</span><span class="p">,</span><span class="s1">&#39;RV5dl1&#39;</span><span class="p">]])</span>

<span class="c1"># Fit the regression model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">results3</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Print the regression results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results3</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                   RV1m   R-squared:                       0.318
Model:                            OLS   Adj. R-squared:                  0.317
Method:                 Least Squares   F-statistic:                     272.3
Date:                Wed, 20 Mar 2024   Prob (F-statistic):           8.98e-98
Time:                        17:17:25   Log-Likelihood:                -6061.7
No. Observations:                1169   AIC:                         1.213e+04
Df Residuals:                    1166   BIC:                         1.214e+04
Df Model:                           2                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const         11.3675      1.410      8.063      0.000       8.601      14.134
RV1ml1         0.4495      0.032     14.085      0.000       0.387       0.512
RV5dl1         0.4955      0.101      4.904      0.000       0.297       0.694
==============================================================================
Omnibus:                     1648.413   Durbin-Watson:                   2.100
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           489989.372
Skew:                           7.829   Prob(JB):                         0.00
Kurtosis:                     102.068   Cond. No.                         66.4
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<p>What about forward looking information from option markets?</p>
<p>We can use a measure of implied volatility–say the VIX</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas_datareader.data</span> <span class="k">as</span> <span class="nn">web</span>

<span class="c1"># Define the start and end dates</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="s1">&#39;1990-01-01&#39;</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="s1">&#39;2024-01-01&#39;</span>

<span class="c1"># Define the ticker symbol for the VIX</span>
<span class="n">ticker</span> <span class="o">=</span> <span class="s1">&#39;VIXCLS&#39;</span>

<span class="c1"># Fetch the data from FRED</span>
<span class="n">vix_data</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="s1">&#39;fred&#39;</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>

<span class="c1"># Print the VIX data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vix_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>            VIXCLS
DATE              
1990-01-02   17.24
1990-01-03   18.19
1990-01-04   19.22
1990-01-05   20.11
1990-01-08   20.26
...            ...
2023-12-26   12.99
2023-12-27   12.43
2023-12-28   12.47
2023-12-29   12.45
2024-01-01     NaN

[8870 rows x 1 columns]
</pre></div>
</div>
</div>
</div>
<p>note that VIX is in annual and in standard deviation space.</p>
<p>Lets put all this in yearly stadandar-deviation jsut to make sure the units are interpretable</p>
<p>I need to divide VIX by 100–toget to be a number like 0.16, i.e. 16%</p>
<p>the realized variance I need to first divide by a 100**2 ( returns were in %, so a 10, means 10%), and then multiply by 12 (since it was monthly), and finally square-root it since it was in variance space</p>
<p>If you are confuse while we divide by 10000 and not jsut 100, do the division in returns before computing any variance</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="o">/</span><span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Date
1926-08-31    0.104247
1926-09-30    0.082386
1926-10-31    0.144156
1926-11-30    0.066006
1926-12-31    0.072420
                ...   
2023-08-31    0.130037
2023-09-30    0.113227
2023-10-31    0.149390
2023-11-30    0.133621
2023-12-31    0.107392
Freq: M, Name: RV1m, Length: 1169, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">market_RV</span><span class="o">=</span><span class="p">((</span><span class="n">market_RV</span><span class="o">/</span><span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">vix_data</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">market_RV</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/ef80080c3f10800e45cfb2c903383ad8e50a8d8459d46df6b08f1b8885a40a3b.png" src="../../_images/ef80080c3f10800e45cfb2c903383ad8e50a8d8459d46df6b08f1b8885a40a3b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove missing values</span>

<span class="n">_temp</span><span class="o">=</span><span class="n">market_RV</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Add constant term</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">_temp</span><span class="p">[[</span><span class="s1">&#39;RV1ml1&#39;</span><span class="p">,</span><span class="s1">&#39;RV5dl1&#39;</span><span class="p">,</span><span class="s1">&#39;VIXCLS&#39;</span><span class="p">]]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Fit the regression model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">_temp</span><span class="o">.</span><span class="n">RV1m</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">results4</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">missing</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span><span class="p">)</span>

<span class="c1"># Print the regression results</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results4</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                   RV1m   R-squared:                       0.692
Model:                            OLS   Adj. R-squared:                  0.689
Method:                 Least Squares   F-statistic:                     211.0
Date:                Wed, 20 Mar 2024   Prob (F-statistic):           9.26e-72
Time:                        17:19:22   Log-Likelihood:                 514.72
No. Observations:                 286   AIC:                            -1021.
Df Residuals:                     282   BIC:                            -1007.
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const         -0.0266      0.004     -7.227      0.000      -0.034      -0.019
RV1ml1        -0.1907      0.055     -3.472      0.001      -0.299      -0.083
RV5dl1         1.6765      0.330      5.086      0.000       1.028       2.325
VIXCLS         1.2553      0.084     14.921      0.000       1.090       1.421
==============================================================================
Omnibus:                      350.069   Durbin-Watson:                   1.490
Prob(Omnibus):                  0.000   Jarque-Bera (JB):            50155.165
Skew:                           5.047   Prob(JB):                         0.00
Kurtosis:                      67.085   Cond. No.                         141.
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<p>Huge gain?</p>
<p>Is this all about the VIX? or is there something else going on?</p>
<p>CLUE: What happen with the sample?</p>
</section>
<section id="the-garch-approach">
<h3><span class="section-number">13.1.3. </span>The GARCH approach<a class="headerlink" href="#the-garch-approach" title="Permalink to this heading">#</a></h3>
<p>The GARCH (Generalized Autoregressive Conditional Heteroskedasticity) model is a popular statistical model used for predicting and modeling the volatility, or variance, of financial time series data. It is widely used in finance and risk management to estimate and forecast the volatility of asset returns.</p>
<p>The GARCH model takes into account both the past values of the time series and the past values of the conditional variance itself.</p>
<p>The GARCH model is typically expressed as follows:</p>
<div class="math notranslate nohighlight">
\[
\sigma_t^2 = \omega + \sum_{i=1}^{p} \alpha_i \epsilon_{t-i}^2 + \sum_{j=1}^{q} \beta_j \sigma_{t-j}^2
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\sigma_t^2\)</span> is the conditional variance at time <span class="math notranslate nohighlight">\(t\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(\omega\)</span> is the constant term,</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha_i\)</span> and <span class="math notranslate nohighlight">\(\beta_j\)</span> are the coefficients of the model,</p></li>
<li><p><span class="math notranslate nohighlight">\(\epsilon_{t-i}^2\)</span> is the squared residual at time <span class="math notranslate nohighlight">\(t-i\)</span>, and</p></li>
<li><p><span class="math notranslate nohighlight">\(\sigma_{t-j}^2\)</span> is the conditional variance at time <span class="math notranslate nohighlight">\(t-j\)</span>.</p></li>
</ul>
<p>The GARCH model allows for the estimation of the parameters <span class="math notranslate nohighlight">\(\omega\)</span>, <span class="math notranslate nohighlight">\(\alpha_i\)</span>, and <span class="math notranslate nohighlight">\(\beta_j\)</span> using various estimation techniques such as maximum likelihood estimation. Once the parameters are estimated, the model can be used to forecast the future conditional variance of the time series.</p>
<p>By predicting the volatility of a financial time series, the GARCH model can be used to assess and manage risk in various financial applications, such as portfolio optimization, option pricing, and risk management strategies.</p>
<ul class="simple">
<li><p>Estimate GARCH for market</p></li>
<li><p>Show T periods forecast</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">arch</span> <span class="kn">import</span> <span class="n">arch_model</span>

<span class="c1"># Assume returns is your time series data</span>
<span class="c1"># returns = ...</span>
<span class="n">monthly_returns</span><span class="o">=</span><span class="n">market_factor</span><span class="c1">#.resample(&#39;M&#39;).agg(lambda x: np.prod(1+x/100)-1)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">arch_model</span><span class="p">(</span><span class="n">monthly_returns</span><span class="p">,</span> <span class="n">vol</span><span class="o">=</span><span class="s1">&#39;Garch&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">model_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Iteration:      1,   Func. Count:     29,   Neg. LLF: 87280152.13492987
Iteration:      2,   Func. Count:     62,   Neg. LLF: 3101026.2797004567
Iteration:      3,   Func. Count:     92,   Neg. LLF: 72273.85519082382
Iteration:      4,   Func. Count:    121,   Neg. LLF: 61029.03605963528
Iteration:      5,   Func. Count:    150,   Neg. LLF: 57262.68006262315
Iteration:      6,   Func. Count:    179,   Neg. LLF: 54292.69272537783
Iteration:      7,   Func. Count:    208,   Neg. LLF: 38605.633297890476
Iteration:      8,   Func. Count:    238,   Neg. LLF: 50356.14610061475
Iteration:      9,   Func. Count:    268,   Neg. LLF: 41564.60189180337
Iteration:     10,   Func. Count:    298,   Neg. LLF: 32993.7955221611
Iteration:     11,   Func. Count:    327,   Neg. LLF: 33216.99354341255
Iteration:     12,   Func. Count:    356,   Neg. LLF: 31750.055176004185
Iteration:     13,   Func. Count:    385,   Neg. LLF: 31917.328606507836
Iteration:     14,   Func. Count:    414,   Neg. LLF: 31949.548379002958
Iteration:     15,   Func. Count:    443,   Neg. LLF: 31642.063906500473
Iteration:     16,   Func. Count:    472,   Neg. LLF: 31723.515581103155
Iteration:     17,   Func. Count:    501,   Neg. LLF: 31610.128951485793
Iteration:     18,   Func. Count:    530,   Neg. LLF: 31762.902310908597
Iteration:     19,   Func. Count:    559,   Neg. LLF: 31598.114267905567
Iteration:     20,   Func. Count:    588,   Neg. LLF: 31592.475334015817
Iteration:     21,   Func. Count:    617,   Neg. LLF: 31604.00898495259
Iteration:     22,   Func. Count:    646,   Neg. LLF: 31587.551561909095
Iteration:     23,   Func. Count:    674,   Neg. LLF: 31595.557250378937
Iteration:     24,   Func. Count:    703,   Neg. LLF: 31588.38913665318
Iteration:     25,   Func. Count:    732,   Neg. LLF: 31587.098325900584
Iteration:     26,   Func. Count:    760,   Neg. LLF: 31587.390984344733
Iteration:     27,   Func. Count:    789,   Neg. LLF: 31586.963758821294
Iteration:     28,   Func. Count:    817,   Neg. LLF: 31586.849975719997
Iteration:     29,   Func. Count:    845,   Neg. LLF: 31586.76201261629
Iteration:     30,   Func. Count:    873,   Neg. LLF: 31586.75673644639
Iteration:     31,   Func. Count:    901,   Neg. LLF: 31586.756109855833
Iteration:     32,   Func. Count:    929,   Neg. LLF: 31586.754926675374
Iteration:     33,   Func. Count:    957,   Neg. LLF: 31586.754916098966
Iteration:     34,   Func. Count:    985,   Neg. LLF: 31586.754914291363
Iteration:     35,   Func. Count: 1.01e+03,   Neg. LLF: 34114.32911030575
Optimization terminated successfully    (Exit mode 0)
            Current function value: 31586.754914290254
            Iterations: 36
            Function evaluations: 1019
            Gradient evaluations: 35
</pre></div>
</div>
<div class="output text_html"><table class="simpletable">
<caption>Constant Mean - GARCH Model Results</caption>
<tr>
  <th>Dep. Variable:</th>       <td>Mkt-RF</td>       <th>  R-squared:         </th>  <td>   0.000</td> 
</tr>
<tr>
  <th>Mean Model:</th>       <td>Constant Mean</td>   <th>  Adj. R-squared:    </th>  <td>   0.000</td> 
</tr>
<tr>
  <th>Vol Model:</th>            <td>GARCH</td>       <th>  Log-Likelihood:    </th> <td>  -31586.8</td>
</tr>
<tr>
  <th>Distribution:</th>        <td>Normal</td>       <th>  AIC:               </th> <td>   63227.5</td>
</tr>
<tr>
  <th>Method:</th>        <td>Maximum Likelihood</td> <th>  BIC:               </th> <td>   63447.6</td>
</tr>
<tr>
  <th></th>                        <td></td>          <th>  No. Observations:  </th>    <td>25649</td>  
</tr>
<tr>
  <th>Date:</th>           <td>Wed, Mar 20 2024</td>  <th>  Df Residuals:      </th>    <td>25648</td>  
</tr>
<tr>
  <th>Time:</th>               <td>18:21:27</td>      <th>  Df Model:          </th>      <td>1</td>    
</tr>
</table>
<table class="simpletable">
<caption>Mean Model</caption>
<tr>
   <td></td>     <th>coef</th>     <th>std err</th>      <th>t</th>       <th>P>|t|</th>     <th>95.0% Conf. Int.</th>   
</tr>
<tr>
  <th>mu</th> <td>    0.0572</td> <td>1.607e-02</td> <td>    3.561</td> <td>3.692e-04</td> <td>[2.573e-02,8.872e-02]</td>
</tr>
</table>
<table class="simpletable">
<caption>Volatility Model</caption>
<tr>
      <td></td>        <th>coef</th>     <th>std err</th>      <th>t</th>       <th>P>|t|</th>   <th>95.0% Conf. Int.</th> 
</tr>
<tr>
  <th>omega</th>    <td>    0.0254</td> <td>    0.520</td> <td>4.894e-02</td> <td>    0.961</td> <td>[ -0.993,  1.044]</td>
</tr>
<tr>
  <th>alpha[1]</th> <td>    0.1217</td> <td>    0.185</td> <td>    0.658</td> <td>    0.511</td> <td>[ -0.241,  0.484]</td>
</tr>
<tr>
  <th>alpha[2]</th> <td>    0.0814</td> <td>    3.165</td> <td>2.572e-02</td> <td>    0.979</td> <td>[ -6.122,  6.285]</td>
</tr>
<tr>
  <th>alpha[3]</th> <td>5.3036e-03</td> <td>    3.403</td> <td>1.558e-03</td> <td>    0.999</td> <td>[ -6.665,  6.676]</td>
</tr>
<tr>
  <th>alpha[4]</th> <td>    0.0297</td> <td>    0.700</td> <td>4.244e-02</td> <td>    0.966</td> <td>[ -1.341,  1.401]</td>
</tr>
<tr>
  <th>alpha[5]</th> <td>3.1291e-17</td> <td>    0.940</td> <td>3.330e-17</td> <td>    1.000</td> <td>[ -1.841,  1.841]</td>
</tr>
<tr>
  <th>beta[1]</th>  <td>    0.0998</td> <td>   24.615</td> <td>4.055e-03</td> <td>    0.997</td> <td>[-48.145, 48.345]</td>
</tr>
<tr>
  <th>beta[2]</th>  <td>    0.5224</td> <td>    9.778</td> <td>5.343e-02</td> <td>    0.957</td> <td>[-18.642, 19.687]</td>
</tr>
<tr>
  <th>beta[3]</th>  <td>1.1263e-09</td> <td>   26.345</td> <td>4.275e-11</td> <td>    1.000</td> <td>[-51.635, 51.635]</td>
</tr>
<tr>
  <th>beta[4]</th>  <td>4.1476e-17</td> <td>   13.226</td> <td>3.136e-18</td> <td>    1.000</td> <td>[-25.923, 25.923]</td>
</tr>
<tr>
  <th>beta[5]</th>  <td>4.1688e-17</td> <td>    9.680</td> <td>4.307e-18</td> <td>    1.000</td> <td>[-18.973, 18.973]</td>
</tr>
<tr>
  <th>beta[6]</th>  <td>1.0747e-09</td> <td>    1.492</td> <td>7.203e-10</td> <td>    1.000</td> <td>[ -2.924,  2.924]</td>
</tr>
<tr>
  <th>beta[7]</th>  <td>    0.0612</td> <td>    2.199</td> <td>2.782e-02</td> <td>    0.978</td> <td>[ -4.249,  4.371]</td>
</tr>
<tr>
  <th>beta[8]</th>  <td>5.2737e-10</td> <td>    8.097</td> <td>6.513e-11</td> <td>    1.000</td> <td>[-15.869, 15.869]</td>
</tr>
<tr>
  <th>beta[9]</th>  <td>6.6717e-16</td> <td>    5.092</td> <td>1.310e-16</td> <td>    1.000</td> <td>[ -9.981,  9.981]</td>
</tr>
<tr>
  <th>beta[10]</th> <td>5.7734e-16</td> <td>    7.192</td> <td>8.027e-17</td> <td>    1.000</td> <td>[-14.097, 14.097]</td>
</tr>
<tr>
  <th>beta[11]</th> <td>8.0013e-16</td> <td>   14.039</td> <td>5.699e-17</td> <td>    1.000</td> <td>[-27.516, 27.516]</td>
</tr>
<tr>
  <th>beta[12]</th> <td>1.2914e-10</td> <td>    6.491</td> <td>1.990e-11</td> <td>    1.000</td> <td>[-12.722, 12.722]</td>
</tr>
<tr>
  <th>beta[13]</th> <td>6.1068e-16</td> <td>   22.102</td> <td>2.763e-17</td> <td>    1.000</td> <td>[-43.318, 43.318]</td>
</tr>
<tr>
  <th>beta[14]</th> <td>7.0716e-16</td> <td>   14.228</td> <td>4.970e-17</td> <td>    1.000</td> <td>[-27.887, 27.887]</td>
</tr>
<tr>
  <th>beta[15]</th> <td>8.4043e-16</td> <td>   15.379</td> <td>5.465e-17</td> <td>    1.000</td> <td>[-30.143, 30.143]</td>
</tr>
<tr>
  <th>beta[16]</th> <td>8.4142e-16</td> <td>   13.782</td> <td>6.105e-17</td> <td>    1.000</td> <td>[-27.013, 27.013]</td>
</tr>
<tr>
  <th>beta[17]</th> <td>9.0297e-16</td> <td>    3.195</td> <td>2.827e-16</td> <td>    1.000</td> <td>[ -6.261,  6.261]</td>
</tr>
<tr>
  <th>beta[18]</th> <td>7.4625e-16</td> <td>    8.107</td> <td>9.205e-17</td> <td>    1.000</td> <td>[-15.890, 15.890]</td>
</tr>
<tr>
  <th>beta[19]</th> <td>7.9076e-10</td> <td>    1.040</td> <td>7.602e-10</td> <td>    1.000</td> <td>[ -2.039,  2.039]</td>
</tr>
<tr>
  <th>beta[20]</th> <td>    0.0566</td> <td>    3.499</td> <td>1.618e-02</td> <td>    0.987</td> <td>[ -6.801,  6.914]</td>
</tr>
</table><br/><br/>Covariance estimator: robust</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this is the model best estimate of volatility at a given point in time</span>
<span class="n">ax</span><span class="o">=</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">conditional_volatility</span><span class="o">*</span><span class="mi">252</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="c1"># If we want next period volatility</span>

<span class="n">forecasts</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">horizon</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Get the variance</span>
<span class="n">variance_forecast</span> <span class="o">=</span> <span class="n">forecasts</span><span class="o">.</span><span class="n">variance</span><span class="o">*</span><span class="mi">252</span>

<span class="c1"># Get the standard deviation (volatility) by taking the square root of the variance</span>
<span class="p">((</span><span class="n">variance_forecast</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\Alan.Moreira\Anaconda3\lib\site-packages\arch\__future__\_utility.py:11: FutureWarning: 
The default for reindex is True. After September 2021 this will change to
False. Set reindex to True or False to silence this message. Alternatively,
you can use the import comment

from arch.__future__ import reindexing

to globally set reindex to True and silence this warning.

  warnings.warn(
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/8ea861febb2ad11e3db6caa4c921cb14efe62c63c5aaf36b83236d0f4ddd0f89.png" src="../../_images/8ea861febb2ad11e3db6caa4c921cb14efe62c63c5aaf36b83236d0f4ddd0f89.png" />
</div>
</div>
<p>Basically on top of each other</p>
<p>Lets look at how it forecasts for a given date how volatiltiy will behave many month in the future</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h</span><span class="o">=</span><span class="mi">60</span>
<span class="n">forecasts</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">horizon</span><span class="o">=</span><span class="n">h</span><span class="p">)</span>

<span class="c1"># Get the variance</span>
<span class="n">variance_forecast</span> <span class="o">=</span> <span class="n">forecasts</span><span class="o">.</span><span class="n">variance</span>

<span class="c1"># Get the standard deviation (volatility) by taking the square root of the variance</span>
<span class="n">volatility_forecast</span> <span class="o">=</span> <span class="p">(</span><span class="n">variance_forecast</span><span class="o">*</span><span class="mi">252</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

<span class="c1"># Print the 3-month ahead forecasted volatility for all data points</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">h</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">volatility_forecast</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2020-03-23&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\Alan.Moreira\Anaconda3\lib\site-packages\arch\__future__\_utility.py:11: FutureWarning: 
The default for reindex is True. After September 2021 this will change to
False. Set reindex to True or False to silence this message. Alternatively,
you can use the import comment

from arch.__future__ import reindexing

to globally set reindex to True and silence this warning.

  warnings.warn(
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x19a503e1370&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e13d0&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e14f0&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e1610&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e1730&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e1850&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e1970&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e1a90&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e1bb0&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e1cd0&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e1df0&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e13a0&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e7040&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e7160&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e7280&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e73a0&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e74c0&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e75e0&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e7700&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e7820&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e7940&gt;,
 &lt;matplotlib.lines.Line2D at 0x19a503e7a60&gt;]
</pre></div>
</div>
<img alt="../../_images/599b6e0f709a2966ea392466a438c460320a28dd657e8fb99505a183615eb90d.png" src="../../_images/599b6e0f709a2966ea392466a438c460320a28dd657e8fb99505a183615eb90d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">h</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">volatility_forecast</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2020-03-20&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x19a50534dc0&gt;]
</pre></div>
</div>
<img alt="../../_images/7bd70da172719271c9da895e9eeb74fbb7c8eef03f4af09ad5284c3ee9514bd4.png" src="../../_images/7bd70da172719271c9da895e9eeb74fbb7c8eef03f4af09ad5284c3ee9514bd4.png" />
</div>
</div>
<p>Which one is better?</p>
<p>different approaches to deal with this</p>
<p>There is a whole field dedicated to forecasting</p>
<p>But the basic idea is simple</p>
<p>You wan to have some penalty for it: What is the cost of getting it wrong?</p>
<p>We could simply have a penalty:</p>
<div class="math notranslate nohighlight">
\[\gamma E[(Variance(model)-Variance(Truth))^2]\]</div>
<p>Basically this the “Mean-Squared Error” approach to evaluating forecasts</p>
<p>Here we need some estimate of the true variance</p>
<p>Below we assume it is the realized variance</p>
<p>It is very important that they are in the same units!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is the model that that uses VIX</span>

<span class="nb">print</span><span class="p">(((</span><span class="n">results4</span><span class="o">.</span><span class="n">fittedvalues</span><span class="o">-</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">var</span><span class="p">())</span> <span class="c1"># divide by the variable variance to have a sense of how big are your mistakes!</span>

<span class="c1"># tbhis is the model that use 5 days and 1 month lagged RV (but much longer sample!)</span>
<span class="nb">print</span><span class="p">(((</span><span class="n">results3</span><span class="o">.</span><span class="n">fittedvalues</span><span class="o">/</span><span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="o">-</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">var</span><span class="p">())</span> <span class="c1">#multiply to put in the same units</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.4051535764714756
0.6810322727264222
</pre></div>
</div>
</div>
</div>
<p>How do you make it more comparable?</p>
<p>Lets add the GARCH to the mix</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">forecasts</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">horizon</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Get the variance</span>
<span class="n">variance_forecast</span> <span class="o">=</span> <span class="n">forecasts</span><span class="o">.</span><span class="n">variance</span><span class="o">*</span><span class="mi">12</span>

<span class="c1"># check units!</span>

<span class="nb">print</span><span class="p">(</span><span class="n">variance_forecast</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">((</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>h.1    0.035207
dtype: float64
0.030773669974337045
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\Alan.Moreira\Anaconda3\lib\site-packages\arch\__future__\_utility.py:11: FutureWarning: 
The default for reindex is True. After September 2021 this will change to
False. Set reindex to True or False to silence this message. Alternatively,
you can use the import comment

from arch.__future__ import reindexing

to globally set reindex to True and silence this warning.

  warnings.warn(
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(((</span><span class="n">variance_forecast</span><span class="p">[</span><span class="s1">&#39;h.1&#39;</span><span class="p">]</span><span class="o">-</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">var</span><span class="p">())</span> <span class="c1">#multiply to put in the same units</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6654570726042942
</pre></div>
</div>
</div>
</div>
<p>Note that to make it comparable we should look at similar samples.</p>
<p>Why is that? How would you do that?</p>
<p>A cool thing is that we can be sharper in our context.</p>
<p>If we are willing to assume the investor has mean-variance preferences</p>
<div class="math notranslate nohighlight">
\[E[xR]-\frac{\gamma}{2}Var(xR)\]</div>
<p>Then the utility cost of believing the variance is V1 when the truth is V2 is</p>
<p>just the difference in utilities</p>
<div class="math notranslate nohighlight">
\[\frac{1}{2\gamma}\mu^2(\frac{V1-V2}{\sqrt{V2}V1})^2\]</div>
<p>We can then normalize by the utility we would get if we knew then right variance</p>
<div class="math notranslate nohighlight">
\[\frac{1}{2\gamma}\frac{\mu^2}{V2}\]</div>
<p>and we get</p>
<div class="math notranslate nohighlight">
\[(\frac{V1-V2}{V_1})^2\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
<span class="n">InteractiveShell</span><span class="o">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>

<span class="n">V1</span><span class="o">=</span><span class="n">variance_forecast</span><span class="p">[</span><span class="s1">&#39;h.1&#39;</span><span class="p">]</span>
<span class="n">V2</span><span class="o">=</span> <span class="n">market_RV</span><span class="o">.</span><span class="n">RV1m</span><span class="o">**</span><span class="mi">2</span>
<span class="n">V1</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">V2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="p">(((</span><span class="n">V1</span><span class="o">-</span><span class="n">V2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">V1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="c1">#multiply to put in the same units</span>

<span class="n">V1</span><span class="o">=</span><span class="n">results4</span><span class="o">.</span><span class="n">fittedvalues</span>
<span class="n">V1</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="p">(((</span><span class="n">V1</span><span class="o">-</span><span class="n">V2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">V1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="c1">#multiply to put in the same units</span>

<span class="n">V1</span><span class="o">=</span><span class="n">results3</span><span class="o">.</span><span class="n">fittedvalues</span><span class="o">/</span><span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span>
<span class="n">V1</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="p">(((</span><span class="n">V1</span><span class="o">-</span><span class="n">V2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">V1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="c1">#multiply to put in the same units</span>

<span class="n">V1</span><span class="o">=</span><span class="n">results2</span><span class="o">.</span><span class="n">fittedvalues</span><span class="o">/</span><span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span>
<span class="n">V1</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="p">(((</span><span class="n">V1</span><span class="o">-</span><span class="n">V2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">V1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="c1">#multiply to put in the same units</span>

<span class="n">V1</span><span class="o">=</span><span class="n">results1</span><span class="o">.</span><span class="n">fittedvalues</span><span class="o">/</span><span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span>
<span class="n">V1</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="p">(((</span><span class="n">V1</span><span class="o">-</span><span class="n">V2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">V1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="c1">#multiply to put in the same units</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.03520698196484563
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.030773669974337045
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8157334674506211
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.03498733006993004
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>733.6436990346128
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.03077366997433707
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.8520782506437237
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.03081988363636368
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.3072938841409907
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.03077366997433702
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.959125188899544
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="dynamic-portfolios">
<h2><span class="section-number">13.2. </span>Dynamic Portfolios<a class="headerlink" href="#dynamic-portfolios" title="Permalink to this heading">#</a></h2>
<p>The key idea here will be to use the factor structure idea for returns together with a GARCH or RV model for the market return volatility.</p>
<p>The idea here is</p>
<ul class="simple">
<li><p>Correlations do change, but they change slower than variance so we will use standard rolling window to estimate correlations–essentially assuming that they are constant in our forecast horizon.</p></li>
<li><p>And use our model to forecast the the variance</p></li>
</ul>
<p>IF returns have a factor structure we have</p>
<div class="math notranslate nohighlight">
\[Var_t(R_{t+1})=Var(\beta_t F_{t+1}+u_{t+1})=\beta_t Var_t(F) \beta_t'+Var_t(u)\]</div>
<p>We thus need to produce estimates for the time-varying betas</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/Finance"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="Volatilitytiming.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">12.2. </span>Volatility timing</p>
      </div>
    </a>
    <a class="right-next"
       href="MachineLearning.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">14. </span>Machine Learning and AI</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measuring-time-varying-risk">13.1. Measuring Time-varying risk</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-varying-risk-in-a-single-asset-or-trading-strategy">13.1.1. Time-varying risk in a single asset (or trading strategy)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-realized-variance-approach">13.1.2. The Realized variance approach</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-garch-approach">13.1.3. The GARCH approach</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-portfolios">13.2. Dynamic Portfolios</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alan Moreira
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2021 Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>