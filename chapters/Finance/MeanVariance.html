

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>6. Mean-Variance Investing &#8212; Quantitative Investing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/Finance/MeanVariance';</script>
    <link rel="canonical" href="https://amoreira2.github.io/Fin418/chapters/Finance/MeanVariance.html" />
    <link rel="shortcut icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="7. Trading Strategies" href="TradingStrategies.html" />
    <link rel="prev" title="5.5. Applied Linear Algebra" href="../scientific/linear_algebra1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/figuremain2.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/figuremain2.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/what-is-quant-investing.html">1. What is Quantitative Investing?</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/statistical-techniques.html">1.1. Statistical Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/computational-tools.html">1.2. Computational tools</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/getting_started.html">2. Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/local_install.html">2.3. Local installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/cloud_setup.html">2.4. Cloud Setup</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../essentials/intro.html">3. Python Essentials</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../essentials/basics.html">3.1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/collections.html">3.2. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/numpy.html">3.3. Numpy</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../essentials/introtopandas.html">3.4. Pandas</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/the_index.html">3.4.3. Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/timeseries.html">3.4.4. Time-Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/reshape.html">3.4.5. Reshape</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/merge.html">3.4.6. Merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/groupby.html">3.4.7. Group-by</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/matplotlib.html">3.4.8. Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/data_clean.html">3.4.9. Cleaning data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/storage_formats.html">3.4.10. Data Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/control_flow.html">3.5. Flow control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/functions.html">3.6. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/plotting.html">3.7. Plotting</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Returns.html">4. Asset Returns</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="UsingAPI.html">4.3. Data APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="TheChoiceofFrequency.html">4.4. The Choice of Frequency and Annualization of Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scientific/randomness1.html">4.5. Modeling randomness</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="PortfolioMath.html">5. Portfolio Math</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../scientific/linear_algebra1.html">5.5. Linear algebra Review</a></li>
</ul>
</li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">6. Mean-Variance Investing</a></li>
<li class="toctree-l1"><a class="reference internal" href="TradingStrategies.html">7. Trading Strategies</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="FactorModels.html">8. Factor Models</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="MultiFactorModels.html">8.2. Multi Factor Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="ExpectedReturnModels.html">8.3. Factor Models as Models of Expected Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="InterpretingFactorModels.html">8.4. Interpreting Factor Models</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="crosssectionalequitystrategies.html">9. Cross-Sectional Equity Strategies</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="MarketCapweighted.html">9.1. The Market Cap Weighted Portfolio</a></li>
<li class="toctree-l2"><a class="reference internal" href="Valueinvesting.html">9.2. Value factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="Momentum.html">9.3. Momentum factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="OtherEquityStrategies.html">9.4. Other Equity strategies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Robustness.html">10. Robustness of Quantitative Strategies</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Timing.html">11. Factor Timing</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="Volatilitytiming.html">11.2. Volatility Timing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Implementation.html">12. Liquidity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional/additional.html">13. Additional Statistics Material</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Assignments/Assignments.html">14. Assignments</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment0.html">14.1. Assigment 0</a></li>





<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment1.html">14.7. Assignment 1</a></li>




<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment2.html">14.12. Assigment 2</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment3.html">14.16. Assignment 3</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment4.html">14.20. Assignment 4</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment5.html">14.24. Assigment 5</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment6.html">14.28. Assignment 6</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment7.html">14.32. Assignment 7</a></li>

</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/amoreira2/Fin418/blob/main/chapters/Finance/MeanVariance.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418/issues/new?title=Issue%20on%20page%20%2Fchapters/Finance/MeanVariance.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/Finance/MeanVariance.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Mean-Variance Investing</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-bond-equity-strategic-investment-problem-of-an-international-investor">6.1. A bond-equity strategic investment problem of an international investor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-solution">6.2. Numerical solution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analytical-solution">6.3. Analytical solution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sharpe-ratio">6.4. Sharpe-ratio !</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-the-mean-variance-efficient-portfolio">6.5. <strong>Finding the Mean-variance efficient portfolio</strong></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="mean-variance-investing">
<h1><span class="section-number">6. </span>Mean-Variance Investing<a class="headerlink" href="#mean-variance-investing" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>How should we allocate capital?</p></li>
<li><p>You learn that very much depends on your preferences</p>
<ul>
<li><p>What do you want to do with the money and when?</p></li>
<li><p>how terrible you feel if you have less than you expected</p></li>
<li><p>how much joy would you enjoy if you had more</p></li>
<li><p>depends on your risk-aversion, but also on lots of assumptions about you actually care about</p></li>
</ul>
</li>
<li><p>Under some assumptions about our preferences it comes down to a mean-variance criteria where you want to maximize the expected value  of your wealth at some future date (say when you retire) with a penalty for it’s variance</p></li>
<li><p>this can be written as maximizing the returns of your portfolio</p></li>
</ul>
<div class="math notranslate nohighlight">
\[ \max_X E[X'R_T]-a Var(X'R_T)\]</div>
<ul class="simple">
<li><p>where we typically call this <span class="math notranslate nohighlight">\(a\)</span> parameter risk-aversion, because it captures how much you dislike that your wealth will move in unpredictable ways</p></li>
<li><p>A similar criteria shows up in delegate asset management</p></li>
<li><p>in hedge funds, manager get allocated some capital <span class="math notranslate nohighlight">\(W_0\)</span> and some volatility budget <span class="math notranslate nohighlight">\(Vmax\)</span>, and are compensated by their absolute performance</p></li>
<li><p>so their problem is something like</p></li>
</ul>
<p><span class="math notranslate nohighlight">\( \max_X E[X'R_T]\)</span> subject to <span class="math notranslate nohighlight">\(Var(X'R_T)\leq Vmax\)</span></p>
<ul class="simple">
<li><p>in mutual funds there is often a benchmark, say the S&amp;P 500 and the manager has a mandate to have a tracking error relative to the benchmark that is low enough, say <span class="math notranslate nohighlight">\(Tmax\)</span></p></li>
<li><p>and the manager is compensated only with respect to the returns above this benchmark</p></li>
<li><p>tracking error is the volatility of the portfolio relative to the benchmark</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\sqrt{var(X'R_T-R^{benchmark}_T)}\]</div>
<ul class="simple">
<li><p>So the manager problem is something like</p></li>
</ul>
<p><span class="math notranslate nohighlight">\( \max_X E[X'R_T-R^{benchmark}_T]\)</span> subject to <span class="math notranslate nohighlight">\(Var(X'R_T-R^{benchmark}_T)\leq Tmax\)</span></p>
<ul class="simple">
<li><p>thus lots of investment problems are versions of mean-variance</p></li>
<li><p>often these investment problems have a variety of additional constraints</p>
<ul>
<li><p>concentration limits by industry</p></li>
<li><p>leverage limits</p></li>
<li><p>shorting constraints</p></li>
<li><p>etc</p></li>
</ul>
</li>
<li><p>Hard part is not solving the problem–that is easy!</p></li>
<li><p>We will show how to do that numerically and analytically</p></li>
<li><p>Numerical solution will alow for a variety of constraints</p></li>
<li><p>Analytical solution cannot deal with constraints and assumes free borrowing and lending at the risk-free rate</p></li>
<li><p>numerical solution is nice because it allow us to see clearly what this problem is all about.</p></li>
<li><p>the hard problem is knowing the Expected returns of the assets and their covariance matrix</p></li>
</ul>
<section id="a-bond-equity-strategic-investment-problem-of-an-international-investor">
<h2><span class="section-number">6.1. </span>A bond-equity strategic investment problem of an international investor<a class="headerlink" href="#a-bond-equity-strategic-investment-problem-of-an-international-investor" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>we will assume here that the risk-premium is being generated from a constant distribution</p></li>
<li><p>this is wrong, but for large well diversified portfolio not too bad</p></li>
<li><p>under this assumption, our estimation problem amounts to using sample means</p></li>
<li><p>ths risk-free rate is time-varying so we will have to deal with it</p></li>
</ul>
<p>We start by loading out return data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://raw.githubusercontent.com/amoreira2/Lectures/main/assets/data/GlobalFinMonthly.csv&quot;</span>
<span class="n">Data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">na_values</span><span class="o">=-</span><span class="mi">99</span><span class="p">)</span>
<span class="n">Data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">Data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
<span class="n">Data</span><span class="o">=</span><span class="n">Data</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
<span class="c1"># the assets are the risk-free rate, the us equity market, the us bond market, the emerging market, the global equity market (without US), and the global bond market (without US)</span>

<span class="n">Data</span><span class="o">=</span><span class="n">Data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">Data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="s2">&quot;MKTUS&quot;</span><span class="p">,</span><span class="n">Data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s2">&quot;BondUS&quot;</span><span class="p">,</span>
                          <span class="n">Data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="s2">&quot;EM&quot;</span><span class="p">,</span><span class="n">Data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s2">&quot;MKTxUS&quot;</span><span class="p">,</span><span class="n">Data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s2">&quot;BondxUS&quot;</span> <span class="p">})</span>
<span class="n">Data</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RF</th>
      <th>MKTUS</th>
      <th>BondUS</th>
      <th>EM</th>
      <th>MKTxUS</th>
      <th>BondxUS</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2016-08-31</th>
      <td>0.0002</td>
      <td>0.0052</td>
      <td>-0.008417</td>
      <td>0.025186</td>
      <td>0.000838</td>
      <td>-0.009552</td>
    </tr>
    <tr>
      <th>2016-09-30</th>
      <td>0.0002</td>
      <td>0.0027</td>
      <td>-0.016417</td>
      <td>0.013153</td>
      <td>0.012736</td>
      <td>0.009979</td>
    </tr>
    <tr>
      <th>2016-10-31</th>
      <td>0.0002</td>
      <td>-0.0200</td>
      <td>-0.049460</td>
      <td>0.002474</td>
      <td>-0.020383</td>
      <td>-0.043476</td>
    </tr>
    <tr>
      <th>2016-11-30</th>
      <td>0.0001</td>
      <td>0.0487</td>
      <td>-0.081636</td>
      <td>-0.045971</td>
      <td>-0.019798</td>
      <td>-0.050359</td>
    </tr>
    <tr>
      <th>2016-12-31</th>
      <td>0.0003</td>
      <td>0.0185</td>
      <td>-0.005296</td>
      <td>0.002904</td>
      <td>0.034383</td>
      <td>-0.023207</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we start by constructing excess returns by subtracting the risk-free rate from the returns of the assets and we drop the risk-free rate column</span>
<span class="n">Re</span><span class="o">=</span><span class="n">Data</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">Data</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># we compute the mean and covariance matrix of the excess returns</span>
<span class="n">ERe</span><span class="o">=</span><span class="n">Re</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ERe</span><span class="p">)</span>
<span class="n">Cove</span><span class="o">=</span><span class="n">Re</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Cove</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MKTUS      0.005140
BondUS     0.002523
EM         0.006923
MKTxUS     0.004149
BondxUS    0.002054
dtype: float64
            MKTUS    BondUS        EM    MKTxUS   BondxUS
MKTUS    0.001948  0.000111  0.001292  0.001264  0.000187
BondUS   0.000111  0.001227 -0.000204 -0.000013  0.000264
EM       0.001292 -0.000204  0.003556  0.001661  0.000249
MKTxUS   0.001264 -0.000013  0.001661  0.002182  0.000422
BondxUS  0.000187  0.000264  0.000249  0.000422  0.000407
</pre></div>
</div>
</div>
</div>
<p>Suppose I want to reconstruct my current estimates of Expected returns and the covariance matrix of returns ( and not excess returns), What do I do?</p>
<p>Simply add the current risk-free rate to you estimate of the expected return</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set the risk-free rate to the current value of the 3-month T-bill rate divided by 12 to make it a monthly rate</span>
<span class="n">rf</span><span class="o">=</span><span class="mf">0.0525</span><span class="o">/</span><span class="mi">12</span>
<span class="c1"># add to our estimate of risk-premiumns to get our estimate of expected returns</span>

<span class="n">ER</span><span class="o">=</span><span class="n">ERe</span><span class="o">+</span><span class="n">rf</span>
</pre></div>
</div>
</div>
</div>
<p>What about the covariance piece?</p>
</section>
<section id="numerical-solution">
<h2><span class="section-number">6.2. </span>Numerical solution<a class="headerlink" href="#numerical-solution" title="Permalink to this heading">#</a></h2>
<p>Lets start by solving</p>
<p><span class="math notranslate nohighlight">\( \max_X E[X'R_T]\)</span> subject to <span class="math notranslate nohighlight">\(Var(X'R_T)\leq Vmax\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># STEP 1: define the fucntion that computes the portfolio variance and expected returns given a vector of weights X (initially set to equal weights)</span>

<span class="k">def</span> <span class="nf">portfolio_variance</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">X</span> <span class="o">@</span> <span class="n">Cove</span> <span class="o">@</span> <span class="n">X</span>

<span class="k">def</span> <span class="nf">portfolio_expected_return</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">X</span> <span class="o">@</span> <span class="n">ER</span>

<span class="nb">print</span><span class="p">(</span><span class="n">portfolio_variance</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">portfolio_variance</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">portfolio_expected_return</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">portfolio_expected_return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0007914039297139136
0.0008490361488465391
0.008532889760767246
0.00820649669319938
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># STEP 2: define the constraint functions, </span>

<span class="c1"># here we will have one inequality for the portfolio variance , lets say a volatility of 10% per year. How do we translate this into a monthly variance?</span>

<span class="c1"># and one equality constraint for the weights to sum to one</span>



<span class="n">Vmax</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span>
<span class="n">cons</span><span class="o">=</span> <span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span>
          <span class="s1">&#39;fun&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">X</span><span class="p">:</span> <span class="o">-</span><span class="n">portfolio_variance</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">+</span><span class="n">Vmax</span><span class="p">},</span>
          <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
          <span class="s1">&#39;fun&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">})</span>

<span class="c1"># the constraint is normalized so that</span>

<span class="c1">#cons=({&#39;type&#39;: &#39;ineq&#39;,</span>
<span class="c1">#          &#39;fun&#39; : lambda X: F(X)})</span>

<span class="c1">#means F(X)&gt;=0</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Finally we are ready to do our minimization</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options={'disp':</span> <span class="pre">True}</span></code>: tell python to report intermediary steps so we can check if the algorithm is doing progress towards a solution.</p></li>
<li><p>There is a variety of additional parameters that you can pass to the minimizer.</p></li>
<li><p>see: <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html">https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html</a></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># STEP 3: solve the minimization problem with constraints and save as `sol`</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="n">X0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="k">lambda</span> <span class="n">X</span><span class="p">:</span> <span class="o">-</span><span class="n">portfolio_expected_return</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="n">X0</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization terminated successfully    (Exit mode 0)
            Current function value: -0.011929088525593382
            Iterations: 13
            Function evaluations: 78
            Gradient evaluations: 13
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#optimal weights</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># optimal expected return at the annual frequency</span>
<span class="nb">print</span><span class="p">(</span><span class="n">portfolio_expected_return</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span>
<span class="c1"># optimal portfolio volatility at the annual frequenc</span>
<span class="p">(</span><span class="n">portfolio_variance</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 0.65116148  0.38641728  0.8388073  -0.36993916 -0.50644689]
0.1431490623071206
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.20000201024211733
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># below I am plotting the solution weights.</span>
<span class="n">width</span><span class="o">=</span><span class="mf">0.3</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">width</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ER</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/70226f2c4c03e77906a060eca77c2483f49d49a004270d09707785a6327979b0.png" src="../../_images/70226f2c4c03e77906a060eca77c2483f49d49a004270d09707785a6327979b0.png" />
</div>
</div>
<p>Here we assumed the portfolio has to be fully invested in risky assets.</p>
<p>There is no leverage (borrowing at the risk-free rate)</p>
<p>but there is shorting (raising additional funds by selling one asset)</p>
<p>Note that is X0+X1=1, if X0&lt;0, then X1&gt;1</p>
<p>Exercises to do</p>
<ol class="arabic simple">
<li><p>trace out how the optimal expected return varies as you change Vmax. In yearly volatility units try 6.5%, 7%, 8% , 10% ,15%,30%. Plot the resulting pairs in the scatter plot with the expected return in the y-axis and the volatility in the x-axis. What do you find?</p></li>
<li><p>Add the risk-free rate among the asset. There are different ways to do this. But a simple one is to change the expected return function  <code class="docutils literal notranslate"><span class="pre">X&#64;ER+(1-np.sum(X))*rf</span></code>
* now X is the vector of risky assets only and (1-np.sum(X)) is whatever is the residual
* if this residual is positive you park in cash and earn rf
* if negative you borrow at the rf rate
* now your total weights mechanically add up to 1
* so you need to take out the equality constraint</p></li>
<li><p>Add a shorting constraint, say you can only short equities but not bonds, that is X&gt;0 for certain assets</p></li>
<li><p>Add a leverage cap, so that the sum of your risky assets cannot exceed 1 too much, np.sum(X)-1 is called your leverage, so you can limit it to 1, so that for each dollar you have you borrow at most 1 dollar</p></li>
<li><p>Modify the expected return function to incorporate practical frictions in trading. For example, when you borrow you typically pay more than what you can invest at, there is a borrowing spread. Analogously if you short a stock, you have to pay an extra fee</p></li>
<li><p>Add a benchmark so that the problem comes one with a tracking error constraint. You would have to modify the expected return fuction to reflect the expected return in excess of the benchmark, and the covariance matrix to reflect the variance of <span class="math notranslate nohighlight">\(X'R-R^{benchmark}\)</span></p></li>
</ol>
</section>
<section id="analytical-solution">
<h2><span class="section-number">6.3. </span>Analytical solution<a class="headerlink" href="#analytical-solution" title="Permalink to this heading">#</a></h2>
<p>The analytical solution assumes</p>
<ul class="simple">
<li><p>free borrowing and lending at risk-free rate</p></li>
<li><p>Shorting without any shorting fees</p></li>
</ul>
<p>The optimal weights are</p>
<div class="math notranslate nohighlight">
\[X=\sqrt{\frac{Vmax}{E[R^e]'Var(R^e)^{-1}E[R^e]}}Var(R^e)^{-1}E[R^e]\]</div>
<p>Where Vmax is in monthly variance units</p>
<p>Note that <span class="math notranslate nohighlight">\(\frac{Vmax}{E[R^e]'Var(R^e)^{-1}E[R^e]}\)</span> is a number. Is basically a leverage factor. It leverage up (or down) the portfolio <span class="math notranslate nohighlight">\(Var(R^e)^{-1}E[R^e]\)</span> so that the resulting portfolio has the desired target variance</p>
<p>This portfolio <span class="math notranslate nohighlight">\(Var(R^e)^{-1}E[R^e]\)</span> is quite special because it has the highest Sharpe-ratio among all possible combinations of these assets</p>
</section>
<section id="sharpe-ratio">
<h2><span class="section-number">6.4. </span>Sharpe-ratio !<a class="headerlink" href="#sharpe-ratio" title="Permalink to this heading">#</a></h2>
<p>Sharpe ratio is probably the most used concept in money management, it comes in honor of William Sharpe ( the dude that discovered the CAPM). It reflects how much additional expected return you are getting per unit of volatility. Say you have a portfolio with returns <span class="math notranslate nohighlight">\(R_p\)</span></p>
<div class="math notranslate nohighlight">
\[SharpeRatio=\frac{R_p-rf}{\sigma(R_p)}\]</div>
<p>So a portfolio that has the highest sharpe ratio is nice because it is efficient.</p>
<p>You take the minimum amount of risk that you need to take to achieve a expected return</p>
<p>or conversely you get the maximum possible expected return for a given level of risk that you are willing to take</p>
<hr class="docutils" />
<p><em>Aside: Matrix inversion</em></p>
<ul class="simple">
<li><p>You only need to understand how to operationaize it and in an conceptual level what it does</p></li>
<li><p>But you don’t need to follow all the mathematical details</p></li>
<li><p>If you are interested. you can look in our linear algebra review in <a class="reference external" href="https://amoreira2.github.io/quantitativeinvesting/chapters/scientific/linear_algebra1.html">https://amoreira2.github.io/quantitativeinvesting/chapters/scientific/linear_algebra1.html</a></p></li>
<li><p>I also provide a summary below</p></li>
<li><p>Note that <span class="math notranslate nohighlight">\((2)^{-1}=1/2=0.5\)</span> (naturally!)</p></li>
<li><p><span class="math notranslate nohighlight">\((Var(R^e))^{-1}\)</span> is just like this</p></li>
<li><p>but more complicated because <span class="math notranslate nohighlight">\(Var(R^e)\)</span> is a N by N matrix and we can’t simply divide over to solve for X</p></li>
<li><p>The definition of the inverse function is <span class="math notranslate nohighlight">\(f(x)=x^{-1}=y\)</span> where <span class="math notranslate nohighlight">\(y*x=1\)</span></p></li>
<li><p>for matrices it is the same: <span class="math notranslate nohighlight">\((Var(R^e))^{-1}Var(R^e)=I\)</span>, but now instead of 1, we have an identity matrix, which is a matrix with 1’s in the diagonal and zero everywhere else</p></li>
</ul>
<p>Thankfully we have a function in python that does just that</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># start with a 2 by 2 matrix</span>
<span class="n">a</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="c1"># compute the inverse</span>
<span class="n">ainv</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> 

<span class="n">ainv</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[3 7]
 [0 9]]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 0.33333333, -0.25925926],
       [ 0.        ,  0.11111111]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># indeed ainv is the inverse of a because ainv @ a = I</span>
<span class="n">ainv</span> <span class="o">@</span> <span class="n">a</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1., 0.],
       [0., 1.]])
</pre></div>
</div>
</div>
</div>
<p>This portfolio is very special so it has many names</p>
<ol class="arabic simple">
<li><p>maximum sharpe ratio portfolio</p></li>
<li><p>mean-variance efficient portfolio (MVE)</p></li>
<li><p>Tangency portfolio</p></li>
</ol>
<p>Names 1 and 2 are pretty clear. Name 3 will become clear later in the course</p>
</section>
<hr class="docutils" />
<section id="finding-the-mean-variance-efficient-portfolio">
<h2><span class="section-number">6.5. </span><strong>Finding the Mean-variance efficient portfolio</strong><a class="headerlink" href="#finding-the-mean-variance-efficient-portfolio" title="Permalink to this heading">#</a></h2>
<p>First lets construct our vector of expected excess returns for our risky two assets US equity market and International equity market</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">assets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;MKTUS&#39;</span><span class="p">,</span><span class="s1">&#39;MKTxUS&#39;</span><span class="p">]</span>
<span class="n">e</span><span class="o">=</span><span class="n">ERe</span><span class="p">[</span><span class="n">assets</span><span class="p">]</span>

<span class="n">e</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MKTUS     0.005140
MKTxUS    0.004149
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>We start by estimating the covariance matrix from our data <span class="math notranslate nohighlight">\(Var(R^e)\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">=</span><span class="n">Cove</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">assets</span><span class="p">,</span><span class="n">assets</span><span class="p">]</span>

<span class="n">c</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MKTUS</th>
      <th>MKTxUS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MKTUS</th>
      <td>0.001948</td>
      <td>0.001264</td>
    </tr>
    <tr>
      <th>MKTxUS</th>
      <td>0.001264</td>
      <td>0.002182</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We then invert the covaraicne matrix <span class="math notranslate nohighlight">\(Var(R^e)^{-1}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cinv</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> 

<span class="n">cinv</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 822.50792137, -476.49212708],
       [-476.49212708,  734.40580739]])
</pre></div>
</div>
</div>
</div>
<p>we then use the dot product to cross-mulitply our vector of expected excess returns by the inverse of the covariance matrix</p>
<div class="math notranslate nohighlight">
\[Var(R^e)^{-1}E[R^e]\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Wmve</span><span class="o">=</span><span class="n">cinv</span> <span class="o">@</span> <span class="n">e</span>
<span class="n">Wmve</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([2.25099751, 0.597729  ])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Vmax</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span>
<span class="n">Wmve</span> <span class="o">*</span> <span class="p">(</span><span class="n">Vmax</span><span class="o">/</span><span class="p">(</span><span class="n">e</span> <span class="nd">@cinv</span> <span class="o">@</span> <span class="n">e</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.53401107, 0.14180109])
</pre></div>
</div>
</div>
</div>
<p>Exercises</p>
<ul class="simple">
<li><p>Verify that indeed the entire class of portfolios that solve the problem for different variance targets Vmax are also MVE ( i.e they all have the max sharpe ratio)</p></li>
<li><p>What is the allocation to the risk-free rate? How do you find it? How does it change as you increase/decrease Vmax?</p></li>
<li><p>How does max SR change as you go from</p>
<ol class="arabic simple">
<li><p>only investing in the US equity market</p></li>
<li><p>investing in US equities and US bonds</p></li>
<li><p>Invest everywhere except emerging markets</p></li>
<li><p>investing everywhere including emerging markets</p></li>
<li><p>investing only in global equities and bonds</p></li>
</ol>
</li>
<li><p>look at a portfolio with a fairly high vol target, say 30% per year. discuss the source of the benefits of investing internationally. Why exactly the SR is going up?</p></li>
<li><p>For the four investment opportunity sets above, compute the optimal expected returns for the following volatilities 6.5%, 7%, 8% , 10% ,15%,30%. Plot the results in a scatter plot with volatility in the X-axis and expected returns in the y-axis. You should see 4 lines. Why they look like that?</p></li>
<li><p>Compare the benefits of a US investor to invest globally and the benefit of an international investor investing in the US ( ignore Emerging markets). Looking at individual assets risk-premiums and volatility explain the benefits of investing across multiple assets</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/Finance"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../scientific/linear_algebra1.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5.5. </span>Applied Linear Algebra</p>
      </div>
    </a>
    <a class="right-next"
       href="TradingStrategies.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Trading Strategies</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-bond-equity-strategic-investment-problem-of-an-international-investor">6.1. A bond-equity strategic investment problem of an international investor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-solution">6.2. Numerical solution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analytical-solution">6.3. Analytical solution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sharpe-ratio">6.4. Sharpe-ratio !</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-the-mean-variance-efficient-portfolio">6.5. <strong>Finding the Mean-variance efficient portfolio</strong></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alan Moreira
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2021 Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>