

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>8. Factor models &#8212; Quantitative Investing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/Finance/FactorModels';</script>
    <link rel="canonical" href="https://amoreira2.github.io/Fin418/chapters/Finance/FactorModels.html" />
    <link rel="shortcut icon" href="../../_static/figuremain2.jpg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="13.1. Interpretating Factor models" href="InterpretingFactorModels.html" />
    <link rel="prev" title="7. Trading Strategies" href="TradingStrategies.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/figuremain2.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/figuremain2.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01/what-is-quant-investing.html">1. What is Quantitative Investing?</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../01/statistical-techniques.html">1.1. Statistical Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01/computational-tools.html">1.2. Computational tools</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02/getting_started.html">2. Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../02/local_install.html">2.3. Local installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02/cloud_setup.html">2.4. Cloud Setup</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../essentials/intro.html">3. Python Essentials</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../essentials/basics.html">3.1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/collections.html">3.2. Collections</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../essentials/introtopandas.html">3.3. Pandas</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/the_index.html">3.3.15. Indexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/timeseries.html">3.3.16. Time-Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/reshape.html">3.3.17. Reshape</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/merge.html">3.3.18. Merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/groupby.html">3.3.19. Group-by</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/matplotlib.html">3.3.20. Plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/data_clean.html">3.3.21. Cleaning data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../essentials/pandas/storage_formats.html">3.3.22. Data Storage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/control_flow.html">3.4. Flow control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/functions.html">3.5. Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/numpy.html">3.6. Numpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../essentials/plotting.html">3.7. Plotting</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Returns.html">4. Asset Returns</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="UsingAPI.html">4.3. Data APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="TheChoiceofFrequency.html">4.4. The Choice of Frequency and Annualization of Returns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scientific/randomness1.html">4.5. Modeling randomness</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="PortfolioMath.html">5. Portfolio Math</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../scientific/linear_algebra1.html">5.5. Linear algebra Review</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="MeanVariance.html">6. Mean-Variance Investing</a></li>
<li class="toctree-l1"><a class="reference internal" href="TradingStrategies.html">7. Trading Strategies</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">8. Factor models</a></li>





<li class="toctree-l1 has-children"><a class="reference internal" href="crosssectionalequitystrategies.html">14. Cross-Sectional Equity Strategies</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="MarketCapweighted.html">14.1. The Market Cap Weighted Portfolio</a></li>
<li class="toctree-l2"><a class="reference internal" href="Valueinvesting.html">14.2. Value factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="Momentum.html">14.3. Momentum factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="OtherEquityStrategies.html">14.4. Other Equity strategies</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Timing.html">15. Timing Strategies</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="Volatilitytiming.html">15.2. Volatility Timing</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Evaluation.html">16. Evaluating a Trading Strategy</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="Econometrics.html">16.1. The Econometrics of Strategy Evalaution</a></li>
<li class="toctree-l2"><a class="reference internal" href="outofsample.html">16.2. Out of Sample Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="TailandBackground.html">16.3. Tail Risks and Background Risks</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="Topics.html">17. Topics in Quantitative Investing</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="Implementation.html">17.1. Strategy Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Horizon.html">17.2. Investment horizon effects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../additional/additional.html">18. Additional Statistics Material</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Assignments/Assignments.html">19. Assignments</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment0.html">19.1. Assigment 0</a></li>





<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment1.html">19.7. Assignment 1</a></li>




<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment2.html">19.12. Assigment 2</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment3.html">19.16. Assignment 3</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment4.html">19.20. Assignment 4</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment5.html">19.24. Assigment 5</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment6.html">19.28. Assignment 6</a></li>



<li class="toctree-l2"><a class="reference internal" href="../Assignments/Assignment7.html">19.32. Assignment 7</a></li>

</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/amoreira2/Fin418/blob/main/chapters/Finance/FactorModels.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/amoreira2/Fin418/issues/new?title=Issue%20on%20page%20%2Fchapters/Finance/FactorModels.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/Finance/FactorModels.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Factor models</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">8. Factor models</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-single-factor-risk-model">8.1. A Single-Factor Risk Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-market-model">8.2. Application: Market model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#minimum-variance-investing">8.3. Minimum-variance investing</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-factor-models">9. Multi-factor models</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-a-multi-factor-model">9.1. Estimating a multi-factor model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application">9.2. Application</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reconstructing-the-co-variance-matrix">9.3. Reconstructing the co-variance matrix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-how-will-your-portfolio-risk-change-as-you-add-positions">9.4. Application: How will your portfolio risk change as you add positions</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#benchmarking">10. Benchmarking</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#tracking-error">11. Tracking error</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-models-as-models-of-expected-returns">12. Factor Models as Models of Expected Returns</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha">12.1. Alpha</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#appraisal-ratios">12.2. Appraisal Ratios</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#portable-alpha-and-hedged-portfolios">12.3. Portable Alpha and Hedged Portfolios</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">13. Factor Models as Models of Expected Returns</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<p>follow the barra exposition?</p>
<p>focus on an APT version–describing returns</p>
<p>Do univariate first, estimate for a few firms</p>
<p>Look at R-squared, residual and correlation with residuals</p>
<p>show that if the residuals are uncorrelated we can reconstruct the covariance matrix</p>
<p>then do multifactors</p>
<section class="tex2jax_ignore mathjax_ignore" id="factor-models">
<h1><span class="section-number">8. </span>Factor models<a class="headerlink" href="#factor-models" title="Permalink to this heading">#</a></h1>
<p>Let <span class="math notranslate nohighlight">\(r_t^i\)</span> be an asset excess return over the risk-free rate</p>
<p>Let <span class="math notranslate nohighlight">\(f_t\)</span> be a traded factor, for example the excess returns on the market portfolio</p>
<p>Then we can write</p>
<div class="math notranslate nohighlight">
\[r_t^i=b_{i}f_t+u_{i,t}\]</div>
<p>where <span class="math notranslate nohighlight">\(b_{i}\)</span> is asset <span class="math notranslate nohighlight">\(i\)</span> exposure to the factor</p>
<p>We can always write things that way–it is just a statistical decomposition</p>
<ol class="arabic simple">
<li><p>It can be useful for measuring risk if</p>
<ul class="simple">
<li><p>The risk <span class="math notranslate nohighlight">\(u_{i,t}\)</span> is specific to asset <span class="math notranslate nohighlight">\(i\)</span> and uncorrelated with other assets</p></li>
</ul>
</li>
<li><p>It can be useful for measuring expected returns if</p>
<ul class="simple">
<li><p>The risk <span class="math notranslate nohighlight">\(u_{i,t}\)</span> has no premium, i.e., <span class="math notranslate nohighlight">\(E[u_{i,t}]=0\)</span></p></li>
<li><p>The premium of asset <span class="math notranslate nohighlight">\(i\)</span> comes exclusively from the exposure to the factor <span class="math notranslate nohighlight">\(f\)</span></p></li>
</ul>
</li>
</ol>
<p>We will call the first a factor model of risk, and the second a factor model of expected returns</p>
<ul class="simple">
<li><p>Which one of the two is the CAPM?</p></li>
<li><p>Which one of the two is the APT?</p></li>
<li><p>Which one of the two is the market model?</p></li>
<li><p>What is the difference between the CAPM and the market model?</p></li>
</ul>
<section id="a-single-factor-risk-model">
<h2><span class="section-number">8.1. </span>A Single-Factor Risk Model<a class="headerlink" href="#a-single-factor-risk-model" title="Permalink to this heading">#</a></h2>
<p>We now focus on the first case. The assumption that <span class="math notranslate nohighlight">\(u_{i,t}\)</span> are uncorrelated across assets is never really satisfied</p>
<p>But it can be achieved approximately</p>
<p>We will see how we can compute covariance matrixes easily under such an assumption</p>
<p>first we will do so using a single factor</p>
<p>In this case the assumption is very bad…and not even close to holding for most assets…but will allow us to get the intuition</p>
<p>We will then learn how to do it with many factors as is standard in the industry</p>
<p>I will add an intercept to make explicit that I am not making any assumption about how the means of the asset and the factor are related</p>
<div class="math notranslate nohighlight">
\[r_t^i=a_i+b_{i}f_t+u_{i,t}\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(r_t^i\)</span> is the the excess return of asset i over the risk-free rate</p></li>
<li><p><span class="math notranslate nohighlight">\(b_i\)</span> is the exposure or sensitivity of asset <span class="math notranslate nohighlight">\(i\)</span> to the factor</p></li>
<li><p><span class="math notranslate nohighlight">\(f_t\)</span> is the excess return of the factor</p></li>
<li><p>non-factor component of the asset return of asset <span class="math notranslate nohighlight">\(i\)</span>. Assumed to uncorrelated between any two assets</p></li>
</ul>
<p>Now this is just a regression!</p>
<p>We have that</p>
<div class="math notranslate nohighlight">
\[Var(r_t^i)=b_i^2Var(f_t)+var(u_{i,t})\]</div>
<p>This gives us a nice decomposition of risk</p>
<ul class="simple">
<li><p>the risk component that is driven by the common factor</p></li>
<li><p>the asset specific comment</p></li>
</ul>
<p>Now if our assumption holds, <span class="math notranslate nohighlight">\(cov(u_{i,t},u_{j,t})=0\)</span></p>
<p>Then</p>
<div class="math notranslate nohighlight">
\[Cov(r_t^i,r_t^j)=Cov(a_i+b_{i}f_t+u_{i,t},a_j+b_{j}f_t+u_{j,t})=b_ib_jVar(f_t)\]</div>
<p>And the covariance matrix is simply</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\left[\begin{array}{cc}
b_i^2+ var(u_{i,t}) &amp; b_ib_j \\
b_ib_j &amp;  b_j^2 +var(u_{j,t})
\end{array}\right]\end{split}\]</div>
<p>We see that now for N assets we only need to estimate N factor exposures, N asset specific volatilities , and the factor volatility</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(2N+1\)</span> vs <span class="math notranslate nohighlight">\((N^2-N)/2+N\)</span></p>
</div></blockquote>
<p>That is a huge difference</p>
<p>Suppose we have many assets, all respecting this factor model. Say <span class="math notranslate nohighlight">\(R_t\)</span> is the big N by 1 vector of excess return <span class="math notranslate nohighlight">\([r_{1,t},r_{2,t},...]\)</span> for all these assets</p>
<div class="math notranslate nohighlight">
\[R_t=bf_t+U_t\]</div>
<p>where <span class="math notranslate nohighlight">\(b\)</span> is also a N by 1 vector of exposures <span class="math notranslate nohighlight">\([b_1,b_2,...b_N]\)</span>  and <span class="math notranslate nohighlight">\(u_t\)</span> is the N by 1 vector of shocks</p>
<p>Then their variance-covariance matrix is simply</p>
<div class="math notranslate nohighlight">
\[Var(R_t)=b &#64; b' Var(f_t)+ Var(U_t)\]</div>
</section>
<section id="application-market-model">
<h2><span class="section-number">8.2. </span>Application: Market model<a class="headerlink" href="#application-market-model" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>use the 50 stocks</p></li>
<li><p>Then do multifactor ?</p></li>
<li><p>Discuss how to use such model in risk management. Say if you know your portfolio b, you can quickly figure out what another fund might add to your portfolio in terms of risk</p></li>
<li><p>Do CAPM/APT here?</p></li>
<li><p>Benchmarking and tracking error?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># Create a date parser function that will allow pandas to read the dates in the format we have them</span>
<span class="n">date_parser</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;%Y%m&quot;</span><span class="p">)</span>
<span class="c1"># our 50 stock returns data</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/amoreira2/Fin418/main/assets/data/Retuns50stocks.csv&quot;</span>

<span class="c1"># Use pd.read_csv with the date_parser</span>
<span class="n">df</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">date_parser</span><span class="o">=</span><span class="n">date_parser</span><span class="p">)</span>
<span class="c1"># Set the date column as the index</span>

<span class="c1"># first, create the DataFrame</span>
<span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># put the returns in percentage format</span>
<span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">/</span><span class="mi">100</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 180 entries, 2000-01-01 to 2014-12-01
Data columns (total 51 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   CTL     180 non-null    float64
 1   T       180 non-null    float64
 2   CSCO    180 non-null    float64
 3   FCX     180 non-null    float64
 4   XL      180 non-null    float64
 5   IVZ     180 non-null    float64
 6   AMT     180 non-null    float64
 7   WHR     180 non-null    float64
 8   IR      180 non-null    float64
 9   WFT     180 non-null    float64
 10  YUM     180 non-null    float64
 11  CVS     180 non-null    float64
 12  GD      180 non-null    float64
 13  TYC     180 non-null    float64
 14  EL      180 non-null    float64
 15  MUR     180 non-null    float64
 16  CTAS    180 non-null    float64
 17  CBSA    180 non-null    float64
 18  SNV     180 non-null    float64
 19  CAM     180 non-null    float64
 20  DLTR    180 non-null    float64
 21  CAH     180 non-null    float64
 22  DTE     180 non-null    float64
 23  SSP     180 non-null    float64
 24  PSA     180 non-null    float64
 25  EXC     180 non-null    float64
 26  TKR     180 non-null    float64
 27  CMA     180 non-null    float64
 28  ORCL    180 non-null    float64
 29  MS      180 non-null    float64
 30  RSG     180 non-null    float64
 31  ACAS    180 non-null    float64
 32  AGN     180 non-null    float64
 33  MMM     180 non-null    float64
 34  ETFC    180 non-null    float64
 35  CAR     180 non-null    float64
 36  MDR     180 non-null    float64
 37  NOV     180 non-null    float64
 38  PCH     180 non-null    float64
 39  BAX     180 non-null    float64
 40  JCI     180 non-null    float64
 41  SWK     180 non-null    float64
 42  DVN     180 non-null    float64
 43  TMO     180 non-null    float64
 44  PEP     180 non-null    float64
 45  LNC     180 non-null    float64
 46  EMR     180 non-null    float64
 47  MLM     180 non-null    float64
 48  CCI     180 non-null    float64
 49  NU      180 non-null    float64
 50  Market  180 non-null    float64
dtypes: float64(51)
memory usage: 73.1 KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="c1"># add a constant to the independent variable</span>
<span class="n">x</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Market&#39;</span><span class="p">])</span>
<span class="c1"># set the dependent variable to be the &#39;CTL&#39; return</span>
<span class="n">y</span><span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;CTL&#39;</span><span class="p">]</span>
<span class="c1"># run the regression</span>
<span class="n">results</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>           <td>CTL</td>       <th>  R-squared:         </th> <td>   0.171</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.167</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   36.81</td>
</tr>
<tr>
  <th>Date:</th>             <td>Mon, 29 Jan 2024</td> <th>  Prob (F-statistic):</th> <td>7.62e-09</td>
</tr>
<tr>
  <th>Time:</th>                 <td>18:02:15</td>     <th>  Log-Likelihood:    </th> <td>  214.56</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>   180</td>      <th>  AIC:               </th> <td>  -425.1</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>   178</td>      <th>  BIC:               </th> <td>  -418.7</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
     <td></td>       <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>  <td>    0.0019</td> <td>    0.006</td> <td>    0.340</td> <td> 0.734</td> <td>   -0.009</td> <td>    0.013</td>
</tr>
<tr>
  <th>Market</th> <td>    0.7269</td> <td>    0.120</td> <td>    6.068</td> <td> 0.000</td> <td>    0.491</td> <td>    0.963</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>43.729</td> <th>  Durbin-Watson:     </th> <td>   2.264</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td> <th>  Jarque-Bera (JB):  </th> <td> 394.038</td>
</tr>
<tr>
  <th>Skew:</th>          <td> 0.524</td> <th>  Prob(JB):          </th> <td>2.73e-86</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td>10.172</td> <th>  Cond. No.          </th> <td>    21.8</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<p>Interpretation:</p>
<p>The coefficient on the market estimates the exposure <span class="math notranslate nohighlight">\(b_{CTL}\)</span>. It is 0.72 and well estimate</p>
<ul class="simple">
<li><p>we see that the standard errors allow us to reject both zero (easy) and one (not as easy simnce the typical stock must have a beta of 1)</p></li>
</ul>
<p>We see that the R-squared is 17% so the asset specific risk is sizable</p>
<ul class="simple">
<li><p>what fraction of CTL risk is due to the factor?</p></li>
<li><p>how large is the non-factor component?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to get the residual volatility, we need to get the residuals and compute it&#39;s volatility</span>
<span class="n">u</span><span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">resid</span>
<span class="nb">print</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.25520301676928053
</pre></div>
</div>
</div>
</div>
<p>Lets now estimate the covariance matrix of these 50 stocks using this single-factor model</p>
<ol class="arabic simple">
<li><p>Run regression stock by stock</p></li>
<li><p>save betas, save residual variance</p></li>
<li><p>Use formula to construct variance matrix</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;CTL&#39;, &#39;T&#39;, &#39;CSCO&#39;, &#39;FCX&#39;, &#39;XL&#39;, &#39;IVZ&#39;, &#39;AMT&#39;, &#39;WHR&#39;, &#39;IR&#39;, &#39;WFT&#39;,
       &#39;YUM&#39;, &#39;CVS&#39;, &#39;GD&#39;, &#39;TYC&#39;, &#39;EL&#39;, &#39;MUR&#39;, &#39;CTAS&#39;, &#39;CBSA&#39;, &#39;SNV&#39;, &#39;CAM&#39;,
       &#39;DLTR&#39;, &#39;CAH&#39;, &#39;DTE&#39;, &#39;SSP&#39;, &#39;PSA&#39;, &#39;EXC&#39;, &#39;TKR&#39;, &#39;CMA&#39;, &#39;ORCL&#39;, &#39;MS&#39;,
       &#39;RSG&#39;, &#39;ACAS&#39;, &#39;AGN&#39;, &#39;MMM&#39;, &#39;ETFC&#39;, &#39;CAR&#39;, &#39;MDR&#39;, &#39;NOV&#39;, &#39;PCH&#39;, &#39;BAX&#39;,
       &#39;JCI&#39;, &#39;SWK&#39;, &#39;DVN&#39;, &#39;TMO&#39;, &#39;PEP&#39;, &#39;LNC&#39;, &#39;EMR&#39;, &#39;MLM&#39;, &#39;CCI&#39;, &#39;NU&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Results</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Beta&#39;</span><span class="p">,</span><span class="s1">&#39;VarU&#39;</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

<span class="n">x</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Market&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">stocki</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
<span class="c1"># set the dependent variable to be the &#39;CTL&#39; return</span>
    <span class="n">y</span><span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">stocki</span><span class="p">]</span>
    <span class="c1"># run the regression</span>
    <span class="n">results</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">stocki</span><span class="p">,</span><span class="s1">&#39;Beta&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">Results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">stocki</span><span class="p">,</span><span class="s1">&#39;VarU&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">results</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>

<span class="n">Results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Beta</th>
      <th>VarU</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>CTL</th>
      <td>0.726946</td>
      <td>0.005427</td>
    </tr>
    <tr>
      <th>T</th>
      <td>0.529153</td>
      <td>0.004093</td>
    </tr>
    <tr>
      <th>CSCO</th>
      <td>1.530779</td>
      <td>0.006403</td>
    </tr>
    <tr>
      <th>FCX</th>
      <td>1.569894</td>
      <td>0.011742</td>
    </tr>
    <tr>
      <th>XL</th>
      <td>1.438681</td>
      <td>0.011752</td>
    </tr>
    <tr>
      <th>IVZ</th>
      <td>2.036247</td>
      <td>0.004851</td>
    </tr>
    <tr>
      <th>AMT</th>
      <td>1.352478</td>
      <td>0.027122</td>
    </tr>
    <tr>
      <th>WHR</th>
      <td>1.442238</td>
      <td>0.008598</td>
    </tr>
    <tr>
      <th>IR</th>
      <td>1.461150</td>
      <td>0.005901</td>
    </tr>
    <tr>
      <th>WFT</th>
      <td>1.513599</td>
      <td>0.010939</td>
    </tr>
    <tr>
      <th>YUM</th>
      <td>0.701920</td>
      <td>0.004836</td>
    </tr>
    <tr>
      <th>CVS</th>
      <td>0.647671</td>
      <td>0.004854</td>
    </tr>
    <tr>
      <th>GD</th>
      <td>0.833312</td>
      <td>0.003792</td>
    </tr>
    <tr>
      <th>TYC</th>
      <td>1.331555</td>
      <td>0.006221</td>
    </tr>
    <tr>
      <th>EL</th>
      <td>0.918557</td>
      <td>0.004550</td>
    </tr>
    <tr>
      <th>MUR</th>
      <td>0.873364</td>
      <td>0.005601</td>
    </tr>
    <tr>
      <th>CTAS</th>
      <td>0.845109</td>
      <td>0.005044</td>
    </tr>
    <tr>
      <th>CBSA</th>
      <td>1.705297</td>
      <td>0.006981</td>
    </tr>
    <tr>
      <th>SNV</th>
      <td>0.980521</td>
      <td>0.009233</td>
    </tr>
    <tr>
      <th>CAM</th>
      <td>1.287322</td>
      <td>0.006415</td>
    </tr>
    <tr>
      <th>DLTR</th>
      <td>0.789608</td>
      <td>0.008543</td>
    </tr>
    <tr>
      <th>CAH</th>
      <td>0.544862</td>
      <td>0.004334</td>
    </tr>
    <tr>
      <th>DTE</th>
      <td>0.334819</td>
      <td>0.002472</td>
    </tr>
    <tr>
      <th>SSP</th>
      <td>1.510001</td>
      <td>0.012559</td>
    </tr>
    <tr>
      <th>PSA</th>
      <td>0.528390</td>
      <td>0.003389</td>
    </tr>
    <tr>
      <th>EXC</th>
      <td>0.299122</td>
      <td>0.003815</td>
    </tr>
    <tr>
      <th>TKR</th>
      <td>1.484943</td>
      <td>0.006822</td>
    </tr>
    <tr>
      <th>CMA</th>
      <td>0.810631</td>
      <td>0.005133</td>
    </tr>
    <tr>
      <th>ORCL</th>
      <td>1.269003</td>
      <td>0.007420</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>1.687285</td>
      <td>0.005518</td>
    </tr>
    <tr>
      <th>RSG</th>
      <td>0.495615</td>
      <td>0.004677</td>
    </tr>
    <tr>
      <th>ACAS</th>
      <td>1.452933</td>
      <td>0.015387</td>
    </tr>
    <tr>
      <th>AGN</th>
      <td>0.569430</td>
      <td>0.004983</td>
    </tr>
    <tr>
      <th>MMM</th>
      <td>0.695088</td>
      <td>0.002467</td>
    </tr>
    <tr>
      <th>ETFC</th>
      <td>2.391465</td>
      <td>0.015546</td>
    </tr>
    <tr>
      <th>CAR</th>
      <td>3.353010</td>
      <td>0.030258</td>
    </tr>
    <tr>
      <th>MDR</th>
      <td>1.468548</td>
      <td>0.025389</td>
    </tr>
    <tr>
      <th>NOV</th>
      <td>1.398243</td>
      <td>0.010767</td>
    </tr>
    <tr>
      <th>PCH</th>
      <td>0.990190</td>
      <td>0.003758</td>
    </tr>
    <tr>
      <th>BAX</th>
      <td>0.485301</td>
      <td>0.004654</td>
    </tr>
    <tr>
      <th>JCI</th>
      <td>1.292524</td>
      <td>0.005156</td>
    </tr>
    <tr>
      <th>SWK</th>
      <td>1.100645</td>
      <td>0.004248</td>
    </tr>
    <tr>
      <th>DVN</th>
      <td>0.957763</td>
      <td>0.006943</td>
    </tr>
    <tr>
      <th>TMO</th>
      <td>0.958138</td>
      <td>0.003878</td>
    </tr>
    <tr>
      <th>PEP</th>
      <td>0.351366</td>
      <td>0.001890</td>
    </tr>
    <tr>
      <th>LNC</th>
      <td>1.826397</td>
      <td>0.009519</td>
    </tr>
    <tr>
      <th>EMR</th>
      <td>1.035139</td>
      <td>0.002380</td>
    </tr>
    <tr>
      <th>MLM</th>
      <td>0.871716</td>
      <td>0.005100</td>
    </tr>
    <tr>
      <th>CCI</th>
      <td>1.672453</td>
      <td>0.014393</td>
    </tr>
    <tr>
      <th>NU</th>
      <td>0.446771</td>
      <td>0.002182</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Assuming Results is your DataFrame and &#39;Beta&#39; is your column</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">Results</span><span class="p">[</span><span class="s1">&#39;Beta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="c1"># make sure beta is a column vector (and not di)</span>
<span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Compute the outer product of the &#39;Beta&#39; column with itself</span>
<span class="n">beta_matrix</span> <span class="o">=</span> <span class="n">beta</span> <span class="o">@</span> <span class="n">beta</span><span class="o">.</span><span class="n">T</span>
<span class="nb">print</span><span class="p">(</span><span class="n">beta_matrix</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">beta_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># the unsystematic component is a diagonal matrix with the variance of the residuals on the diagonal</span>
<span class="n">CovU</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">Results</span><span class="p">[</span><span class="s1">&#39;VarU&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">CovU</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">CovU</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># construct the covariance matrix by adding the systematic and unsystematic components</span>
<span class="n">Cov_F</span><span class="o">=</span><span class="n">beta_matrix</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Market&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">()</span><span class="o">+</span><span class="n">CovU</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Cov_F</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">Cov_F</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[0.52845028 0.38466559 1.11279362 ... 0.63369045 1.21578277 0.32477868]
 [0.38466559 0.28000291 0.81001644 ... 0.46127124 0.88498354 0.23641048]
 [1.11279362 0.81001644 2.34328505 ... 1.334405   2.5601563  0.68390851]
 ...
 [0.63369045 0.46127124 1.334405   ... 0.75988907 1.4579043  0.38945793]
 [1.21578277 0.88498354 2.5601563  ... 1.4579043  2.79709901 0.74720431]
 [0.32477868 0.23641048 0.68390851 ... 0.38945793 0.74720431 0.19960476]]
(50, 50)
[[0.00542738 0.         0.         ... 0.         0.         0.        ]
 [0.         0.00409277 0.         ... 0.         0.         0.        ]
 [0.         0.         0.00640331 ... 0.         0.         0.        ]
 ...
 [0.         0.         0.         ... 0.00510028 0.         0.        ]
 [0.         0.         0.         ... 0.         0.01439288 0.        ]
 [0.         0.         0.         ... 0.         0.         0.00218208]]
(50, 50)
[[0.0065499  0.0008171  0.00236376 ... 0.00134607 0.00258253 0.00068989]
 [0.0008171  0.00468754 0.00172061 ... 0.00097982 0.00187986 0.00050218]
 [0.00236376 0.00172061 0.01138085 ... 0.0028345  0.00543821 0.00145274]
 ...
 [0.00134607 0.00097982 0.0028345  ... 0.00671441 0.00309684 0.00082727]
 [0.00258253 0.00187986 0.00543821 ... 0.00309684 0.0203344  0.00158719]
 [0.00068989 0.00050218 0.00145274 ... 0.00082727 0.00158719 0.00260607]]
(50, 50)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">Cov_F</span><span class="p">))</span>
<span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Market&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cov</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.18458701 0.02820187 0.02641282 0.02408352 0.01543593 0.01488343
 0.01384643 0.01237561 0.01174754 0.01137313 0.01084868 0.01028004
 0.00932048 0.00900449 0.00855584 0.00821247 0.00189723 0.0021908
 0.00241865 0.00253078 0.0024709  0.00734261 0.0069544  0.00688625
 0.00665538 0.00339956 0.0064101  0.00628267 0.00604179 0.00377187
 0.00381028 0.00382598 0.00393034 0.00574614 0.0041033  0.0055832
 0.00428599 0.00435046 0.00544161 0.00530519 0.00457194 0.00465879
 0.0046841  0.00514056 0.00511297 0.00506295 0.00499907 0.00495316
 0.00483742 0.00485367]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.20234862, 0.04380649, 0.03867242, 0.0267219 , 0.02183821,
       0.02126078, 0.0160202 , 0.01368212, 0.01338605, 0.01173726,
       0.0111724 , 0.01070277, 0.00930882, 0.00854364, 0.00764067,
       0.00724038, 0.00656417, 0.00642297, 0.00596876, 0.00542201,
       0.00496879, 0.00470215, 0.00452763, 0.00430816, 0.00383458,
       0.00364044, 0.00353846, 0.00336802, 0.00053798, 0.00313359,
       0.00071095, 0.00077215, 0.00294676, 0.00282649, 0.00253401,
       0.00248637, 0.00101429, 0.00110574, 0.00111545, 0.00222037,
       0.00211258, 0.00203357, 0.00194135, 0.00184789, 0.00178512,
       0.0012698 , 0.00133569, 0.00155697, 0.00154107, 0.00150227])
</pre></div>
</div>
</div>
</div>
</section>
<section id="minimum-variance-investing">
<h2><span class="section-number">8.3. </span>Minimum-variance investing<a class="headerlink" href="#minimum-variance-investing" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>it is mean-variance investing under the assumption that all assets have same expected returns, but uses covariance matrix to minimize risk</p></li>
<li><p>The idea is that expected returns signals are pure noise so we might as well assume there are no signals and all expected returns are the same</p></li>
<li><p>For example this is behind Minimum volatility investing for example, [<a class="reference external" href="https://investor.vanguard.com/mutual-funds/profile/VMVFX">https://investor.vanguard.com/mutual-funds/profile/VMVFX</a>]</p></li>
<li><p>Assumes all assets have the same expected return</p></li>
</ul>
<div class="math notranslate nohighlight">
\[Min~ X'Var(R)X~ subject~ to~ \mathbf{1}'X=1\]</div>
<p>The result of this problem is a vector of weights proportional to</p>
<div class="math notranslate nohighlight">
\[W_{minvariance}\propto Var(R)^{-1}\mathbf{1}\]</div>
<p>We then impose the constraint that the weights have to add-up to 1.</p>
<div class="math notranslate nohighlight">
\[X_{minvariance}=\frac{Var(R)^{-1}\mathbf{1}}{\mathbf{1}^TVar(R)^{-1}\mathbf{1}}\]</div>
<ul class="simple">
<li><p>I use this technique in “hedging-risk factors”, a recent academic paper, to construct portfolios with Sharpe-ratios of 0.8 at the yearly horizon, which is very large</p></li>
</ul>
<blockquote>
<div><p>Why this might make sense?</p>
</div></blockquote>
<p>So you see here that the problem is really identical to the mean-variance problem. We simply substituted the vector or Expected returns by a vector of ones.</p>
<p>The end result is that now the solution is the portfolio that minimizes variance while being fully invested as the constraint <span class="math notranslate nohighlight">\(\mathbf{1}'W=1\)</span> means <span class="math notranslate nohighlight">\(\sum_i^I w_i*1=1\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># minimum variance portfolio using the factor-based covariance matrix</span>
<span class="n">ones</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">50</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">X_minvarFactor</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cov_F</span><span class="p">)</span><span class="o">@</span> <span class="n">ones</span><span class="o">/</span><span class="p">(</span><span class="n">ones</span><span class="o">.</span><span class="n">T</span> <span class="nd">@np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cov_F</span><span class="p">)</span><span class="o">@</span> <span class="n">ones</span><span class="p">)</span>
<span class="c1"># minimum variance portfolio using the unrestricted stock covariance matrix</span>
<span class="n">Cov</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Market&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
<span class="n">X_minvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cov</span><span class="p">)</span><span class="o">@</span> <span class="n">ones</span><span class="o">/</span><span class="p">(</span><span class="n">ones</span><span class="o">.</span><span class="n">T</span> <span class="nd">@np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Cov</span><span class="p">)</span><span class="o">@</span> <span class="n">ones</span><span class="p">)</span>

<span class="c1"># plot the weights against each other</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_minvar</span><span class="p">,</span><span class="n">X_minvar</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_minvar</span><span class="p">,</span><span class="n">X_minvarFactor</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x1a6a0497760&gt;
</pre></div>
</div>
<img alt="../../_images/9e984f0bab3fad0115cc832209e4a58f252c5136cb231b6543b16162282c883d.png" src="../../_images/9e984f0bab3fad0115cc832209e4a58f252c5136cb231b6543b16162282c883d.png" />
</div>
</div>
<ul class="simple">
<li><p>What do you notice about the weights?</p></li>
<li><p>How do we construct the returns of the strategy?</p></li>
<li><p>What do we need to evaluate performance of the Factor-based approach vs the unrestricted approach?</p>
<ul>
<li><p>Why can’t we simply calculate Sharpe Ratios in the same data?</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="multi-factor-models">
<h1><span class="section-number">9. </span>Multi-factor models<a class="headerlink" href="#multi-factor-models" title="Permalink to this heading">#</a></h1>
<p>We simply assumed that the residual <span class="math notranslate nohighlight">\(u\)</span> is uncorrelated</p>
<p>This will never be exactly correct, but we better be sure that we are not missing some big sources of correlation</p>
<p>If we miss our covariance assumption will be off</p>
<ul class="simple">
<li><p>Suppose we have a long only portfolio, are we going to over-estimate or under-estimate our true portfolio variance?</p></li>
<li><p>Suppose we have a long-short, that goes long some assets and short others, would the same conclusion apply? why?</p></li>
<li><p>Suppose we choose a portfolio by minimizing variance (like we just did) when are you going to over-estimate the variance of your portfolio?</p>
<ul>
<li><p>If there is co-movement that you miss?</p></li>
<li><p>If there is no true c0-movement but you assumed there was co-movement?</p></li>
</ul>
</li>
</ul>
<p>Real data are likely to have many factors</p>
<ul class="simple">
<li><p>industry factors: tech stocks move all together</p></li>
<li><p>Stocks that have high valuation multiples tends to move together with other high multiple stocks</p></li>
<li><p>Small stocks tend to move with other small firms</p></li>
<li><p>Firms that have been recently investing a lot move with other similar firms</p></li>
<li><p>etc</p></li>
</ul>
<p>We deal with this, by simply adding more factors to our model. Say we now have M different factors</p>
<div class="math notranslate nohighlight">
\[r_t^i=b_{i,1}f_t^1+b_{i,2}f_t^2+b_{i,3}f_t^3+...+b_{i,M}f_t^M+u_{i,t}+u_{i,t}\]</div>
<p>Where <span class="math notranslate nohighlight">\(b_{i,j}\)</span> measures the exposure of asset <span class="math notranslate nohighlight">\(i\)</span> to factor <span class="math notranslate nohighlight">\(j\)</span></p>
<p>IF we stack these exposures in a M by 1 vector <span class="math notranslate nohighlight">\(B_i=[b_{i,1},b_{i,2},...b_{i,M}]\)</span> and the factors in a M by 1 vector <span class="math notranslate nohighlight">\(F_t=[f^1_t,f^2_t,...,f^M_t]\)</span> we can write this in matrix notation</p>
<div class="math notranslate nohighlight">
\[r_t^i=B_i&#64;F_t+u_{i,t}\]</div>
<p>As before we can also stack the individual returns :</p>
<div class="math notranslate nohighlight">
\[R_t=B&#64;F_t+U_t\]</div>
<p>where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(R_t\)</span> is a N by 1 vector with the excess returns of the N assets</p></li>
<li><p><span class="math notranslate nohighlight">\(B\)</span> is N by M matrix where each row has the exposure of an asset with respect to each M factor and each column has the exposures of the different assets with respect to a particular factor</p></li>
<li><p><span class="math notranslate nohighlight">\(U_t\)</span> as before is a N by 1 vector with the residual risk of each N asset</p></li>
</ul>
<section id="estimating-a-multi-factor-model">
<h2><span class="section-number">9.1. </span>Estimating a multi-factor model<a class="headerlink" href="#estimating-a-multi-factor-model" title="Permalink to this heading">#</a></h2>
<p>Again, this is a very simple regression!</p>
<p>We simply run a multivariate regression for each asset and the coefficients on the different factors is our estimate!</p>
</section>
<section id="application">
<h2><span class="section-number">9.2. </span>Application<a class="headerlink" href="#application" title="Permalink to this heading">#</a></h2>
<p>Lets apply this!</p>
<p>Lets fo a 8 factor model—total overkill for these 50 stocks–</p>
<p>I will get the 3 factors from the Fama-French 3 factor model: Market, size, value</p>
<p>And get 5 industry portfolios</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pandas_datareader.data</span> <span class="k">as</span> <span class="nn">web</span>

<span class="c1"># Define the start and end dates for the data</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="s1">&#39;2000-01-01&#39;</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="s1">&#39;2021-12-31&#39;</span>

<span class="c1"># Get the Fama-French three-factor model data</span>
<span class="n">ff_factors</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s1">&#39;F-F_Research_Data_Factors&#39;</span><span class="p">,</span> <span class="s1">&#39;famafrench&#39;</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Get the five industry portfolio data</span>
<span class="n">industry_portfolios</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s1">&#39;5_Industry_Portfolios&#39;</span><span class="p">,</span> <span class="s1">&#39;famafrench&#39;</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Merge the two datasets together</span>
<span class="n">merged_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ff_factors</span><span class="p">,</span> <span class="n">industry_portfolios</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<span class="n">factors_names</span><span class="o">=</span><span class="n">merged_data</span><span class="o">.</span><span class="n">columns</span>
<span class="n">merged_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">merged_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">())</span>
<span class="c1"># put the returns in percentage format</span>
<span class="n">merged_data</span><span class="o">=</span><span class="n">merged_data</span><span class="o">/</span><span class="mi">100</span>
<span class="c1">#Merge with your df dataset to make sure the dates match</span>
<span class="n">merged_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">merged_data</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Market&#39;</span><span class="p">]),</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

<span class="c1"># # Split the merged dataset into factors and individual assets</span>
<span class="n">Rf</span> <span class="o">=</span> <span class="n">merged_data</span><span class="p">[[</span><span class="s1">&#39;RF&#39;</span><span class="p">]]</span>
<span class="n">Factors</span> <span class="o">=</span> <span class="n">merged_data</span><span class="p">[</span><span class="n">factors_names</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">])</span>
<span class="n">Assets</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">factors_names</span><span class="p">)</span>

<span class="c1"># factors</span>
<span class="n">Factors</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">Assets</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">Factors</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 180 entries, 2000-01-01 to 2014-12-01
Data columns (total 8 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   Mkt-RF  180 non-null    float64
 1   SMB     180 non-null    float64
 2   HML     180 non-null    float64
 3   Cnsmr   180 non-null    float64
 4   Manuf   180 non-null    float64
 5   HiTec   180 non-null    float64
 6   Hlth    180 non-null    float64
 7   Other   180 non-null    float64
dtypes: float64(8)
memory usage: 12.7 KB
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 180 entries, 2000-01-01 to 2014-12-01
Data columns (total 50 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   CTL     180 non-null    float64
 1   T       180 non-null    float64
 2   CSCO    180 non-null    float64
 3   FCX     180 non-null    float64
 4   XL      180 non-null    float64
 5   IVZ     180 non-null    float64
 6   AMT     180 non-null    float64
 7   WHR     180 non-null    float64
 8   IR      180 non-null    float64
 9   WFT     180 non-null    float64
 10  YUM     180 non-null    float64
 11  CVS     180 non-null    float64
 12  GD      180 non-null    float64
 13  TYC     180 non-null    float64
 14  EL      180 non-null    float64
 15  MUR     180 non-null    float64
 16  CTAS    180 non-null    float64
 17  CBSA    180 non-null    float64
 18  SNV     180 non-null    float64
 19  CAM     180 non-null    float64
 20  DLTR    180 non-null    float64
 21  CAH     180 non-null    float64
 22  DTE     180 non-null    float64
 23  SSP     180 non-null    float64
 24  PSA     180 non-null    float64
 25  EXC     180 non-null    float64
 26  TKR     180 non-null    float64
 27  CMA     180 non-null    float64
 28  ORCL    180 non-null    float64
 29  MS      180 non-null    float64
 30  RSG     180 non-null    float64
 31  ACAS    180 non-null    float64
 32  AGN     180 non-null    float64
 33  MMM     180 non-null    float64
 34  ETFC    180 non-null    float64
 35  CAR     180 non-null    float64
 36  MDR     180 non-null    float64
 37  NOV     180 non-null    float64
 38  PCH     180 non-null    float64
 39  BAX     180 non-null    float64
 40  JCI     180 non-null    float64
 41  SWK     180 non-null    float64
 42  DVN     180 non-null    float64
 43  TMO     180 non-null    float64
 44  PEP     180 non-null    float64
 45  LNC     180 non-null    float64
 46  EMR     180 non-null    float64
 47  MLM     180 non-null    float64
 48  CCI     180 non-null    float64
 49  NU      180 non-null    float64
dtypes: float64(50)
memory usage: 71.7 KB
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mkt-RF</th>
      <th>SMB</th>
      <th>HML</th>
      <th>Cnsmr</th>
      <th>Manuf</th>
      <th>HiTec</th>
      <th>Hlth</th>
      <th>Other</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01</th>
      <td>-0.0474</td>
      <td>0.0577</td>
      <td>-0.0188</td>
      <td>-0.0792</td>
      <td>-0.0493</td>
      <td>-0.0489</td>
      <td>0.0759</td>
      <td>-0.0477</td>
    </tr>
    <tr>
      <th>2000-02-01</th>
      <td>0.0245</td>
      <td>0.2136</td>
      <td>-0.0959</td>
      <td>-0.0523</td>
      <td>-0.0463</td>
      <td>0.1322</td>
      <td>-0.0275</td>
      <td>-0.0738</td>
    </tr>
    <tr>
      <th>2000-03-01</th>
      <td>0.0520</td>
      <td>-0.1720</td>
      <td>0.0813</td>
      <td>0.1098</td>
      <td>0.0813</td>
      <td>0.0483</td>
      <td>0.0016</td>
      <td>0.1439</td>
    </tr>
    <tr>
      <th>2000-04-01</th>
      <td>-0.0640</td>
      <td>-0.0668</td>
      <td>0.0726</td>
      <td>-0.0221</td>
      <td>0.0153</td>
      <td>-0.0996</td>
      <td>0.0526</td>
      <td>-0.0285</td>
    </tr>
    <tr>
      <th>2000-05-01</th>
      <td>-0.0442</td>
      <td>-0.0605</td>
      <td>0.0475</td>
      <td>-0.0060</td>
      <td>0.0125</td>
      <td>-0.1076</td>
      <td>0.0396</td>
      <td>0.0336</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2014-08-01</th>
      <td>0.0424</td>
      <td>0.0040</td>
      <td>-0.0045</td>
      <td>0.0522</td>
      <td>0.0399</td>
      <td>0.0336</td>
      <td>0.0554</td>
      <td>0.0412</td>
    </tr>
    <tr>
      <th>2014-09-01</th>
      <td>-0.0197</td>
      <td>-0.0371</td>
      <td>-0.0134</td>
      <td>-0.0171</td>
      <td>-0.0455</td>
      <td>-0.0137</td>
      <td>-0.0022</td>
      <td>-0.0113</td>
    </tr>
    <tr>
      <th>2014-10-01</th>
      <td>0.0252</td>
      <td>0.0421</td>
      <td>-0.0181</td>
      <td>0.0297</td>
      <td>0.0085</td>
      <td>0.0143</td>
      <td>0.0590</td>
      <td>0.0344</td>
    </tr>
    <tr>
      <th>2014-11-01</th>
      <td>0.0255</td>
      <td>-0.0206</td>
      <td>-0.0309</td>
      <td>0.0630</td>
      <td>-0.0195</td>
      <td>0.0390</td>
      <td>0.0252</td>
      <td>0.0249</td>
    </tr>
    <tr>
      <th>2014-12-01</th>
      <td>-0.0006</td>
      <td>0.0249</td>
      <td>0.0227</td>
      <td>0.0008</td>
      <td>0.0044</td>
      <td>-0.0138</td>
      <td>-0.0082</td>
      <td>0.0117</td>
    </tr>
  </tbody>
</table>
<p>180 rows × 8 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Beta</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">Assets</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">columns</span><span class="o">=</span><span class="n">Factors</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">VarU</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">Assets</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;VarU&#39;</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">x</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">Factors</span><span class="p">)</span>
<span class="k">for</span> <span class="n">stocki</span> <span class="ow">in</span> <span class="n">Assets</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">y</span><span class="o">=</span> <span class="n">Assets</span><span class="p">[</span><span class="n">stocki</span><span class="p">]</span>
    <span class="c1"># run the regression</span>
    <span class="n">results</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="c1"># store beta parameters skipping the constant</span>
    <span class="n">Beta</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">stocki</span><span class="p">,:]</span><span class="o">=</span><span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="c1"># store the residual variance</span>
    <span class="n">VarU</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">stocki</span><span class="p">,</span><span class="s1">&#39;VarU&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">results</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>

<span class="n">Beta</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mkt-RF</th>
      <th>SMB</th>
      <th>HML</th>
      <th>Cnsmr</th>
      <th>Manuf</th>
      <th>HiTec</th>
      <th>Hlth</th>
      <th>Other</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>CTL</th>
      <td>1.773661</td>
      <td>-0.584068</td>
      <td>0.013224</td>
      <td>0.591461</td>
      <td>-0.151144</td>
      <td>-0.368082</td>
      <td>0.024628</td>
      <td>-0.729825</td>
    </tr>
    <tr>
      <th>T</th>
      <td>-0.765983</td>
      <td>-0.708870</td>
      <td>0.519897</td>
      <td>0.565646</td>
      <td>0.168277</td>
      <td>0.789765</td>
      <td>0.338093</td>
      <td>-0.314557</td>
    </tr>
    <tr>
      <th>CSCO</th>
      <td>-1.209827</td>
      <td>0.063438</td>
      <td>0.304196</td>
      <td>-0.030400</td>
      <td>-0.017300</td>
      <td>1.789234</td>
      <td>0.132417</td>
      <td>0.326659</td>
    </tr>
    <tr>
      <th>FCX</th>
      <td>0.579567</td>
      <td>0.240257</td>
      <td>-0.104024</td>
      <td>0.384780</td>
      <td>1.676865</td>
      <td>-0.040493</td>
      <td>-0.662841</td>
      <td>-0.379800</td>
    </tr>
    <tr>
      <th>XL</th>
      <td>-2.138662</td>
      <td>0.087942</td>
      <td>-0.098236</td>
      <td>0.743264</td>
      <td>0.194891</td>
      <td>0.325159</td>
      <td>-0.088233</td>
      <td>2.389057</td>
    </tr>
    <tr>
      <th>IVZ</th>
      <td>-2.943381</td>
      <td>0.143413</td>
      <td>-0.059142</td>
      <td>0.369939</td>
      <td>0.983337</td>
      <td>1.722916</td>
      <td>0.600754</td>
      <td>1.188089</td>
    </tr>
    <tr>
      <th>AMT</th>
      <td>-3.074392</td>
      <td>0.521988</td>
      <td>0.450322</td>
      <td>-0.642305</td>
      <td>1.219210</td>
      <td>2.357371</td>
      <td>0.867010</td>
      <td>0.144035</td>
    </tr>
    <tr>
      <th>WHR</th>
      <td>-0.123852</td>
      <td>0.510154</td>
      <td>1.116104</td>
      <td>1.142745</td>
      <td>-0.247190</td>
      <td>0.323533</td>
      <td>0.157214</td>
      <td>0.360687</td>
    </tr>
    <tr>
      <th>IR</th>
      <td>-1.389932</td>
      <td>0.025733</td>
      <td>0.109128</td>
      <td>1.001246</td>
      <td>0.943648</td>
      <td>0.638801</td>
      <td>-0.102587</td>
      <td>0.521383</td>
    </tr>
    <tr>
      <th>WFT</th>
      <td>-2.307030</td>
      <td>0.411222</td>
      <td>-0.381759</td>
      <td>-0.359601</td>
      <td>2.801833</td>
      <td>0.651049</td>
      <td>-0.450652</td>
      <td>0.940941</td>
    </tr>
    <tr>
      <th>YUM</th>
      <td>-1.270226</td>
      <td>0.178507</td>
      <td>-0.496309</td>
      <td>1.357438</td>
      <td>0.683168</td>
      <td>0.046853</td>
      <td>-0.171082</td>
      <td>0.369412</td>
    </tr>
    <tr>
      <th>CVS</th>
      <td>-0.928028</td>
      <td>-0.041287</td>
      <td>0.617824</td>
      <td>1.122041</td>
      <td>0.549131</td>
      <td>0.417007</td>
      <td>0.274484</td>
      <td>-0.358378</td>
    </tr>
    <tr>
      <th>GD</th>
      <td>-0.882976</td>
      <td>-0.080402</td>
      <td>0.372974</td>
      <td>0.248487</td>
      <td>0.771152</td>
      <td>0.318114</td>
      <td>0.221999</td>
      <td>0.357281</td>
    </tr>
    <tr>
      <th>TYC</th>
      <td>-0.912145</td>
      <td>-0.643299</td>
      <td>0.311803</td>
      <td>-0.050323</td>
      <td>0.139579</td>
      <td>1.100624</td>
      <td>0.368677</td>
      <td>0.606749</td>
    </tr>
    <tr>
      <th>EL</th>
      <td>2.154626</td>
      <td>0.021013</td>
      <td>0.131828</td>
      <td>0.582578</td>
      <td>-0.185306</td>
      <td>-0.780114</td>
      <td>0.013948</td>
      <td>-0.455518</td>
    </tr>
    <tr>
      <th>MUR</th>
      <td>-1.061828</td>
      <td>0.052984</td>
      <td>-0.462152</td>
      <td>-0.114691</td>
      <td>2.096592</td>
      <td>-0.048482</td>
      <td>-0.176060</td>
      <td>0.358905</td>
    </tr>
    <tr>
      <th>CTAS</th>
      <td>-3.578650</td>
      <td>-0.257339</td>
      <td>-0.210434</td>
      <td>1.518212</td>
      <td>0.679532</td>
      <td>1.056545</td>
      <td>0.040240</td>
      <td>1.340254</td>
    </tr>
    <tr>
      <th>CBSA</th>
      <td>1.254518</td>
      <td>0.374674</td>
      <td>0.411306</td>
      <td>0.051556</td>
      <td>0.068912</td>
      <td>-0.008052</td>
      <td>-0.181091</td>
      <td>0.397064</td>
    </tr>
    <tr>
      <th>SNV</th>
      <td>-0.539520</td>
      <td>0.395892</td>
      <td>0.350580</td>
      <td>-0.006382</td>
      <td>-0.212917</td>
      <td>-0.211582</td>
      <td>0.059285</td>
      <td>1.852562</td>
    </tr>
    <tr>
      <th>CAM</th>
      <td>-1.355484</td>
      <td>0.095259</td>
      <td>-0.253060</td>
      <td>-0.399919</td>
      <td>2.195785</td>
      <td>0.582245</td>
      <td>-0.104797</td>
      <td>0.304394</td>
    </tr>
    <tr>
      <th>DLTR</th>
      <td>-5.174840</td>
      <td>0.074346</td>
      <td>-0.613656</td>
      <td>2.298114</td>
      <td>0.288056</td>
      <td>1.917104</td>
      <td>0.132811</td>
      <td>1.354050</td>
    </tr>
    <tr>
      <th>CAH</th>
      <td>-1.630988</td>
      <td>-0.038102</td>
      <td>0.072405</td>
      <td>0.680673</td>
      <td>0.424837</td>
      <td>0.361032</td>
      <td>0.943522</td>
      <td>0.299449</td>
    </tr>
    <tr>
      <th>DTE</th>
      <td>-0.928040</td>
      <td>-0.036109</td>
      <td>0.119051</td>
      <td>-0.061966</td>
      <td>0.683112</td>
      <td>0.116873</td>
      <td>0.375849</td>
      <td>0.371118</td>
    </tr>
    <tr>
      <th>SSP</th>
      <td>2.399326</td>
      <td>0.350959</td>
      <td>1.580018</td>
      <td>-0.202042</td>
      <td>-0.201088</td>
      <td>-0.246833</td>
      <td>-0.098819</td>
      <td>-0.182760</td>
    </tr>
    <tr>
      <th>PSA</th>
      <td>0.622382</td>
      <td>0.481627</td>
      <td>0.486698</td>
      <td>0.020108</td>
      <td>-0.253502</td>
      <td>-0.215197</td>
      <td>0.057023</td>
      <td>0.251477</td>
    </tr>
    <tr>
      <th>EXC</th>
      <td>-2.716094</td>
      <td>0.103962</td>
      <td>-0.141726</td>
      <td>0.081577</td>
      <td>1.444151</td>
      <td>0.511308</td>
      <td>0.631693</td>
      <td>0.640010</td>
    </tr>
    <tr>
      <th>TKR</th>
      <td>-0.388819</td>
      <td>0.416236</td>
      <td>0.267321</td>
      <td>0.565174</td>
      <td>1.210320</td>
      <td>0.088204</td>
      <td>-0.142882</td>
      <td>0.315733</td>
    </tr>
    <tr>
      <th>CMA</th>
      <td>0.264046</td>
      <td>0.016297</td>
      <td>0.642026</td>
      <td>0.017207</td>
      <td>-0.484673</td>
      <td>-0.179948</td>
      <td>-0.028546</td>
      <td>1.202915</td>
    </tr>
    <tr>
      <th>ORCL</th>
      <td>-0.443179</td>
      <td>0.276515</td>
      <td>-0.141783</td>
      <td>-0.432309</td>
      <td>-0.062194</td>
      <td>1.202321</td>
      <td>0.163463</td>
      <td>0.339055</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>-0.045133</td>
      <td>-0.036167</td>
      <td>-0.699804</td>
      <td>-0.683817</td>
      <td>0.336957</td>
      <td>0.396558</td>
      <td>0.024887</td>
      <td>1.352232</td>
    </tr>
    <tr>
      <th>RSG</th>
      <td>-2.099194</td>
      <td>0.180949</td>
      <td>0.140585</td>
      <td>0.681522</td>
      <td>0.922261</td>
      <td>0.321369</td>
      <td>0.436344</td>
      <td>0.587005</td>
    </tr>
    <tr>
      <th>ACAS</th>
      <td>1.183355</td>
      <td>0.843240</td>
      <td>0.376865</td>
      <td>-0.143280</td>
      <td>-0.396161</td>
      <td>-0.591000</td>
      <td>0.177911</td>
      <td>1.195170</td>
    </tr>
    <tr>
      <th>AGN</th>
      <td>-3.155467</td>
      <td>0.230579</td>
      <td>-0.459391</td>
      <td>0.565370</td>
      <td>0.753599</td>
      <td>0.610063</td>
      <td>1.317825</td>
      <td>1.031209</td>
    </tr>
    <tr>
      <th>MMM</th>
      <td>-0.685658</td>
      <td>0.108876</td>
      <td>-0.427307</td>
      <td>0.412635</td>
      <td>0.499862</td>
      <td>-0.087273</td>
      <td>0.020962</td>
      <td>0.725735</td>
    </tr>
    <tr>
      <th>ETFC</th>
      <td>3.194747</td>
      <td>0.319935</td>
      <td>0.462664</td>
      <td>-0.100397</td>
      <td>-1.166081</td>
      <td>0.388496</td>
      <td>-1.065132</td>
      <td>0.293853</td>
    </tr>
    <tr>
      <th>CAR</th>
      <td>5.707205</td>
      <td>0.634022</td>
      <td>0.613190</td>
      <td>-0.028923</td>
      <td>-0.640322</td>
      <td>-1.428886</td>
      <td>-0.848328</td>
      <td>0.445591</td>
    </tr>
    <tr>
      <th>MDR</th>
      <td>-2.732450</td>
      <td>0.823879</td>
      <td>0.242378</td>
      <td>0.578830</td>
      <td>2.491042</td>
      <td>0.749193</td>
      <td>0.228586</td>
      <td>0.294130</td>
    </tr>
    <tr>
      <th>NOV</th>
      <td>-1.060649</td>
      <td>0.567584</td>
      <td>-0.402920</td>
      <td>-0.576143</td>
      <td>2.657741</td>
      <td>0.407855</td>
      <td>-0.062682</td>
      <td>-0.033028</td>
    </tr>
    <tr>
      <th>PCH</th>
      <td>0.338300</td>
      <td>0.222614</td>
      <td>0.484055</td>
      <td>0.639595</td>
      <td>0.218290</td>
      <td>0.067740</td>
      <td>-0.204804</td>
      <td>-0.010591</td>
    </tr>
    <tr>
      <th>BAX</th>
      <td>-1.347025</td>
      <td>-0.169875</td>
      <td>0.524005</td>
      <td>0.129125</td>
      <td>0.322082</td>
      <td>0.673845</td>
      <td>0.753479</td>
      <td>0.186215</td>
    </tr>
    <tr>
      <th>JCI</th>
      <td>-1.405615</td>
      <td>0.413783</td>
      <td>-0.013446</td>
      <td>0.727272</td>
      <td>0.309943</td>
      <td>0.490319</td>
      <td>-0.211553</td>
      <td>1.245598</td>
    </tr>
    <tr>
      <th>SWK</th>
      <td>-1.311538</td>
      <td>0.265555</td>
      <td>0.117049</td>
      <td>0.948610</td>
      <td>0.775872</td>
      <td>0.352706</td>
      <td>-0.193721</td>
      <td>0.641327</td>
    </tr>
    <tr>
      <th>DVN</th>
      <td>-0.628297</td>
      <td>0.039510</td>
      <td>0.137274</td>
      <td>-0.711291</td>
      <td>2.202942</td>
      <td>0.092802</td>
      <td>-0.118880</td>
      <td>0.165942</td>
    </tr>
    <tr>
      <th>TMO</th>
      <td>-3.252323</td>
      <td>-0.109431</td>
      <td>-0.436633</td>
      <td>0.651302</td>
      <td>0.885895</td>
      <td>1.193456</td>
      <td>0.897081</td>
      <td>0.867523</td>
    </tr>
    <tr>
      <th>PEP</th>
      <td>-0.550382</td>
      <td>-0.195754</td>
      <td>-0.152812</td>
      <td>0.768006</td>
      <td>-0.036170</td>
      <td>-0.030038</td>
      <td>0.511441</td>
      <td>0.157377</td>
    </tr>
    <tr>
      <th>LNC</th>
      <td>0.966791</td>
      <td>-0.031215</td>
      <td>0.400256</td>
      <td>-0.799016</td>
      <td>0.351931</td>
      <td>-0.344330</td>
      <td>0.096968</td>
      <td>1.505419</td>
    </tr>
    <tr>
      <th>EMR</th>
      <td>-2.044490</td>
      <td>-0.164199</td>
      <td>-0.242630</td>
      <td>0.491329</td>
      <td>0.986217</td>
      <td>0.688294</td>
      <td>0.238868</td>
      <td>0.847025</td>
    </tr>
    <tr>
      <th>MLM</th>
      <td>-2.844542</td>
      <td>0.188420</td>
      <td>-0.045674</td>
      <td>0.738026</td>
      <td>1.033461</td>
      <td>0.705830</td>
      <td>0.168861</td>
      <td>1.195677</td>
    </tr>
    <tr>
      <th>CCI</th>
      <td>-3.292825</td>
      <td>0.369532</td>
      <td>-0.643553</td>
      <td>0.468055</td>
      <td>1.128932</td>
      <td>1.851582</td>
      <td>0.739993</td>
      <td>0.667109</td>
    </tr>
    <tr>
      <th>NU</th>
      <td>0.770045</td>
      <td>-0.082375</td>
      <td>-0.121005</td>
      <td>0.392876</td>
      <td>0.234804</td>
      <td>-0.450403</td>
      <td>0.105630</td>
      <td>-0.246886</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="reconstructing-the-co-variance-matrix">
<h2><span class="section-number">9.3. </span>Reconstructing the co-variance matrix<a class="headerlink" href="#reconstructing-the-co-variance-matrix" title="Permalink to this heading">#</a></h2>
<p>We have</p>
<div class="math notranslate nohighlight">
\[R_t=B&#64;F_t+u_t\]</div>
<p>Then</p>
<div class="math notranslate nohighlight">
\[Var(R_t)=B&#64;Var(F_t)&#64;B.T+Var(U_t)\]</div>
<p>The big difference is that now <span class="math notranslate nohighlight">\(F\)</span> is a vector of factors</p>
<p>so <span class="math notranslate nohighlight">\(Var(F_t)\)</span> is a M by M variance covariance matrix</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Var_F</span><span class="o">=</span><span class="n">Factors</span><span class="o">.</span><span class="n">cov</span><span class="p">()</span>
<span class="n">Cov_F</span><span class="o">=</span><span class="n">Beta</span> <span class="o">@</span> <span class="n">Var_F</span> <span class="o">@</span> <span class="n">Beta</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">VarU</span><span class="p">[</span><span class="s1">&#39;VarU&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">Cov_F</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CTL</th>
      <th>T</th>
      <th>CSCO</th>
      <th>FCX</th>
      <th>XL</th>
      <th>IVZ</th>
      <th>AMT</th>
      <th>WHR</th>
      <th>IR</th>
      <th>WFT</th>
      <th>...</th>
      <th>JCI</th>
      <th>SWK</th>
      <th>DVN</th>
      <th>TMO</th>
      <th>PEP</th>
      <th>LNC</th>
      <th>EMR</th>
      <th>MLM</th>
      <th>CCI</th>
      <th>NU</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>CTL</th>
      <td>0.006550</td>
      <td>0.001408</td>
      <td>0.002038</td>
      <td>0.002353</td>
      <td>0.002344</td>
      <td>0.003068</td>
      <td>0.001478</td>
      <td>0.002345</td>
      <td>0.002524</td>
      <td>0.002014</td>
      <td>...</td>
      <td>0.001866</td>
      <td>0.001834</td>
      <td>0.001465</td>
      <td>0.001725</td>
      <td>0.000972</td>
      <td>0.002767</td>
      <td>0.001863</td>
      <td>0.001482</td>
      <td>0.002324</td>
      <td>0.000972</td>
    </tr>
    <tr>
      <th>T</th>
      <td>0.001408</td>
      <td>0.004688</td>
      <td>0.001840</td>
      <td>0.001529</td>
      <td>0.002097</td>
      <td>0.002673</td>
      <td>0.001342</td>
      <td>0.002003</td>
      <td>0.002108</td>
      <td>0.001364</td>
      <td>...</td>
      <td>0.001478</td>
      <td>0.001464</td>
      <td>0.001073</td>
      <td>0.001628</td>
      <td>0.000898</td>
      <td>0.002289</td>
      <td>0.001655</td>
      <td>0.001333</td>
      <td>0.001848</td>
      <td>0.000682</td>
    </tr>
    <tr>
      <th>CSCO</th>
      <td>0.002038</td>
      <td>0.001840</td>
      <td>0.011381</td>
      <td>0.004141</td>
      <td>0.003665</td>
      <td>0.007108</td>
      <td>0.005885</td>
      <td>0.004123</td>
      <td>0.004269</td>
      <td>0.003808</td>
      <td>...</td>
      <td>0.003918</td>
      <td>0.002949</td>
      <td>0.001776</td>
      <td>0.003202</td>
      <td>0.000737</td>
      <td>0.004472</td>
      <td>0.002989</td>
      <td>0.002185</td>
      <td>0.006565</td>
      <td>0.000827</td>
    </tr>
    <tr>
      <th>FCX</th>
      <td>0.002353</td>
      <td>0.001529</td>
      <td>0.004141</td>
      <td>0.016977</td>
      <td>0.004431</td>
      <td>0.006325</td>
      <td>0.004123</td>
      <td>0.004492</td>
      <td>0.005487</td>
      <td>0.007251</td>
      <td>...</td>
      <td>0.004302</td>
      <td>0.004351</td>
      <td>0.005067</td>
      <td>0.002811</td>
      <td>0.000827</td>
      <td>0.005794</td>
      <td>0.003777</td>
      <td>0.003399</td>
      <td>0.005176</td>
      <td>0.001782</td>
    </tr>
    <tr>
      <th>XL</th>
      <td>0.002344</td>
      <td>0.002097</td>
      <td>0.003665</td>
      <td>0.004431</td>
      <td>0.016149</td>
      <td>0.006390</td>
      <td>0.001929</td>
      <td>0.006672</td>
      <td>0.005633</td>
      <td>0.004734</td>
      <td>...</td>
      <td>0.005489</td>
      <td>0.004780</td>
      <td>0.003223</td>
      <td>0.002946</td>
      <td>0.001755</td>
      <td>0.008175</td>
      <td>0.004011</td>
      <td>0.004223</td>
      <td>0.003393</td>
      <td>0.001667</td>
    </tr>
    <tr>
      <th>IVZ</th>
      <td>0.003068</td>
      <td>0.002673</td>
      <td>0.007108</td>
      <td>0.006325</td>
      <td>0.006390</td>
      <td>0.013659</td>
      <td>0.006441</td>
      <td>0.006358</td>
      <td>0.006517</td>
      <td>0.006437</td>
      <td>...</td>
      <td>0.005675</td>
      <td>0.004862</td>
      <td>0.004039</td>
      <td>0.004611</td>
      <td>0.001651</td>
      <td>0.007721</td>
      <td>0.004788</td>
      <td>0.004047</td>
      <td>0.007738</td>
      <td>0.001823</td>
    </tr>
    <tr>
      <th>AMT</th>
      <td>0.001478</td>
      <td>0.001342</td>
      <td>0.005885</td>
      <td>0.004123</td>
      <td>0.001929</td>
      <td>0.006441</td>
      <td>0.031007</td>
      <td>0.002818</td>
      <td>0.003462</td>
      <td>0.004313</td>
      <td>...</td>
      <td>0.002842</td>
      <td>0.002246</td>
      <td>0.002495</td>
      <td>0.003106</td>
      <td>0.000404</td>
      <td>0.003400</td>
      <td>0.002591</td>
      <td>0.001729</td>
      <td>0.006626</td>
      <td>0.000725</td>
    </tr>
    <tr>
      <th>WHR</th>
      <td>0.002345</td>
      <td>0.002003</td>
      <td>0.004123</td>
      <td>0.004492</td>
      <td>0.006672</td>
      <td>0.006358</td>
      <td>0.002818</td>
      <td>0.013016</td>
      <td>0.005424</td>
      <td>0.004185</td>
      <td>...</td>
      <td>0.005186</td>
      <td>0.004573</td>
      <td>0.002741</td>
      <td>0.002847</td>
      <td>0.001674</td>
      <td>0.007106</td>
      <td>0.003566</td>
      <td>0.003761</td>
      <td>0.003953</td>
      <td>0.001647</td>
    </tr>
    <tr>
      <th>IR</th>
      <td>0.002524</td>
      <td>0.002108</td>
      <td>0.004269</td>
      <td>0.005487</td>
      <td>0.005633</td>
      <td>0.006517</td>
      <td>0.003462</td>
      <td>0.005424</td>
      <td>0.010436</td>
      <td>0.005557</td>
      <td>...</td>
      <td>0.004651</td>
      <td>0.004379</td>
      <td>0.003777</td>
      <td>0.003135</td>
      <td>0.001402</td>
      <td>0.006352</td>
      <td>0.003864</td>
      <td>0.003627</td>
      <td>0.004728</td>
      <td>0.001701</td>
    </tr>
    <tr>
      <th>WFT</th>
      <td>0.002014</td>
      <td>0.001364</td>
      <td>0.003808</td>
      <td>0.007251</td>
      <td>0.004734</td>
      <td>0.006437</td>
      <td>0.004313</td>
      <td>0.004185</td>
      <td>0.005557</td>
      <td>0.015806</td>
      <td>...</td>
      <td>0.004336</td>
      <td>0.004459</td>
      <td>0.006108</td>
      <td>0.002894</td>
      <td>0.000642</td>
      <td>0.006455</td>
      <td>0.004048</td>
      <td>0.003746</td>
      <td>0.005082</td>
      <td>0.001747</td>
    </tr>
    <tr>
      <th>YUM</th>
      <td>0.001352</td>
      <td>0.000950</td>
      <td>0.001728</td>
      <td>0.003054</td>
      <td>0.002855</td>
      <td>0.003040</td>
      <td>0.001257</td>
      <td>0.002778</td>
      <td>0.002921</td>
      <td>0.002952</td>
      <td>...</td>
      <td>0.002415</td>
      <td>0.002418</td>
      <td>0.001945</td>
      <td>0.001536</td>
      <td>0.000814</td>
      <td>0.002908</td>
      <td>0.001978</td>
      <td>0.001953</td>
      <td>0.002244</td>
      <td>0.001012</td>
    </tr>
    <tr>
      <th>CVS</th>
      <td>0.001480</td>
      <td>0.001384</td>
      <td>0.001591</td>
      <td>0.002644</td>
      <td>0.002945</td>
      <td>0.003036</td>
      <td>0.001260</td>
      <td>0.003146</td>
      <td>0.002905</td>
      <td>0.002517</td>
      <td>...</td>
      <td>0.002260</td>
      <td>0.002367</td>
      <td>0.001945</td>
      <td>0.001669</td>
      <td>0.001038</td>
      <td>0.003190</td>
      <td>0.002020</td>
      <td>0.002022</td>
      <td>0.001926</td>
      <td>0.001055</td>
    </tr>
    <tr>
      <th>GD</th>
      <td>0.001531</td>
      <td>0.001394</td>
      <td>0.001973</td>
      <td>0.003187</td>
      <td>0.003706</td>
      <td>0.003748</td>
      <td>0.001701</td>
      <td>0.003405</td>
      <td>0.003320</td>
      <td>0.003487</td>
      <td>...</td>
      <td>0.002720</td>
      <td>0.002691</td>
      <td>0.002720</td>
      <td>0.001929</td>
      <td>0.001009</td>
      <td>0.004394</td>
      <td>0.002455</td>
      <td>0.002398</td>
      <td>0.002321</td>
      <td>0.001149</td>
    </tr>
    <tr>
      <th>TYC</th>
      <td>0.002319</td>
      <td>0.002321</td>
      <td>0.004628</td>
      <td>0.003569</td>
      <td>0.004665</td>
      <td>0.006115</td>
      <td>0.003713</td>
      <td>0.004243</td>
      <td>0.004277</td>
      <td>0.003585</td>
      <td>...</td>
      <td>0.003649</td>
      <td>0.003083</td>
      <td>0.002366</td>
      <td>0.003132</td>
      <td>0.001321</td>
      <td>0.005482</td>
      <td>0.003279</td>
      <td>0.002683</td>
      <td>0.004597</td>
      <td>0.001186</td>
    </tr>
    <tr>
      <th>EL</th>
      <td>0.001717</td>
      <td>0.001196</td>
      <td>0.002220</td>
      <td>0.003124</td>
      <td>0.003484</td>
      <td>0.003731</td>
      <td>0.001656</td>
      <td>0.003612</td>
      <td>0.003234</td>
      <td>0.002862</td>
      <td>...</td>
      <td>0.002786</td>
      <td>0.002622</td>
      <td>0.002048</td>
      <td>0.001838</td>
      <td>0.001099</td>
      <td>0.004084</td>
      <td>0.002219</td>
      <td>0.002103</td>
      <td>0.002579</td>
      <td>0.001234</td>
    </tr>
    <tr>
      <th>MUR</th>
      <td>0.001436</td>
      <td>0.000947</td>
      <td>0.001569</td>
      <td>0.004746</td>
      <td>0.002869</td>
      <td>0.003660</td>
      <td>0.002128</td>
      <td>0.002370</td>
      <td>0.003507</td>
      <td>0.005581</td>
      <td>...</td>
      <td>0.002444</td>
      <td>0.002825</td>
      <td>0.004378</td>
      <td>0.001860</td>
      <td>0.000590</td>
      <td>0.004110</td>
      <td>0.002670</td>
      <td>0.002469</td>
      <td>0.002742</td>
      <td>0.001339</td>
    </tr>
    <tr>
      <th>CTAS</th>
      <td>0.001812</td>
      <td>0.001830</td>
      <td>0.002505</td>
      <td>0.003019</td>
      <td>0.004603</td>
      <td>0.004191</td>
      <td>0.001373</td>
      <td>0.003948</td>
      <td>0.003810</td>
      <td>0.003030</td>
      <td>...</td>
      <td>0.003298</td>
      <td>0.003086</td>
      <td>0.002004</td>
      <td>0.002216</td>
      <td>0.001273</td>
      <td>0.004401</td>
      <td>0.002755</td>
      <td>0.002732</td>
      <td>0.002537</td>
      <td>0.001119</td>
    </tr>
    <tr>
      <th>CBSA</th>
      <td>0.002446</td>
      <td>0.001810</td>
      <td>0.005183</td>
      <td>0.005584</td>
      <td>0.006164</td>
      <td>0.007256</td>
      <td>0.004248</td>
      <td>0.006167</td>
      <td>0.005631</td>
      <td>0.005572</td>
      <td>...</td>
      <td>0.005226</td>
      <td>0.004521</td>
      <td>0.003605</td>
      <td>0.003150</td>
      <td>0.001298</td>
      <td>0.007305</td>
      <td>0.003846</td>
      <td>0.003615</td>
      <td>0.005347</td>
      <td>0.001660</td>
    </tr>
    <tr>
      <th>SNV</th>
      <td>0.001411</td>
      <td>0.001208</td>
      <td>0.002177</td>
      <td>0.002837</td>
      <td>0.006164</td>
      <td>0.004329</td>
      <td>0.000971</td>
      <td>0.005314</td>
      <td>0.003897</td>
      <td>0.003187</td>
      <td>...</td>
      <td>0.004119</td>
      <td>0.003489</td>
      <td>0.002307</td>
      <td>0.001834</td>
      <td>0.001270</td>
      <td>0.006575</td>
      <td>0.002722</td>
      <td>0.003134</td>
      <td>0.001799</td>
      <td>0.001190</td>
    </tr>
    <tr>
      <th>CAM</th>
      <td>0.001875</td>
      <td>0.001363</td>
      <td>0.003476</td>
      <td>0.005858</td>
      <td>0.003463</td>
      <td>0.005550</td>
      <td>0.004038</td>
      <td>0.003190</td>
      <td>0.004488</td>
      <td>0.006669</td>
      <td>...</td>
      <td>0.003309</td>
      <td>0.003437</td>
      <td>0.004906</td>
      <td>0.002683</td>
      <td>0.000644</td>
      <td>0.005069</td>
      <td>0.003370</td>
      <td>0.002891</td>
      <td>0.004662</td>
      <td>0.001475</td>
    </tr>
    <tr>
      <th>DLTR</th>
      <td>0.001495</td>
      <td>0.001531</td>
      <td>0.003615</td>
      <td>0.002177</td>
      <td>0.003122</td>
      <td>0.004143</td>
      <td>0.002376</td>
      <td>0.003139</td>
      <td>0.003044</td>
      <td>0.001609</td>
      <td>...</td>
      <td>0.002818</td>
      <td>0.002295</td>
      <td>0.000292</td>
      <td>0.002149</td>
      <td>0.000948</td>
      <td>0.002319</td>
      <td>0.002052</td>
      <td>0.001821</td>
      <td>0.003554</td>
      <td>0.000615</td>
    </tr>
    <tr>
      <th>CAH</th>
      <td>0.001220</td>
      <td>0.001178</td>
      <td>0.001173</td>
      <td>0.001478</td>
      <td>0.002356</td>
      <td>0.002576</td>
      <td>0.001150</td>
      <td>0.002369</td>
      <td>0.002045</td>
      <td>0.001487</td>
      <td>...</td>
      <td>0.001581</td>
      <td>0.001586</td>
      <td>0.001314</td>
      <td>0.001740</td>
      <td>0.001134</td>
      <td>0.002762</td>
      <td>0.001658</td>
      <td>0.001550</td>
      <td>0.001732</td>
      <td>0.000904</td>
    </tr>
    <tr>
      <th>DTE</th>
      <td>0.000683</td>
      <td>0.000652</td>
      <td>0.000424</td>
      <td>0.001438</td>
      <td>0.001770</td>
      <td>0.001581</td>
      <td>0.000576</td>
      <td>0.001483</td>
      <td>0.001486</td>
      <td>0.001808</td>
      <td>...</td>
      <td>0.001115</td>
      <td>0.001228</td>
      <td>0.001632</td>
      <td>0.000966</td>
      <td>0.000573</td>
      <td>0.002283</td>
      <td>0.001219</td>
      <td>0.001228</td>
      <td>0.000808</td>
      <td>0.000633</td>
    </tr>
    <tr>
      <th>SSP</th>
      <td>0.002266</td>
      <td>0.001854</td>
      <td>0.004049</td>
      <td>0.005008</td>
      <td>0.006569</td>
      <td>0.006387</td>
      <td>0.003098</td>
      <td>0.006659</td>
      <td>0.005422</td>
      <td>0.005068</td>
      <td>...</td>
      <td>0.005094</td>
      <td>0.004550</td>
      <td>0.003653</td>
      <td>0.002661</td>
      <td>0.001400</td>
      <td>0.007734</td>
      <td>0.003624</td>
      <td>0.003746</td>
      <td>0.003847</td>
      <td>0.001676</td>
    </tr>
    <tr>
      <th>PSA</th>
      <td>0.000587</td>
      <td>0.000375</td>
      <td>0.001271</td>
      <td>0.001487</td>
      <td>0.002471</td>
      <td>0.002089</td>
      <td>0.000908</td>
      <td>0.002590</td>
      <td>0.001764</td>
      <td>0.001473</td>
      <td>...</td>
      <td>0.001907</td>
      <td>0.001596</td>
      <td>0.000982</td>
      <td>0.000785</td>
      <td>0.000489</td>
      <td>0.002776</td>
      <td>0.001100</td>
      <td>0.001303</td>
      <td>0.001166</td>
      <td>0.000542</td>
    </tr>
    <tr>
      <th>EXC</th>
      <td>0.000593</td>
      <td>0.000582</td>
      <td>0.000139</td>
      <td>0.001692</td>
      <td>0.001358</td>
      <td>0.001494</td>
      <td>0.000764</td>
      <td>0.001073</td>
      <td>0.001441</td>
      <td>0.002299</td>
      <td>...</td>
      <td>0.000869</td>
      <td>0.001177</td>
      <td>0.002093</td>
      <td>0.001088</td>
      <td>0.000540</td>
      <td>0.001978</td>
      <td>0.001282</td>
      <td>0.001268</td>
      <td>0.000946</td>
      <td>0.000684</td>
    </tr>
    <tr>
      <th>TKR</th>
      <td>0.002336</td>
      <td>0.001715</td>
      <td>0.003784</td>
      <td>0.006036</td>
      <td>0.005664</td>
      <td>0.006354</td>
      <td>0.003415</td>
      <td>0.005583</td>
      <td>0.005571</td>
      <td>0.006350</td>
      <td>...</td>
      <td>0.004735</td>
      <td>0.004583</td>
      <td>0.004538</td>
      <td>0.002921</td>
      <td>0.001276</td>
      <td>0.006793</td>
      <td>0.003860</td>
      <td>0.003784</td>
      <td>0.004502</td>
      <td>0.001842</td>
    </tr>
    <tr>
      <th>CMA</th>
      <td>0.001344</td>
      <td>0.001295</td>
      <td>0.001845</td>
      <td>0.002160</td>
      <td>0.005333</td>
      <td>0.003587</td>
      <td>0.000571</td>
      <td>0.004590</td>
      <td>0.003306</td>
      <td>0.002322</td>
      <td>...</td>
      <td>0.003442</td>
      <td>0.002921</td>
      <td>0.001735</td>
      <td>0.001532</td>
      <td>0.001163</td>
      <td>0.005583</td>
      <td>0.002307</td>
      <td>0.002628</td>
      <td>0.001271</td>
      <td>0.000992</td>
    </tr>
    <tr>
      <th>ORCL</th>
      <td>0.001463</td>
      <td>0.001120</td>
      <td>0.005648</td>
      <td>0.003355</td>
      <td>0.002382</td>
      <td>0.005814</td>
      <td>0.005325</td>
      <td>0.002873</td>
      <td>0.003138</td>
      <td>0.003120</td>
      <td>...</td>
      <td>0.002970</td>
      <td>0.002076</td>
      <td>0.001345</td>
      <td>0.002572</td>
      <td>0.000397</td>
      <td>0.003286</td>
      <td>0.002215</td>
      <td>0.001442</td>
      <td>0.005801</td>
      <td>0.000575</td>
    </tr>
    <tr>
      <th>MS</th>
      <td>0.002326</td>
      <td>0.001762</td>
      <td>0.005706</td>
      <td>0.005056</td>
      <td>0.005223</td>
      <td>0.007390</td>
      <td>0.004990</td>
      <td>0.004663</td>
      <td>0.004978</td>
      <td>0.005327</td>
      <td>...</td>
      <td>0.004545</td>
      <td>0.003689</td>
      <td>0.003303</td>
      <td>0.003438</td>
      <td>0.001085</td>
      <td>0.006578</td>
      <td>0.003729</td>
      <td>0.003037</td>
      <td>0.006080</td>
      <td>0.001376</td>
    </tr>
    <tr>
      <th>RSG</th>
      <td>0.001003</td>
      <td>0.000921</td>
      <td>0.000682</td>
      <td>0.002150</td>
      <td>0.002774</td>
      <td>0.002294</td>
      <td>0.000657</td>
      <td>0.002560</td>
      <td>0.002341</td>
      <td>0.002447</td>
      <td>...</td>
      <td>0.001886</td>
      <td>0.002019</td>
      <td>0.002048</td>
      <td>0.001343</td>
      <td>0.000886</td>
      <td>0.003109</td>
      <td>0.001744</td>
      <td>0.001894</td>
      <td>0.001174</td>
      <td>0.000928</td>
    </tr>
    <tr>
      <th>ACAS</th>
      <td>0.001850</td>
      <td>0.001227</td>
      <td>0.003752</td>
      <td>0.004207</td>
      <td>0.006490</td>
      <td>0.006028</td>
      <td>0.002795</td>
      <td>0.006302</td>
      <td>0.004812</td>
      <td>0.004325</td>
      <td>...</td>
      <td>0.004970</td>
      <td>0.004144</td>
      <td>0.002893</td>
      <td>0.002542</td>
      <td>0.001386</td>
      <td>0.007465</td>
      <td>0.003257</td>
      <td>0.003463</td>
      <td>0.003757</td>
      <td>0.001524</td>
    </tr>
    <tr>
      <th>AGN</th>
      <td>0.001099</td>
      <td>0.001006</td>
      <td>0.001366</td>
      <td>0.001444</td>
      <td>0.002254</td>
      <td>0.002870</td>
      <td>0.001644</td>
      <td>0.002192</td>
      <td>0.001956</td>
      <td>0.001637</td>
      <td>...</td>
      <td>0.001569</td>
      <td>0.001483</td>
      <td>0.001367</td>
      <td>0.002000</td>
      <td>0.001149</td>
      <td>0.002803</td>
      <td>0.001711</td>
      <td>0.001543</td>
      <td>0.002240</td>
      <td>0.000896</td>
    </tr>
    <tr>
      <th>MMM</th>
      <td>0.001204</td>
      <td>0.000869</td>
      <td>0.001750</td>
      <td>0.002669</td>
      <td>0.003007</td>
      <td>0.003105</td>
      <td>0.001392</td>
      <td>0.002660</td>
      <td>0.002669</td>
      <td>0.002828</td>
      <td>...</td>
      <td>0.002331</td>
      <td>0.002183</td>
      <td>0.001986</td>
      <td>0.001550</td>
      <td>0.000773</td>
      <td>0.003428</td>
      <td>0.001941</td>
      <td>0.001872</td>
      <td>0.002150</td>
      <td>0.000925</td>
    </tr>
    <tr>
      <th>ETFC</th>
      <td>0.003105</td>
      <td>0.002268</td>
      <td>0.009005</td>
      <td>0.006920</td>
      <td>0.007448</td>
      <td>0.010182</td>
      <td>0.006886</td>
      <td>0.007719</td>
      <td>0.007088</td>
      <td>0.006264</td>
      <td>...</td>
      <td>0.007030</td>
      <td>0.005448</td>
      <td>0.003063</td>
      <td>0.003941</td>
      <td>0.001128</td>
      <td>0.008458</td>
      <td>0.004577</td>
      <td>0.003929</td>
      <td>0.008323</td>
      <td>0.001550</td>
    </tr>
    <tr>
      <th>CAR</th>
      <td>0.004852</td>
      <td>0.003310</td>
      <td>0.009505</td>
      <td>0.010870</td>
      <td>0.012537</td>
      <td>0.013683</td>
      <td>0.007244</td>
      <td>0.012337</td>
      <td>0.010987</td>
      <td>0.010677</td>
      <td>...</td>
      <td>0.010376</td>
      <td>0.008964</td>
      <td>0.006950</td>
      <td>0.005744</td>
      <td>0.002601</td>
      <td>0.014735</td>
      <td>0.007397</td>
      <td>0.007085</td>
      <td>0.009634</td>
      <td>0.003375</td>
    </tr>
    <tr>
      <th>MDR</th>
      <td>0.002036</td>
      <td>0.001430</td>
      <td>0.003367</td>
      <td>0.006595</td>
      <td>0.004608</td>
      <td>0.006113</td>
      <td>0.004006</td>
      <td>0.004839</td>
      <td>0.005388</td>
      <td>0.007301</td>
      <td>...</td>
      <td>0.004224</td>
      <td>0.004428</td>
      <td>0.005406</td>
      <td>0.002950</td>
      <td>0.001035</td>
      <td>0.006071</td>
      <td>0.003800</td>
      <td>0.003716</td>
      <td>0.004779</td>
      <td>0.001863</td>
    </tr>
    <tr>
      <th>NOV</th>
      <td>0.001773</td>
      <td>0.000980</td>
      <td>0.003748</td>
      <td>0.006711</td>
      <td>0.002866</td>
      <td>0.005861</td>
      <td>0.004929</td>
      <td>0.003018</td>
      <td>0.004598</td>
      <td>0.007619</td>
      <td>...</td>
      <td>0.003310</td>
      <td>0.003525</td>
      <td>0.005547</td>
      <td>0.002758</td>
      <td>0.000429</td>
      <td>0.004892</td>
      <td>0.003388</td>
      <td>0.002848</td>
      <td>0.005442</td>
      <td>0.001575</td>
    </tr>
    <tr>
      <th>PCH</th>
      <td>0.001594</td>
      <td>0.001248</td>
      <td>0.002743</td>
      <td>0.003597</td>
      <td>0.003976</td>
      <td>0.004192</td>
      <td>0.002075</td>
      <td>0.004064</td>
      <td>0.003670</td>
      <td>0.003503</td>
      <td>...</td>
      <td>0.003285</td>
      <td>0.003036</td>
      <td>0.002351</td>
      <td>0.001836</td>
      <td>0.000907</td>
      <td>0.004424</td>
      <td>0.002428</td>
      <td>0.002433</td>
      <td>0.002844</td>
      <td>0.001129</td>
    </tr>
    <tr>
      <th>BAX</th>
      <td>0.000993</td>
      <td>0.001134</td>
      <td>0.001334</td>
      <td>0.001201</td>
      <td>0.002076</td>
      <td>0.002379</td>
      <td>0.001281</td>
      <td>0.002048</td>
      <td>0.001755</td>
      <td>0.001305</td>
      <td>...</td>
      <td>0.001382</td>
      <td>0.001315</td>
      <td>0.001161</td>
      <td>0.001473</td>
      <td>0.000849</td>
      <td>0.002530</td>
      <td>0.001436</td>
      <td>0.001308</td>
      <td>0.001540</td>
      <td>0.000647</td>
    </tr>
    <tr>
      <th>JCI</th>
      <td>0.001866</td>
      <td>0.001478</td>
      <td>0.003918</td>
      <td>0.004302</td>
      <td>0.005489</td>
      <td>0.005675</td>
      <td>0.002842</td>
      <td>0.005186</td>
      <td>0.004651</td>
      <td>0.004336</td>
      <td>...</td>
      <td>0.008705</td>
      <td>0.003846</td>
      <td>0.002668</td>
      <td>0.002468</td>
      <td>0.001110</td>
      <td>0.005876</td>
      <td>0.003151</td>
      <td>0.003153</td>
      <td>0.003925</td>
      <td>0.001280</td>
    </tr>
    <tr>
      <th>SWK</th>
      <td>0.001834</td>
      <td>0.001464</td>
      <td>0.002949</td>
      <td>0.004351</td>
      <td>0.004780</td>
      <td>0.004862</td>
      <td>0.002246</td>
      <td>0.004573</td>
      <td>0.004379</td>
      <td>0.004459</td>
      <td>...</td>
      <td>0.003846</td>
      <td>0.006821</td>
      <td>0.003047</td>
      <td>0.002232</td>
      <td>0.001084</td>
      <td>0.005213</td>
      <td>0.002990</td>
      <td>0.003019</td>
      <td>0.003254</td>
      <td>0.001360</td>
    </tr>
    <tr>
      <th>DVN</th>
      <td>0.001465</td>
      <td>0.001073</td>
      <td>0.001776</td>
      <td>0.005067</td>
      <td>0.003223</td>
      <td>0.004039</td>
      <td>0.002495</td>
      <td>0.002741</td>
      <td>0.003777</td>
      <td>0.006108</td>
      <td>...</td>
      <td>0.002668</td>
      <td>0.003047</td>
      <td>0.008892</td>
      <td>0.001957</td>
      <td>0.000568</td>
      <td>0.004821</td>
      <td>0.002885</td>
      <td>0.002703</td>
      <td>0.002847</td>
      <td>0.001392</td>
    </tr>
    <tr>
      <th>TMO</th>
      <td>0.001725</td>
      <td>0.001628</td>
      <td>0.003202</td>
      <td>0.002811</td>
      <td>0.002946</td>
      <td>0.004611</td>
      <td>0.003106</td>
      <td>0.002847</td>
      <td>0.003135</td>
      <td>0.002894</td>
      <td>...</td>
      <td>0.002468</td>
      <td>0.002232</td>
      <td>0.001957</td>
      <td>0.005828</td>
      <td>0.001166</td>
      <td>0.003563</td>
      <td>0.002517</td>
      <td>0.002029</td>
      <td>0.003931</td>
      <td>0.001043</td>
    </tr>
    <tr>
      <th>PEP</th>
      <td>0.000972</td>
      <td>0.000898</td>
      <td>0.000737</td>
      <td>0.000827</td>
      <td>0.001755</td>
      <td>0.001651</td>
      <td>0.000404</td>
      <td>0.001674</td>
      <td>0.001402</td>
      <td>0.000642</td>
      <td>...</td>
      <td>0.001110</td>
      <td>0.001084</td>
      <td>0.000568</td>
      <td>0.001166</td>
      <td>0.002153</td>
      <td>0.001812</td>
      <td>0.001115</td>
      <td>0.001030</td>
      <td>0.001018</td>
      <td>0.000644</td>
    </tr>
    <tr>
      <th>LNC</th>
      <td>0.002767</td>
      <td>0.002289</td>
      <td>0.004472</td>
      <td>0.005794</td>
      <td>0.008175</td>
      <td>0.007721</td>
      <td>0.003400</td>
      <td>0.007106</td>
      <td>0.006352</td>
      <td>0.006455</td>
      <td>...</td>
      <td>0.005876</td>
      <td>0.005213</td>
      <td>0.004821</td>
      <td>0.003563</td>
      <td>0.001812</td>
      <td>0.016605</td>
      <td>0.004683</td>
      <td>0.004602</td>
      <td>0.004586</td>
      <td>0.002062</td>
    </tr>
    <tr>
      <th>EMR</th>
      <td>0.001863</td>
      <td>0.001655</td>
      <td>0.002989</td>
      <td>0.003777</td>
      <td>0.004011</td>
      <td>0.004788</td>
      <td>0.002591</td>
      <td>0.003566</td>
      <td>0.003864</td>
      <td>0.004048</td>
      <td>...</td>
      <td>0.003151</td>
      <td>0.002990</td>
      <td>0.002885</td>
      <td>0.002517</td>
      <td>0.001115</td>
      <td>0.004683</td>
      <td>0.004656</td>
      <td>0.002626</td>
      <td>0.003509</td>
      <td>0.001249</td>
    </tr>
    <tr>
      <th>MLM</th>
      <td>0.001482</td>
      <td>0.001333</td>
      <td>0.002185</td>
      <td>0.003399</td>
      <td>0.004223</td>
      <td>0.004047</td>
      <td>0.001729</td>
      <td>0.003761</td>
      <td>0.003627</td>
      <td>0.003746</td>
      <td>...</td>
      <td>0.003153</td>
      <td>0.003019</td>
      <td>0.002703</td>
      <td>0.002029</td>
      <td>0.001030</td>
      <td>0.004602</td>
      <td>0.002626</td>
      <td>0.006714</td>
      <td>0.002541</td>
      <td>0.001150</td>
    </tr>
    <tr>
      <th>CCI</th>
      <td>0.002324</td>
      <td>0.001848</td>
      <td>0.006565</td>
      <td>0.005176</td>
      <td>0.003393</td>
      <td>0.007738</td>
      <td>0.006626</td>
      <td>0.003953</td>
      <td>0.004728</td>
      <td>0.005082</td>
      <td>...</td>
      <td>0.003925</td>
      <td>0.003254</td>
      <td>0.002847</td>
      <td>0.003931</td>
      <td>0.001018</td>
      <td>0.004586</td>
      <td>0.003509</td>
      <td>0.002541</td>
      <td>0.020334</td>
      <td>0.001265</td>
    </tr>
    <tr>
      <th>NU</th>
      <td>0.000972</td>
      <td>0.000682</td>
      <td>0.000827</td>
      <td>0.001782</td>
      <td>0.001667</td>
      <td>0.001823</td>
      <td>0.000725</td>
      <td>0.001647</td>
      <td>0.001701</td>
      <td>0.001747</td>
      <td>...</td>
      <td>0.001280</td>
      <td>0.001360</td>
      <td>0.001392</td>
      <td>0.001043</td>
      <td>0.000644</td>
      <td>0.002062</td>
      <td>0.001249</td>
      <td>0.001150</td>
      <td>0.001265</td>
      <td>0.002606</td>
    </tr>
  </tbody>
</table>
<p>50 rows × 50 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p>If we compare the in-sample Variance of our minimum variance portfolios for</p>
<ul>
<li><p>The unrestricted case</p></li>
<li><p>The single-factor covariance</p></li>
<li><p>The multi-factor covariance</p></li>
</ul>
</li>
<li><p>which one will have lowest variance? What will have the highest?</p></li>
<li><p>Now split the sample in two. Repeat the covariance estimation procedure for each of these approaches for the first half of the sample</p></li>
<li><p>Now use the weights to compute the variance of each of the portfolios in the second half</p></li>
<li><p>Is the order likely to change? Why? Why not?</p></li>
</ul>
</section>
<section id="application-how-will-your-portfolio-risk-change-as-you-add-positions">
<h2><span class="section-number">9.4. </span>Application: How will your portfolio risk change as you add positions<a class="headerlink" href="#application-how-will-your-portfolio-risk-change-as-you-add-positions" title="Permalink to this heading">#</a></h2>
<p>You have portfolio <span class="math notranslate nohighlight">\(X_0\)</span> and you want to sell w of your positions to invest in a fund with portfolio <span class="math notranslate nohighlight">\(X_1\)</span>. How your portfolio variance will change as a function of you reallocation?</p>
<ul class="simple">
<li><p>The answer is simple</p></li>
</ul>
<div class="math notranslate nohighlight">
\[Var(wX_1R_t+(1-w)X_0R_t)-Var(X_0R_t)\]</div>
<ul class="simple">
<li><p>But also kind of misleading since you might not have good data to estimate the variance of the new portfolio</p></li>
<li><p>Now if you know each portfolio factor betas,<span class="math notranslate nohighlight">\(\beta_0=X_0&#64;B\)</span> and <span class="math notranslate nohighlight">\(\beta_1=X_1&#64;B\)</span> , and at least one of this portfolio is large and well diversified, then for small tilts, i.e. <span class="math notranslate nohighlight">\(w\)</span> small, we have</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\frac{Var(wX_1R_t+(1-w)X_0R_t)-Var(X_0R_t)}{\Delta w} =\beta_1Var(F)\beta_0'\]</div>
<ul class="simple">
<li><p>The fact that one is well diversified just means that you can ignore the covariance-terms of the portfolios asset specific risks</p></li>
<li><p>So you see above why a large pool of money when allocating money to an active manager will want to regulate their factor exposure</p></li>
<li><p>funds with similar volatilities will be perceived as very different risks depending on how the exposure of portfolio relates to the exposure of the fund</p></li>
</ul>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="benchmarking">
<h1><span class="section-number">10. </span>Benchmarking<a class="headerlink" href="#benchmarking" title="Permalink to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="tracking-error">
<h1><span class="section-number">11. </span>Tracking error<a class="headerlink" href="#tracking-error" title="Permalink to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="factor-models-as-models-of-expected-returns">
<h1><span class="section-number">12. </span>Factor Models as Models of Expected Returns<a class="headerlink" href="#factor-models-as-models-of-expected-returns" title="Permalink to this heading">#</a></h1>
<section id="alpha">
<h2><span class="section-number">12.1. </span>Alpha<a class="headerlink" href="#alpha" title="Permalink to this heading">#</a></h2>
</section>
<section id="appraisal-ratios">
<h2><span class="section-number">12.2. </span>Appraisal Ratios<a class="headerlink" href="#appraisal-ratios" title="Permalink to this heading">#</a></h2>
</section>
<section id="portable-alpha-and-hedged-portfolios">
<h2><span class="section-number">12.3. </span>Portable Alpha and Hedged Portfolios<a class="headerlink" href="#portable-alpha-and-hedged-portfolios" title="Permalink to this heading">#</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1><span class="section-number">13. </span>Factor Models as Models of Expected Returns<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h1>
<p>This is from before…needs massive cleaning!</p>
<p>Our premise here is that you are lookign to invest in the portfolio with the highest Sharpe Ratio. As we discussed in chapter 10, we can always combine such portfolio with the risk-ree rate to achieve the desired volatility/expected return.</p>
<p><strong>Back to the Tangency portfolio</strong></p>
<ul class="simple">
<li><p>in Chapter 10 we solved the problem</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
maximize_{(X)} E[r_p(X)]- \frac{\gamma}{2} Var(r_p(X))\\
\end{aligned}
\end{split}\]</div>
<ul class="simple">
<li><p>And found that the portfolio that solves this problem,i.e., has the highest sharpe ratio among the set of assets that belong in the optimization have the following form</p></li>
</ul>
<div class="math notranslate nohighlight">
\[ Var(R^e)W^*=\gamma E[R^e]\]</div>
<ul class="simple">
<li><p>I.e., the quation above defines <span class="math notranslate nohighlight">\(W^*\)</span>, the weights of the tangency portfolio</p></li>
<li><p>We can rewirte the left hand side as</p></li>
</ul>
<div class="math notranslate nohighlight">
\[Var(R^e)W^*=Cov(R^e,R^e)W^*=Cov(R^e,(W^*)'R^e)=Cov(R^e,r^*)\]</div>
<ul class="simple">
<li><p>where we use that <span class="math notranslate nohighlight">\(r^*=(W^*)'R^e\)</span> is the returns of the tangency protolio</p></li>
<li><p>The left-hand side in the covariance vector of all the assets with the tangency portfolio, so it is a vector N by 1, where N is the number of assets considered.</p></li>
<li><p>This means that the expected return of an asset must be proportional to the covariance between the return of the asset and the return of the tangency portfolio</p></li>
</ul>
<div class="math notranslate nohighlight">
\[ E[R^e]=\gamma  Cov(R^e,r^*) \]</div>
<ul class="simple">
<li><p>This holds for all assets in your investment opportunity set (i.e. the assets included in the minimization problem that the tangency portfolio solves)</p></li>
<li><p>This means that for any assets <span class="math notranslate nohighlight">\(j\)</span> and <span class="math notranslate nohighlight">\(i\)</span> we have</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\frac{E[r^e_i]}{Cov(r^e_i,R^*)}= \frac{E[r^e_j]}{Cov(R^e_j,R^*)} \]</div>
<ul class="simple">
<li><p>All assets have the same expected return per-unit of covariance with the tangency portoflio</p></li>
<li><p>We can also apply this to the tangency portfolio itself</p></li>
</ul>
<div class="math notranslate nohighlight">
\[ E[R^*]=\gamma \times Cov(R^*,R^*) \]</div>
<ul class="simple">
<li><p>Which means that <span class="math notranslate nohighlight">\(\gamma=\frac{E[R^*]}{Var(R^*)}\)</span></p></li>
<li><p>Plugging back in the original and we get that for any asset <span class="math notranslate nohighlight">\(j\)</span></p></li>
</ul>
<div class="math notranslate nohighlight">
\[ E[r^e_j]=\frac{E[r^*]}{Var(r^*)} Cov(r^e_j,r^*) =\frac{Cov(r^e_j,r^*)}{Var(r^*)}E[r^*]=\beta_{j,*}E[r^*] \]</div>
<div class="math notranslate nohighlight">
\[ E[r^e_j]=\beta_{j,*}E[r^*] \]</div>
<blockquote>
<div><p><strong>What model you learned in 411 does that remind you?</strong></p>
</div></blockquote>
<ul class="simple">
<li><p>All the information about the cross-sectional of expected returns–all the assets– can be summarized by the expected return of the tangency portfolio and the beta of each asset with respect to the tangency portfolio</p></li>
<li><p>Or Alternatively: the risk-return trade-off  of the tangency portfolio  <span class="math notranslate nohighlight">\(\frac{E[r^*]}{Var(r^*)}\)</span> and the covariance of each asset with it.</p></li>
<li><p>Once you have the right notion of risk, the reward to risk is the same across assets (no free lunch)</p></li>
<li><p>What is the right notion?</p></li>
</ul>
<p><strong>Covariance of the asset excess return with the tangency portfolio excess returns</strong></p>
<p>Or equivalently</p>
<p><strong>Beta <span class="math notranslate nohighlight">\(\beta=\frac{Cov(r^e_j,r^*)}{Var(r^*)}\)</span> of the asset excess return with the tangency portfolio excess returns</strong></p>
<p><strong>What does this mean?</strong></p>
<p>It means that if a strategy has the highest sharpe ratio among a set of assets/strategies, then it must be the case that this rleationship holds</p>
<div class="math notranslate nohighlight">
\[ E[r^e_j]=\beta_{j,*}E[r^*] \]</div>
<p>This is a linear regression!</p>
<p>It</p>
<p><strong>Time-series Test (or alpha test)</strong></p>
<p>IF we run</p>
<div class="math notranslate nohighlight">
\[r^e_j=\alpha_j +\beta_{j,*}r^*_t +\epsilon_{j,t}\]</div>
<ul class="simple">
<li><p>Then this relation predicts that the intercept, the alpha, should be zero</p></li>
<li><p>It is important here that both the test assets and the reference portfolios are all <strong>excess returns</strong>. This makes the test really simple. If you use returns instead the prediction about the intercept will be different because of the risk-free rate</p></li>
<li><p>We refer to these assets on the Left Hand Side of the regression as <strong>Test Assets</strong> and the asset on the right as the <strong>model</strong>, which is the candidate tangency portfolio</p></li>
<li><p>This means that we can use this to test whether a new strategy adds value realtive to another strategy (i.e. the model).</p></li>
<li><p>If the model is “right” than we will fail to reject that the alphas are zero, i.e. the relationship between average returns and betas holds.</p></li>
</ul>
<p><strong>What adding value means?</strong> It means enhancing the portfolio sharpe ratio when combined appropriately with the “tangency” portfolio. Therefore, <span class="math notranslate nohighlight">\(r^*\)</span> cannot be tangency!</p>
<p>The way that we will use it is to start with a reference <strong>model portfolio</strong> that with returns <span class="math notranslate nohighlight">\(r^p\)</span>. This can be the returns of your own portfolio if you have a long sample for it and if you hold a very complicated set of assets. But most people use as the reference portfolio the return on the market portfolio.</p>
<p><strong>CAPM prediction: Market portfolio is the tangency portfolio</strong></p>
<ul>
<li><p>The most used reference portfolio is the market portoflio</p></li>
<li><p>So we will do our first alpha test with respect to the market</p></li>
<li><p>The CAPM holds for a set of assets i=1…N if and only if</p>
<div class="math notranslate nohighlight">
\[E[r_{i,t}^e] =\alpha_i+\beta_{i,MKT} E[r_{t}^{MKT,e}]\]</div>
<p>with <span class="math notranslate nohighlight">\(\alpha_i=0\)</span> for all assets  i=1…N</p>
</li>
<li><p>So if you put any other portfolio in <span class="math notranslate nohighlight">\(r_{t}^{*,e}\)</span> instead of the market, then you are not testing the CAPM. The CAPM is aspecific model that predicts that the market is tangency</p></li>
<li><p>In fact we know that there must be a portfolio * such that</p>
<div class="math notranslate nohighlight">
\[E[r_{i,t}^e] =\beta_{i,*} E[r_{t}^{*,e}]\]</div>
<p>holds , such portfolio is the tangency portfolio</p>
</li>
<li><p>Why alpha=0 is so special? Because it tells us that the expected return of any of these assets can be captured by varying the exposure to  the tangency  with the minimum increase in risk possible</p></li>
</ul>
<p><strong>Beating the Model</strong></p>
<p>Academics use this to test if the CAPM is right. Practicioners use this to see if they can beat the CAPM, i.e. <strong>beat the market</strong>. Having an alpha–a postive intercept– means that you have an average return that is higher than your strategy market risk exposure would predict.</p>
<p>It is very important here that is all about averages, not at all about realized returns. Being tanngency does <strong>NOT</strong> mean that your relaized returns shoudl explain all the other realized returns.</p>
<p>Instead, it means that the betas of the asset with the tangnecy should explain the average return of the asset.</p>
<p>Of course, stuff happens, so even if your reference portfolio is in fact tangency portfolio under the true distribution, it will not be in any particular sample, so we will use statistics to tell us if the <span class="math notranslate nohighlight">\(\alpha\)</span> is different enought from zero!</p>
<ul>
<li><p>Test if <span class="math notranslate nohighlight">\(\alpha_i \neq 0\)</span></p>
<ul class="simple">
<li><p>It doesn’t matter if positive or negative, since you can always go short.</p></li>
<li><p>While a particular manager might care to show that thir alpha is positive. Here it is symmetric. So large negative alphas are as good as large positive alphas (or as bad for the referecne portfolio) because you can enhance your Sharpe ratio by shoritng the asset. In reality you might not be able to direct short a mutual fund, but oyu cant try to replicate the opposite of whatever they are doing in case they have a alpha that is negative enough.</p></li>
<li><p>You basically do a standard t-test</p></li>
</ul>
<div class="math notranslate nohighlight">
\[t=\frac{\alpha_i }{\sigma(\alpha_i)}\]</div>
</li>
<li><p>We say</p></li>
</ul>
<ul class="simple">
<li><p>if <span class="math notranslate nohighlight">\(|t|\geq 1.64\)</span> there is a 10% chance that the market is Tangency (or Mean-Variance Efficient, i.e MVE)</p></li>
<li><p>if <span class="math notranslate nohighlight">\(|t|\geq 1.96\)</span> there is a 5% chance that the market is MVE</p></li>
<li><p>if <span class="math notranslate nohighlight">\(|t|\geq 2.1\)</span> there is a 2.5% chance that the market is MVE</p></li>
<li><p>if <span class="math notranslate nohighlight">\(|t|\geq 2.6\)</span> there is a 1% chance that the market is MVE</p></li>
</ul>
<ul>
<li><p>The Time-series regression asks the following question:</p>
<blockquote>
<div><p>Can I replicate  the average return I get in asset <span class="math notranslate nohighlight">\(i\)</span> by investing in the reference portfolio?</p>
</div></blockquote>
</li>
<li><p>Having a non-zero alpha DOES NOT mean that you prefer asset <span class="math notranslate nohighlight">\(i\)</span> to the reference portfolio!</p></li>
<li><p>But it does mean, that you can do better by investing in both assets</p>
<ul class="simple">
<li><p>Obviously with a negative weight if the alpha is negative</p></li>
<li><p>and a positive weight if the alpha is positive</p></li>
</ul>
</li>
<li><p>The alpha test literally asks if the reference portfolio is the tangency portfolio with respect to the investment opportunity that includes the test asset (the asset in the left of the regression) and the reference portfolio (the asset on the right)</p></li>
<li><p>A differet way to put it is that a non-zero alpha means that the asset expands the mean-variance frontier relative to an opportunity set that only has the reference portfolio</p></li>
</ul>
<blockquote>
<div><p>Question: I show that Asset A has alpha with respect to Asset B. Does it mean that an investor should prefer asset A to asset B?</p>
</div></blockquote>
<p>*<em>Is the value strategy likely to increase the Sharper Ratio of someone that only hold the market portoflio?</em></p>
<p>Or equivalently</p>
<ol class="arabic simple">
<li><p>Does the CAPM fail to “price” value strategies</p></li>
<li><p>Does value portfolios expand the mean-variance frontier of somone invested in the market portfolio?</p></li>
<li><p>Does the MARKET beta of the different portfolios explain their average returns?</p></li>
<li><p>Do we need the value strategy to spam the mean-variance frontier of the market and value strategies?</p></li>
</ol>
<p><strong>Adding factors to proxy for the total wealth portfolio</strong></p>
<ul class="simple">
<li><p>According to the  CAPM the Wealth portfolio is the tangency portfolio</p></li>
<li><p>The return on the wealth portfolio summarizes how Bad the times are</p></li>
<li><p>Assets that co-vary more with the market must earn higher returns</p></li>
<li><p>They pay poorly exactly when things are worse</p></li>
<li><p>What is the wealth portfolio? It is the portfolio that holds all assets in proportion to their value</p></li>
<li><p>We often use the equity market as a proxy for this, but that is not the CAPM</p></li>
<li><p>In a way that CAPM is untestable because it is impossible to construct the true wealth portfolio</p></li>
</ul>
<div class="math notranslate nohighlight">
\[E[R_t^i-R_t^f]=\beta_{i,mkt}E[R^{mkt}_t-R^f_t]\]</div>
<ul class="simple">
<li><p>The fact that we cannot really measure the returns of the total wealth protfolio gives us a reason to add other facts in additons to the returns to the equity market. Under this logic you add returns to other assets classes&gt;</p>
<ul>
<li><p>Real estate</p></li>
<li><p>Corporate debt</p></li>
<li><p>Human capital</p></li>
<li><p>Private equity</p></li>
<li><p>Venture Capital
-…</p></li>
</ul>
</li>
</ul>
<p>So you get:</p>
<div class="math notranslate nohighlight">
\[E[R_t^i-R_t^f]=\beta_{i,mkt}E[R^{mkt}_t-R^f_t]+\sum_a^A\beta_{i,a}E[R^{a}_t-R^f_t]\]</div>
<ul class="simple">
<li><p>where <span class="math notranslate nohighlight">\(a\)</span> are the different asset classes.</p></li>
<li><p>Sometimes people refer to these other hard to trade assets as “background risks”, basically risks that are you are exposed to that are not capture by your financial assets</p></li>
</ul>
<p><strong>ICAPM: Intertemporal Capital Asset Pricing Model</strong></p>
<ul class="simple">
<li><p>Another way to rationalize additional  factors is to realize that the premium and the volatiltiy of the market are time-varying.</p></li>
<li><p>This means that assets that allow you to hedge this investment opportunity set risk will be valuable</p>
<ul>
<li><p>For example, an asset that pays well when the market is more/less volatile or one that pays well when the expected reutrns of market going froward are higher/lower</p></li>
</ul>
</li>
<li><p>Under this logic, any strategy that is related to the market moments can also explain average returns on top of the marker beta</p></li>
<li><p>Sometimes people refer to the background risks discussed earlier in this framework as well. But in this case it is not about the moments of the market portfolio per se, but about correlation of the strategy with the background risks investors bear</p></li>
<li><p>The end result is the same</p></li>
</ul>
<div class="math notranslate nohighlight">
\[E[R_t^i-R_t^f]=\beta_{i,mkt}E[R^{mkt}_t-R^f_t]+\sum_{j=1}^J\beta_{i,j}E[Factor^j_t]\]</div>
<ul class="simple">
<li><p>but now these are “Factors” and do no need to be components of the total wealth</p></li>
<li><p>but these factors must still be excess returns, i.e. they must be strategies based on financial assets that have price zero</p></li>
</ul>
<p><strong>APT: Arbitrage Pricing Theory</strong></p>
<ul class="simple">
<li><p>Yet another model that has exactly the same prediction</p></li>
</ul>
<div class="math notranslate nohighlight">
\[E[R_t^i-R_t^f]=\beta_{i,mkt}E[R^{mkt}_t-R^f_t]+\sum_{j=1}^J\beta_{i,j}E[Factor^j_t]\]</div>
<ul class="simple">
<li><p>but now the factors are motivated because the explain time-seires variation in realized return</p></li>
<li><p>the idea is that if you have enough factors you explain enough of the variaiton in the returns of an asset that if the betas do no explain the average reuturns than an arbitrage opportunity wouldd open up</p></li>
<li><p>So you can think of the first two moticaiton being more about “economic factors” while this one being abotu “fianncail factors”. The factors belong if they help you explain reuturs.</p></li>
<li><p>APT in the end is a very statistical model</p></li>
</ul>
<p><strong>How to work with multifactor models?</strong></p>
<ul class="simple">
<li><p>These models make less restrictive assumptions and predict that we will need additional factors beyond the market to “span” the tangency portfolio</p></li>
<li><p>What does “span” mean?</p></li>
</ul>
<div class="math notranslate nohighlight">
\[E[R_t^i-R_t^f]=\beta_{i,mkt}E[R^{mkt}_t-R^f_t]+\sum_{j=1}^J\beta_{i,j}E[Factor^j_t]\]</div>
<ul>
<li><p>It is basically the same as before, but now we run a multivariate regression</p>
<div class="math notranslate nohighlight">
\[R_{i,t}=\alpha_i+\beta_{mkt}R^{mkt}_t+\beta_1 Factor_1+\beta_2 Factor_2+\beta_3 Factor_3+....+\beta_n Factor_n+\epsilon_{i,t}\]</div>
</li>
<li><p>As long as the factors <strong>are also excess returns</strong>, the time-series alpha test is still valid and indentical as before.</p></li>
<li><p>You can do single asset tests and simply use the alpha t-stat to test the model</p></li>
<li><p>Everything that we discussed with the hedging/tracking portfolios apply here as well, but now</p></li>
</ul>
<div class="math notranslate nohighlight">
\[Hedged_{i,t}=R_{i,t}-(\beta_{mkt}R^{mkt}_t+\beta_1 Factor_1+\beta_2 Factor_2+\beta_3 Factor_3+....+\beta_n Factor_n)\]</div>
<p>where <span class="math notranslate nohighlight">\((\beta_{mkt}R^{mkt}_t+\beta_1 Factor_1+\beta_2 Factor_2+\beta_3 Factor_3+....+\beta_n Factor_n)\)</span> is the tracking portfolio</p>
<p><strong>Which Multi-factor models?</strong></p>
<p>It really depends on the application. Practicioners ofen use factor models with 10 or more factors becasue they are interested in peformance attibution.</p>
<p>You use the regression to see which factor explain some particular realized performance while not thinking to much about whether the factor there explains average returns.</p>
<p>This is a perferctly good use mulitfactor models. In this case you are not really thinking whether the factors help you span the tangency portfolio, but only if it help explain the realized reutrn of the strategy.</p>
<p>If you interesting in accounting for a fund/strategy/stock averagare return you have look for factors that help you span the tangency portfolio, i.e. facots that generate high sharpe ratios.</p>
<p>In the academic world and also in a good chunk of practicioners people use the following factor models</p>
<ol class="arabic simple">
<li><p>Fama French 3 factor model:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[E[R_t^i-R_t^f]=\beta_{i,mkt}E[R^{mkt}_t-R^f_t]+\beta_{i,smb}E[SmB_t]+\beta_{i,HmL}E[HmL_t]\]</div>
<ol class="arabic simple" start="2">
<li><p>Carhart 4 factor model:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[E[R_t^i-R_t^f]=\beta_{i,mkt}E[R^{mkt}_t-R^f_t]+\beta_{i,smb}E[SmB_t]+\beta_{i,HmL}E[HmL_t]+\beta_{i,WmL}E[WmL_t]\]</div>
<ol class="arabic simple" start="3">
<li><p>Fama French  5 factor model:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[E[R_t^i-R_t^f]=\beta_{i,mkt}E[R^{mkt}_t-R^f_t]+\beta_{i,smb}E[SmB_t]+\beta_{i,HmL}E[HmL_t]+\beta_{i,rmw}E[RmW_t]+\beta_{i,cma}E[CmA_t]\]</div>
<ol class="arabic simple" start="4">
<li><p>Fama French  5 factor model + Momentum:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[E[R_t^i-R_t^f]=\beta_{i,mkt}E[R^{mkt}_t-R^f_t]+\beta_{i,smb}E[SmB_t]+\beta_{i,HmL}E[HmL_t]+\beta_{i,rmw}E[RmW_t]+\beta_{i,cma}E[CmA_t]+\beta_{i,WmL}E[WmL_t]\]</div>
<p>Where :</p>
<ul class="simple">
<li><p>HmL is the value strategy that buys high book to market firms and sell low book to market firms</p></li>
<li><p>SmB is a size strategy that buys firms with low market capitalization and sell firms with high market capitalizations</p></li>
<li><p>WmL is the momentum strategy that buy stocks that did well in the last 12 months and short the ones that did poorly</p></li>
<li><p>RmW is the strategy that buys firms with high gross proftiability and sell firms with low gross profitability</p></li>
<li><p>CmA is the strategy that buys firms that are investing little (low CAPEX) and sell firms that are investing a lot (high CAPEX)</p></li>
</ul>
<p><strong>Three applications to evalauting asset managers</strong></p>
<p>We will do this in three steps</p>
<ol class="arabic simple">
<li><p>Get time-series of the factors in our factor model and the risk-free rate</p></li>
<li><p>For each application get the time-series return data of the asset  being evaluated</p></li>
<li><p>Merge with factor series</p></li>
<li><p>Convert the returns of the asset being evaluate to excess returns</p></li>
<li><p>Run a time-series regression of the asset excess returns on the relevant factors</p></li>
</ol>
<p><strong>Factors for our factor model</strong></p>
<ul class="simple">
<li><p>We will start by dowloading he Five factors from Fama Frency 5 factors model plus the momentum factor which is in separate data set</p></li>
<li><p>We of course could have constructed them ourselves as well, but this is obviously faster and less error prone</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">pandas_datareader.data</span> <span class="k">as</span> <span class="nn">web</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1926</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s1">&#39;F-F_Research_Data_5_Factors_2x3&#39;</span><span class="p">,</span> <span class="s1">&#39;famafrench&#39;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
<span class="n">dff5</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="s1">&#39;2021-3&#39;</span><span class="p">]</span>
<span class="n">dff5</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="s1">&#39;F-F_Momentum_Factor&#39;</span><span class="p">,</span> <span class="s1">&#39;famafrench&#39;</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>
<span class="n">dmom</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="s1">&#39;2021-3&#39;</span><span class="p">]</span>
<span class="n">dmom</span>
<span class="n">dff6</span><span class="o">=</span><span class="n">dff5</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dmom</span><span class="p">,</span><span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
<span class="n">dff6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mkt-RF</th>
      <th>SMB</th>
      <th>HML</th>
      <th>RMW</th>
      <th>CMA</th>
      <th>RF</th>
      <th>Mom</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1963-07</th>
      <td>-0.39</td>
      <td>-0.45</td>
      <td>-0.94</td>
      <td>0.66</td>
      <td>-1.15</td>
      <td>0.27</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>1963-08</th>
      <td>5.07</td>
      <td>-0.82</td>
      <td>1.82</td>
      <td>0.40</td>
      <td>-0.40</td>
      <td>0.25</td>
      <td>1.03</td>
    </tr>
    <tr>
      <th>1963-09</th>
      <td>-1.57</td>
      <td>-0.48</td>
      <td>0.17</td>
      <td>-0.76</td>
      <td>0.24</td>
      <td>0.27</td>
      <td>0.16</td>
    </tr>
    <tr>
      <th>1963-10</th>
      <td>2.53</td>
      <td>-1.30</td>
      <td>-0.04</td>
      <td>2.75</td>
      <td>-2.24</td>
      <td>0.29</td>
      <td>3.14</td>
    </tr>
    <tr>
      <th>1963-11</th>
      <td>-0.85</td>
      <td>-0.85</td>
      <td>1.70</td>
      <td>-0.45</td>
      <td>2.22</td>
      <td>0.27</td>
      <td>-0.75</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2020-11</th>
      <td>12.47</td>
      <td>6.75</td>
      <td>2.11</td>
      <td>-2.78</td>
      <td>1.05</td>
      <td>0.01</td>
      <td>-12.25</td>
    </tr>
    <tr>
      <th>2020-12</th>
      <td>4.63</td>
      <td>4.67</td>
      <td>-1.36</td>
      <td>-2.15</td>
      <td>0.00</td>
      <td>0.01</td>
      <td>-2.42</td>
    </tr>
    <tr>
      <th>2021-01</th>
      <td>-0.03</td>
      <td>6.88</td>
      <td>2.85</td>
      <td>-3.33</td>
      <td>4.68</td>
      <td>0.00</td>
      <td>4.37</td>
    </tr>
    <tr>
      <th>2021-02</th>
      <td>2.78</td>
      <td>4.51</td>
      <td>7.08</td>
      <td>0.09</td>
      <td>-1.97</td>
      <td>0.00</td>
      <td>-7.68</td>
    </tr>
    <tr>
      <th>2021-03</th>
      <td>3.09</td>
      <td>-0.98</td>
      <td>7.40</td>
      <td>6.43</td>
      <td>3.44</td>
      <td>0.00</td>
      <td>-5.83</td>
    </tr>
  </tbody>
</table>
<p>693 rows × 7 columns</p>
</div></div></div>
</div>
<p><strong>Aplication 1: Performance evaluation of <a class="reference external" href="https://en.wikipedia.org/wiki/Berkshire_Hathaway">Berkshire Hathaway</a></strong></p>
<ul class="simple">
<li><p>How much of WB performance can be explained by his exposure to the differnet risk factors?</p></li>
<li><p>How much of WB performance is due to his ability to buy good business for cheap?</p></li>
</ul>
<p><strong>Getting the Data</strong></p>
<p>We will do the data at monthly frequency.</p>
<p>While daily data is helpful in estiamting betas we have do be mindful of liqudiity effects, for example bid-ask bounces</p>
<p>One could do daily and add lagged returns as a way to deal with this</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">wrds</span>
<span class="kn">import</span> <span class="nn">psycopg2</span> 
<span class="kn">from</span> <span class="nn">codesnippets</span> <span class="kn">import</span> <span class="n">get_returns</span>
<span class="n">conn</span><span class="o">=</span><span class="n">wrds</span><span class="o">.</span><span class="n">Connection</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">get_returns</span><span class="p">(</span><span class="n">tickers</span><span class="p">,</span><span class="n">conn</span><span class="p">,</span><span class="n">startdate</span><span class="p">,</span><span class="n">enddate</span><span class="p">,</span><span class="n">variable</span><span class="o">=</span><span class="s1">&#39;ret&#39;</span><span class="p">):</span>
    <span class="n">ticker</span><span class="o">=</span><span class="n">tickers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">raw_sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                          select a.permno, b.ncusip, b.ticker, a.date, b.shrcd,</span>
<span class="s2">                          a.ret, a.vol, a.shrout, a.prc, a.cfacpr, a.cfacshr,a.retx</span>
<span class="s2">                          from crsp.msf as a</span>
<span class="s2">                          left join crsp.msenames as b</span>
<span class="s2">                          on a.permno=b.permno</span>
<span class="s2">                          and b.namedt&lt;=a.date</span>
<span class="s2">                          and a.date&lt;=b.nameendt</span>
<span class="s2">                          where a.date between &#39;&quot;&quot;&quot;</span><span class="o">+</span> <span class="n">startdate</span><span class="o">+</span><span class="s2">&quot;&quot;&quot;&#39;  and &#39;&quot;&quot;&quot;</span><span class="o">+</span> <span class="n">enddate</span><span class="o">+</span>            
<span class="w">                          </span><span class="sd">&quot;&quot;&quot;&#39; and  b.ticker=&#39;&quot;&quot;&quot;</span><span class="o">+</span><span class="n">ticker</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
    <span class="c1"># and b.shrcd between 10 and 11</span>
    <span class="c1"># and b.exchcd between 1 and 3</span>
            
    <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;permno&#39;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Enter your WRDS username [Alan.Moreira]: moreira5
Enter your password: ···········
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WRDS recommends setting up a .pgpass file.
You can find more info here:
https://www.postgresql.org/docs/9.5/static/libpq-pgpass.html.
Loading library list...
Done
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">=</span><span class="n">get_returns</span><span class="p">([</span><span class="s1">&#39;BRK&#39;</span><span class="p">],</span><span class="n">conn</span><span class="p">,</span><span class="s1">&#39;1/1/1960&#39;</span><span class="p">,</span><span class="s1">&#39;1/1/2022&#39;</span><span class="p">,</span><span class="n">variable</span><span class="o">=</span><span class="s1">&#39;prc&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/f01eaeaa2c3181bd539d22b818c904ac5ef32e6a47f3776fb8443bf1d4937c68.png" src="../../_images/f01eaeaa2c3181bd539d22b818c904ac5ef32e6a47f3776fb8443bf1d4937c68.png" />
</div>
</div>
<p>Berkshire seems to have multiple securities issue over time</p>
<p>We will simply use the blue series which matches wha tI see in <a class="reference external" href="https://www.google.com/finance/quote/BRK.A:NYSE?sa=X&amp;ved=2ahUKEwixoeeWi6_wAhX4Ap0JHXMsCD4Q3ecFMAB6BAgjEBo&amp;window=MAX">google</a>, but you could think about piecing toghether the blue and the green to expand the sample. But one would have to read in detail to see what happened and if that really makes sense</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">=</span><span class="n">get_returns</span><span class="p">([</span><span class="s1">&#39;BRK&#39;</span><span class="p">],</span><span class="n">conn</span><span class="p">,</span><span class="s1">&#39;1/1/1960&#39;</span><span class="p">,</span><span class="s1">&#39;1/1/2022&#39;</span><span class="p">,</span><span class="n">variable</span><span class="o">=</span><span class="s1">&#39;ret&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="mf">17778.0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/78fa12a978cd65b733edca4fc5bfc1f4d20d3a50f505c1348e05acfa6b661baa.png" src="../../_images/78fa12a978cd65b733edca4fc5bfc1f4d20d3a50f505c1348e05acfa6b661baa.png" />
</div>
</div>
<p>Lets now merge with the factors</p>
<p>Firs note that they are both monthy bu the factors index is period type while the Berkshire index is date time</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dff6</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PeriodIndex([&#39;1963-07&#39;, &#39;1963-08&#39;, &#39;1963-09&#39;, &#39;1963-10&#39;, &#39;1963-11&#39;, &#39;1963-12&#39;,
             &#39;1964-01&#39;, &#39;1964-02&#39;, &#39;1964-03&#39;, &#39;1964-04&#39;,
             ...
             &#39;2020-06&#39;, &#39;2020-07&#39;, &#39;2020-08&#39;, &#39;2020-09&#39;, &#39;2020-10&#39;, &#39;2020-11&#39;,
             &#39;2020-12&#39;, &#39;2021-01&#39;, &#39;2021-02&#39;, &#39;2021-03&#39;],
            dtype=&#39;period[M]&#39;, name=&#39;Date&#39;, length=693, freq=&#39;M&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DatetimeIndex([&#39;1962-08-31&#39;, &#39;1962-09-28&#39;, &#39;1962-10-31&#39;, &#39;1962-11-30&#39;,
               &#39;1962-12-31&#39;, &#39;1963-01-31&#39;, &#39;1963-02-28&#39;, &#39;1963-03-29&#39;,
               &#39;1963-04-30&#39;, &#39;1963-05-31&#39;,
               ...
               &#39;2020-03-31&#39;, &#39;2020-04-30&#39;, &#39;2020-05-29&#39;, &#39;2020-06-30&#39;,
               &#39;2020-07-31&#39;, &#39;2020-08-31&#39;, &#39;2020-09-30&#39;, &#39;2020-10-30&#39;,
               &#39;2020-11-30&#39;, &#39;2020-12-31&#39;],
              dtype=&#39;datetime64[ns]&#39;, name=&#39;date&#39;, length=644, freq=None)
</pre></div>
</div>
</div>
</div>
<p>We can deal with this by converting either the <code class="docutils literal notranslate"><span class="pre">df</span></code> dataframe to period or the <code class="docutils literal notranslate"><span class="pre">dff6</span></code> dataframe to datetime</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="mf">17778.0</span><span class="p">]</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>date
2020-08    0.115550
2020-09   -0.023077
2020-10   -0.054690
2020-11    0.136159
2020-12    0.012008
Freq: M, Name: 17778.0, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dff6</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mkt-RF</th>
      <th>SMB</th>
      <th>HML</th>
      <th>RMW</th>
      <th>CMA</th>
      <th>RF</th>
      <th>Mom</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-11-30</th>
      <td>12.47</td>
      <td>6.75</td>
      <td>2.11</td>
      <td>-2.78</td>
      <td>1.05</td>
      <td>0.01</td>
      <td>-12.25</td>
    </tr>
    <tr>
      <th>2020-12-31</th>
      <td>4.63</td>
      <td>4.67</td>
      <td>-1.36</td>
      <td>-2.15</td>
      <td>0.00</td>
      <td>0.01</td>
      <td>-2.42</td>
    </tr>
    <tr>
      <th>2021-01-31</th>
      <td>-0.03</td>
      <td>6.88</td>
      <td>2.85</td>
      <td>-3.33</td>
      <td>4.68</td>
      <td>0.00</td>
      <td>4.37</td>
    </tr>
    <tr>
      <th>2021-02-28</th>
      <td>2.78</td>
      <td>4.51</td>
      <td>7.08</td>
      <td>0.09</td>
      <td>-1.97</td>
      <td>0.00</td>
      <td>-7.68</td>
    </tr>
    <tr>
      <th>2021-03-31</th>
      <td>3.09</td>
      <td>-0.98</td>
      <td>7.40</td>
      <td>6.43</td>
      <td>3.44</td>
      <td>0.00</td>
      <td>-5.83</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Here I will use the first method</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">=</span><span class="p">(</span><span class="n">dff6</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="mf">17778.0</span><span class="p">]</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">),</span><span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">17778</span><span class="p">:</span><span class="s1">&#39;BRK&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mkt-RF</th>
      <th>SMB</th>
      <th>HML</th>
      <th>RMW</th>
      <th>CMA</th>
      <th>RF</th>
      <th>Mom</th>
      <th>BRK</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1988-11</th>
      <td>-0.0229</td>
      <td>-0.0166</td>
      <td>0.0130</td>
      <td>-0.0028</td>
      <td>0.0160</td>
      <td>0.0057</td>
      <td>0.0042</td>
      <td>-0.005291</td>
    </tr>
    <tr>
      <th>1988-12</th>
      <td>0.0149</td>
      <td>0.0201</td>
      <td>-0.0154</td>
      <td>0.0063</td>
      <td>-0.0037</td>
      <td>0.0063</td>
      <td>0.0042</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1989-01</th>
      <td>0.0610</td>
      <td>-0.0223</td>
      <td>0.0049</td>
      <td>-0.0103</td>
      <td>0.0016</td>
      <td>0.0055</td>
      <td>-0.0014</td>
      <td>0.047872</td>
    </tr>
    <tr>
      <th>1989-02</th>
      <td>-0.0225</td>
      <td>0.0267</td>
      <td>0.0090</td>
      <td>-0.0081</td>
      <td>0.0190</td>
      <td>0.0061</td>
      <td>0.0094</td>
      <td>-0.040609</td>
    </tr>
    <tr>
      <th>1989-03</th>
      <td>0.0157</td>
      <td>0.0077</td>
      <td>0.0047</td>
      <td>0.0000</td>
      <td>0.0079</td>
      <td>0.0067</td>
      <td>0.0356</td>
      <td>0.047619</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2020-08</th>
      <td>0.0763</td>
      <td>-0.0094</td>
      <td>-0.0294</td>
      <td>0.0427</td>
      <td>-0.0144</td>
      <td>0.0001</td>
      <td>0.0051</td>
      <td>0.115550</td>
    </tr>
    <tr>
      <th>2020-09</th>
      <td>-0.0363</td>
      <td>0.0007</td>
      <td>-0.0251</td>
      <td>-0.0115</td>
      <td>-0.0177</td>
      <td>0.0001</td>
      <td>0.0305</td>
      <td>-0.023077</td>
    </tr>
    <tr>
      <th>2020-10</th>
      <td>-0.0210</td>
      <td>0.0476</td>
      <td>0.0403</td>
      <td>-0.0060</td>
      <td>-0.0053</td>
      <td>0.0001</td>
      <td>-0.0303</td>
      <td>-0.054690</td>
    </tr>
    <tr>
      <th>2020-11</th>
      <td>0.1247</td>
      <td>0.0675</td>
      <td>0.0211</td>
      <td>-0.0278</td>
      <td>0.0105</td>
      <td>0.0001</td>
      <td>-0.1225</td>
      <td>0.136159</td>
    </tr>
    <tr>
      <th>2020-12</th>
      <td>0.0463</td>
      <td>0.0467</td>
      <td>-0.0136</td>
      <td>-0.0215</td>
      <td>0.0000</td>
      <td>0.0001</td>
      <td>-0.0242</td>
      <td>0.012008</td>
    </tr>
  </tbody>
</table>
<p>386 rows × 8 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">BRK</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">BRK</span><span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">RF</span>
</pre></div>
</div>
</div>
</div>
<p>Start with the CAPM</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="n">temp</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> 
<span class="n">x</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>
<span class="n">y</span><span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="s1">&#39;BRK&#39;</span><span class="p">]</span>
<span class="n">results</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>           <td>BRK</td>       <th>  R-squared:         </th> <td>   0.212</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.210</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   103.6</td>
</tr>
<tr>
  <th>Date:</th>             <td>Tue, 04 May 2021</td> <th>  Prob (F-statistic):</th> <td>1.06e-21</td>
</tr>
<tr>
  <th>Time:</th>                 <td>09:25:48</td>     <th>  Log-Likelihood:    </th> <td>  592.00</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>   386</td>      <th>  AIC:               </th> <td>  -1180.</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>   384</td>      <th>  BIC:               </th> <td>  -1172.</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
     <td></td>       <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>  <td>    0.0060</td> <td>    0.003</td> <td>    2.210</td> <td> 0.028</td> <td>    0.001</td> <td>    0.011</td>
</tr>
<tr>
  <th>Mkt-RF</th> <td>    0.6236</td> <td>    0.061</td> <td>   10.178</td> <td> 0.000</td> <td>    0.503</td> <td>    0.744</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>83.751</td> <th>  Durbin-Watson:     </th> <td>   2.060</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td> <th>  Jarque-Bera (JB):  </th> <td> 261.498</td>
</tr>
<tr>
  <th>Skew:</th>          <td> 0.974</td> <th>  Prob(JB):          </th> <td>1.65e-57</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 6.530</td> <th>  Cond. No.          </th> <td>    23.0</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">12</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.07164885662375453
</pre></div>
</div>
</div>
</div>
<p>Market beta of about 0.6 and alpha of 7% per year!</p>
<p><em>Six factor model</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> 
<span class="n">x</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;BRK&#39;</span><span class="p">,</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">y</span><span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="s1">&#39;BRK&#39;</span><span class="p">]</span>
<span class="n">results</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>           <td>BRK</td>       <th>  R-squared:         </th> <td>   0.348</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.338</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   33.74</td>
</tr>
<tr>
  <th>Date:</th>             <td>Tue, 04 May 2021</td> <th>  Prob (F-statistic):</th> <td>1.35e-32</td>
</tr>
<tr>
  <th>Time:</th>                 <td>09:26:02</td>     <th>  Log-Likelihood:    </th> <td>  628.50</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>   386</td>      <th>  AIC:               </th> <td>  -1243.</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>   379</td>      <th>  BIC:               </th> <td>  -1215.</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     6</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
     <td></td>       <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>  <td>    0.0046</td> <td>    0.003</td> <td>    1.774</td> <td> 0.077</td> <td>   -0.001</td> <td>    0.010</td>
</tr>
<tr>
  <th>Mkt-RF</th> <td>    0.7599</td> <td>    0.067</td> <td>   11.357</td> <td> 0.000</td> <td>    0.628</td> <td>    0.892</td>
</tr>
<tr>
  <th>SMB</th>    <td>   -0.3946</td> <td>    0.091</td> <td>   -4.316</td> <td> 0.000</td> <td>   -0.574</td> <td>   -0.215</td>
</tr>
<tr>
  <th>HML</th>    <td>    0.4836</td> <td>    0.118</td> <td>    4.091</td> <td> 0.000</td> <td>    0.251</td> <td>    0.716</td>
</tr>
<tr>
  <th>RMW</th>    <td>    0.2687</td> <td>    0.121</td> <td>    2.214</td> <td> 0.027</td> <td>    0.030</td> <td>    0.507</td>
</tr>
<tr>
  <th>CMA</th>    <td>   -0.1286</td> <td>    0.172</td> <td>   -0.749</td> <td> 0.454</td> <td>   -0.466</td> <td>    0.209</td>
</tr>
<tr>
  <th>Mom   </th> <td>   -0.0077</td> <td>    0.057</td> <td>   -0.135</td> <td> 0.892</td> <td>   -0.119</td> <td>    0.104</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>89.527</td> <th>  Durbin-Watson:     </th> <td>   2.143</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td> <th>  Jarque-Bera (JB):  </th> <td> 237.376</td>
</tr>
<tr>
  <th>Skew:</th>          <td> 1.105</td> <th>  Prob(JB):          </th> <td>2.85e-52</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 6.143</td> <th>  Cond. No.          </th> <td>    80.7</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.055415983696528254
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>What do we learn about Warren Investment style?</p></li>
<li><p>What do we learn about Warren specific stock picking skills?</p></li>
</ul>
<p><strong>Aplication 2: Does Cathie Wood has some secret sauce? Performance evalaution of <a class="reference external" href="https://ark-funds.com/arkk">ARKK</a></strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">=</span><span class="n">get_returns</span><span class="p">([</span><span class="s1">&#39;ARKK&#39;</span><span class="p">],</span><span class="n">conn</span><span class="p">,</span><span class="s1">&#39;1/1/1960&#39;</span><span class="p">,</span><span class="s1">&#39;1/1/2022&#39;</span><span class="p">,</span><span class="n">variable</span><span class="o">=</span><span class="s1">&#39;ret&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">df</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/c5b9beb8488bb09c45d52b4a11aba719898edf97297135a7be834ba54812436d.png" src="../../_images/c5b9beb8488bb09c45d52b4a11aba719898edf97297135a7be834ba54812436d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">=</span><span class="p">(</span><span class="n">dff6</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">),</span><span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mf">14948.0</span><span class="p">:</span><span class="s1">&#39;ARKK&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">ARKK</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">ARKK</span><span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">RF</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> 
<span class="n">x</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">])</span>
<span class="n">y</span><span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="s1">&#39;ARKK&#39;</span><span class="p">]</span>
<span class="n">results</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>          <td>ARKK</td>       <th>  R-squared:         </th> <td>   0.691</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.687</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   160.9</td>
</tr>
<tr>
  <th>Date:</th>             <td>Tue, 04 May 2021</td> <th>  Prob (F-statistic):</th> <td>4.98e-20</td>
</tr>
<tr>
  <th>Time:</th>                 <td>09:28:12</td>     <th>  Log-Likelihood:    </th> <td>  120.93</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>    74</td>      <th>  AIC:               </th> <td>  -237.9</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>    72</td>      <th>  BIC:               </th> <td>  -233.2</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     1</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
     <td></td>       <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>  <td>    0.0115</td> <td>    0.006</td> <td>    2.016</td> <td> 0.048</td> <td>    0.000</td> <td>    0.023</td>
</tr>
<tr>
  <th>Mkt-RF</th> <td>    1.5768</td> <td>    0.124</td> <td>   12.684</td> <td> 0.000</td> <td>    1.329</td> <td>    1.825</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td> 4.334</td> <th>  Durbin-Watson:     </th> <td>   1.974</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.115</td> <th>  Jarque-Bera (JB):  </th> <td>   3.484</td>
</tr>
<tr>
  <th>Skew:</th>          <td> 0.465</td> <th>  Prob(JB):          </th> <td>   0.175</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 3.516</td> <th>  Cond. No.          </th> <td>    22.3</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.1385421007873513
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> 
<span class="n">x</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;ARKK&#39;</span><span class="p">,</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">y</span><span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="s1">&#39;ARKK&#39;</span><span class="p">]</span>
<span class="n">results</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>          <td>ARKK</td>       <th>  R-squared:         </th> <td>   0.818</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.802</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   50.21</td>
</tr>
<tr>
  <th>Date:</th>             <td>Tue, 04 May 2021</td> <th>  Prob (F-statistic):</th> <td>6.69e-23</td>
</tr>
<tr>
  <th>Time:</th>                 <td>09:28:44</td>     <th>  Log-Likelihood:    </th> <td>  140.55</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>    74</td>      <th>  AIC:               </th> <td>  -267.1</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>    67</td>      <th>  BIC:               </th> <td>  -251.0</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     6</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
     <td></td>       <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th>  <td>    0.0059</td> <td>    0.005</td> <td>    1.234</td> <td> 0.221</td> <td>   -0.004</td> <td>    0.015</td>
</tr>
<tr>
  <th>Mkt-RF</th> <td>    1.3860</td> <td>    0.126</td> <td>   11.009</td> <td> 0.000</td> <td>    1.135</td> <td>    1.637</td>
</tr>
<tr>
  <th>SMB</th>    <td>    0.5065</td> <td>    0.210</td> <td>    2.410</td> <td> 0.019</td> <td>    0.087</td> <td>    0.926</td>
</tr>
<tr>
  <th>HML</th>    <td>   -0.8120</td> <td>    0.200</td> <td>   -4.067</td> <td> 0.000</td> <td>   -1.211</td> <td>   -0.413</td>
</tr>
<tr>
  <th>RMW</th>    <td>   -0.1642</td> <td>    0.326</td> <td>   -0.504</td> <td> 0.616</td> <td>   -0.815</td> <td>    0.487</td>
</tr>
<tr>
  <th>CMA</th>    <td>   -0.9219</td> <td>    0.351</td> <td>   -2.624</td> <td> 0.011</td> <td>   -1.623</td> <td>   -0.221</td>
</tr>
<tr>
  <th>Mom   </th> <td>   -0.2654</td> <td>    0.152</td> <td>   -1.747</td> <td> 0.085</td> <td>   -0.569</td> <td>    0.038</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>10.376</td> <th>  Durbin-Watson:     </th> <td>   2.119</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.006</td> <th>  Jarque-Bera (JB):  </th> <td>  10.331</td>
</tr>
<tr>
  <th>Skew:</th>          <td> 0.806</td> <th>  Prob(JB):          </th> <td> 0.00571</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 3.866</td> <th>  Cond. No.          </th> <td>    83.6</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0704257048781867
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>What do we learn about Cathie Wood investment style?</p></li>
<li><p>What do we learn about Cathie Wook investment skills?</p></li>
<li><p>How do you think about the R-squared? Is a large Rsquared good or bad in this case?</p></li>
</ul>
<p><strong>Application 3: what is a good Momentum ETF?</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;VFMO&#39;</span><span class="p">,</span><span class="s1">&#39;QMOM&#39;</span><span class="p">,</span><span class="s1">&#39;FDMO&#39;</span><span class="p">,</span><span class="s1">&#39;MTUM&#39;</span><span class="p">,</span><span class="s1">&#39;IMTM&#39;</span><span class="p">,</span><span class="s1">&#39;IMOM&#39;</span><span class="p">]</span>
<span class="n">dmom</span><span class="o">=</span><span class="n">get_returns</span><span class="p">([</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">conn</span><span class="p">,</span><span class="s1">&#39;1/1/1960&#39;</span><span class="p">,</span><span class="s1">&#39;1/1/2022&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="n">df</span><span class="o">=</span><span class="n">get_returns</span><span class="p">([</span><span class="n">n</span><span class="p">],</span><span class="n">conn</span><span class="p">,</span><span class="s1">&#39;1/1/1960&#39;</span><span class="p">,</span><span class="s1">&#39;1/1/2022&#39;</span><span class="p">)</span>
    <span class="n">dmom</span><span class="o">=</span><span class="n">dmom</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
<span class="n">dmom</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">names</span>    
<span class="p">(</span><span class="n">dmom</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;date&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/4c020ec0e0abb4a84814286f60ac473c37e83396940f17578d21edac59501565.png" src="../../_images/4c020ec0e0abb4a84814286f60ac473c37e83396940f17578d21edac59501565.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lets merge</span>
<span class="n">df</span><span class="o">=</span><span class="p">(</span><span class="n">dff6</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dmom</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">),</span><span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
<span class="c1"># lets conver to excess returns</span>
<span class="n">df</span><span class="p">[</span><span class="n">names</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">names</span><span class="p">]</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;RF&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Mkt-RF&#39;, &#39;SMB&#39;, &#39;HML&#39;, &#39;RMW&#39;, &#39;CMA&#39;, &#39;RF&#39;, &#39;Mom   &#39;, &#39;VFMO&#39;, &#39;QMOM&#39;,
       &#39;FDMO&#39;, &#39;MTUM&#39;, &#39;IMTM&#39;, &#39;IMOM&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> 
<span class="n">x</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">temp</span><span class="p">[[</span><span class="s1">&#39;Mkt-RF&#39;</span><span class="p">,</span><span class="s1">&#39;Mom   &#39;</span><span class="p">]])</span>
<span class="n">results</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">index</span><span class="o">=</span><span class="p">[],</span><span class="n">columns</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
    <span class="n">y</span><span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="n">res</span><span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">missing</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;t(alpha)&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;betamkt&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;t(betamkt)&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;betamom&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;t(betamom)&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;R-squared&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">rsquared</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;indio risk&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">resid</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s1">&#39;sample size&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">nobs</span>
<span class="n">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>VFMO</th>
      <th>QMOM</th>
      <th>FDMO</th>
      <th>MTUM</th>
      <th>IMTM</th>
      <th>IMOM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>alpha</th>
      <td>-0.001458</td>
      <td>-0.002718</td>
      <td>-0.002354</td>
      <td>0.001112</td>
      <td>-0.002008</td>
      <td>-0.005894</td>
    </tr>
    <tr>
      <th>t(alpha)</th>
      <td>-0.430959</td>
      <td>-0.63581</td>
      <td>-1.664363</td>
      <td>0.869311</td>
      <td>-0.847557</td>
      <td>-1.459713</td>
    </tr>
    <tr>
      <th>betamkt</th>
      <td>1.132283</td>
      <td>1.39176</td>
      <td>1.024135</td>
      <td>1.00483</td>
      <td>0.761741</td>
      <td>0.958616</td>
    </tr>
    <tr>
      <th>t(betamkt)</th>
      <td>16.762846</td>
      <td>13.753471</td>
      <td>31.996319</td>
      <td>31.597999</td>
      <td>13.558808</td>
      <td>10.029335</td>
    </tr>
    <tr>
      <th>betamom</th>
      <td>0.186237</td>
      <td>0.394746</td>
      <td>0.254752</td>
      <td>0.345416</td>
      <td>0.09699</td>
      <td>0.15187</td>
    </tr>
    <tr>
      <th>t(betamom)</th>
      <td>2.178768</td>
      <td>3.281823</td>
      <td>6.461063</td>
      <td>9.626601</td>
      <td>1.568105</td>
      <td>1.336749</td>
    </tr>
    <tr>
      <th>R-squared</th>
      <td>0.917845</td>
      <td>0.782982</td>
      <td>0.960205</td>
      <td>0.919332</td>
      <td>0.756383</td>
      <td>0.674357</td>
    </tr>
    <tr>
      <th>indio risk</th>
      <td>0.064076</td>
      <td>0.107838</td>
      <td>0.032342</td>
      <td>0.039782</td>
      <td>0.065174</td>
      <td>0.101857</td>
    </tr>
    <tr>
      <th>sample size</th>
      <td>34.0</td>
      <td>60.0</td>
      <td>51.0</td>
      <td>92.0</td>
      <td>71.0</td>
      <td>60.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>what do you conclude?</p></li>
<li><p>Which ETF would you pick?</p></li>
<li><p>How to think about the alpha here?</p></li>
<li><p>How do you think about the R-squared? Is a large Rsquared good or bad in this case?</p></li>
<li><p>How do you account for the differnece in market betas when investing?</p></li>
</ul>
<div class="toctree-wrapper compound">
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/Finance"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="TradingStrategies.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Trading Strategies</p>
      </div>
    </a>
    <a class="right-next"
       href="InterpretingFactorModels.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">13.1. </span>Interpretating  Factor models</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">8. Factor models</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-single-factor-risk-model">8.1. A Single-Factor Risk Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-market-model">8.2. Application: Market model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#minimum-variance-investing">8.3. Minimum-variance investing</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-factor-models">9. Multi-factor models</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-a-multi-factor-model">9.1. Estimating a multi-factor model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application">9.2. Application</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reconstructing-the-co-variance-matrix">9.3. Reconstructing the co-variance matrix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-how-will-your-portfolio-risk-change-as-you-add-positions">9.4. Application: How will your portfolio risk change as you add positions</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#benchmarking">10. Benchmarking</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#tracking-error">11. Tracking error</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#factor-models-as-models-of-expected-returns">12. Factor Models as Models of Expected Returns</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alpha">12.1. Alpha</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#appraisal-ratios">12.2. Appraisal Ratios</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#portable-alpha-and-hedged-portfolios">12.3. Portable Alpha and Hedged Portfolios</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">13. Factor Models as Models of Expected Returns</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alan Moreira
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2021 Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>